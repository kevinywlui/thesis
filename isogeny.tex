\documentclass[thesis.tex]{subfiles}

\begin{document}
    
\chapter{Enumerating the Odd Isogenies Class of Prime Level Subvarieties}%
\label{chap:isogeny_class}

Let $N$ be a prime number so that $J_0(N)$ is non-trivial so $N=11$ or $N\geq
17$. Let $A$ be a simple abelian subvariety of $J_0(N)$. The goal of this
chapter is to, under certain conditions, enumerate the $\QQ$-isomorphism
classes of abelian varieties isogenous to $A$ by an odd-degree $\QQ$-isogeny.
We will call this the \emph{odd-degree isogeny class} of $A$.

More precisely, let $\TT$ be the Hecke algebra of $J_0(N)$ and $\TT_A$ be the
image of $\TT$ in $\End(A)$. There exists a newform $f=\sum a_n q^n$ associated
$A$. By~\cite[Prop. 7.14]{shimura:intro}, $\TT_A$ is isomorphic to an order of
the Hecke eigenvalue field - $\QQ(\ldots,a_n,\ldots)$. The goal of this chapter
is to enumerate the odd-degree isogeny class of $A$ when $\TT_A$ is integrally
closed and (when Proposition~\ref{} works).

Unless otherwise stated, in this chapter, all abelian varieties, isogenies, and
isomorphisms are defined over $\QQ$.

The image of an isogeny is determined by its kernel up to isomorphism. So we
define an equivalence relation on the set of finite odd-order
$G_\QQ$-submodules of $A(\QQbar)$ given by $M_1\sim M_2$ if and only if
$A/M_1\isom A/M_2$. For any odd-order $G_\QQ$-submodule $X$ of $A(\QQbar)$, let
$\M(X)$ be the set of equivalence classes of finite odd-order
$G_\QQ$-submodules of $A(\QQbar)$ with a representative that is a submodule of
$X$. Let $A(\QQbar)_\odd$ be the odd-torsion part of $A(\QQbar)$. The goal of
this chapter can then be restated as enumerating a set of representatives for
$\M(A(\QQbar)_\odd)$ when $\TT_A$ is integrally closed and (when
Proposition~\ref{} works). 

We begin by showing every finite $G_\QQ$-submodule of $A(\QQbar)_\odd$ is a
$\TT_A$-module (Proposition~\ref{prop:G_modules_are_hecke}). This is useful
because the $\TT_A$-structure is more easily understood than the
$G_\QQ$-structure. For instance, we are now able to talk about the
$\TT_A$-support of finite odd-order $G_\QQ$-submodules. We then show that every
finite odd-order $G_\QQ$-submodule is equivalent to one support on $S$
(\ref{prop:bound_support}). Now we construct an ideal $Q$ of $\TT_A$ such that
$S$ is the set of primes dividing $Q$. So $\M(A[Q^\infty])=\M(A(\QQbar)_\odd$.
We will then give an method for determining an integer $k$ such that
$\M(A[Q^k])=\M(A[Q^\infty])=\M(A(\QQbar)_\odd)$
(Proposition~\ref{prop:bound_support}). Lastly, we give an algorithm for
enumerating the finite $G_\QQ$-submodules of $\M(A[Q^k])$. In summary, we have
the following algorithm.

\begin{algorithm}{Odd isogeny class}%
    \label{alg:odd_isogeny_class}
    Let $A$ be a simple abelian subvariety with $\TT_A$ integrally closed. This
    algorithm will enumerate the class of abelian varieties isomorphic
    isogenous to $A$ by an odd-degree isogeny.
    \begin{enumerate}
        \item{} [Class group representatives]
            Compute a set of odd integral representatives $H=\{C_i\}$ of
            $\Cl(\TT_A)$. Let $Q = (\prod_{C_i\in H} C_i)(\prod_{\p\in E} \p)$,
            where $E$ is the set of primes dividing the Eisenstein ideal.
        \item{} [Initialize search]
            Set $r=1$ and $X_{r-1}=\emptyset$.
        \item{} [$G_\QQ$-submodules of $A[Q^r]$]
            Use Algorithm~\ref{alg:enumerating_AX} to give a set, $X_r$, of
            representatives for $\M(A[Q^r])$.
        \item{} [Done?]
            By Corollary~\ref{prop:stop_looking}, if for all $x\in X_r$, $x\sim
            y$ for some $y\in X_{r-1}$, then $X_r$ is a set of representatives
            for $\M(A(\QQbar)_\odd)$. If this is not the case, increment $r$
            and repeat the last step.
        \item{} [Quotient and output]
            Output $A/M$ for $M\in X_r$.
    \end{enumerate}
\end{algorithm}

\section{Finite odd-order Galois Modules are Hecke}%
\label{sec:finite_odd_order_galois_modules_are_hecke}

The goal of this section is to prove every finite odd-order $G_\QQ$-submodule $M$
of $A(\QQbar)$ is a Hecke module (Proposition~\ref{prop:G_modules_are_hecke}). The
Galois action of $J(\QQbar)$ has been extensively studied by
Mazur~\cite{mazur:eisenstein}, so we weaken our hypothesis to $M$ a
$G_\QQ$-submodule of $J(\QQbar)_\odd$.

It suffices to prove $M$ is $\TT$-stable for each $G_\QQ$-composition factor $V$
of $M[\ell^\infty]$ for $\ell>2$. The irreducibility of $V$ implies that it is
$\ell$-torsion. Ribet~\cite[Proposition 6.1]{ribet:semistable_gal} shows that
$\TT/\ell \TT$ is generated by $T_p$ for primes $p\nmid \ell N$. So we reduce
modulo $p$ for $p\nmid \ell N$, and use Eichler-Shimura to derived its
$\TT$-stability from its $G_\QQ$-stability.

\begin{proposition}\label{prop:G_modules_are_hecke}
    Suppose $M$ is a finite odd-order $G_\QQ$-submodule of $J_0(N)$, with $N$
    prime. Then $M$ is a $\TT[G_\QQ]$-module.
\end{proposition}
\begin{proof}
    It suffices to show $M$ is $\TT$-stable for each $\ell$-primary part. Let
    $\ell>2$ and assume $M\subseteq J[\ell^\infty]$. Let
    \[
        0 = M_0 \subsetneq \ldots \subsetneq M_n = M
    \]
    be an $G_\QQ$-composition series of $M$ with composition factors $X_i =
    M_i/M_{i-1}$. We proceed by induction on $n$ with the base
    case being the trivial $n=0$ case.

    Assume $M_{s-1}$ is an $\TT[G_\QQ]$-module. We will show $M_s$ is an
    $\TT[G_\QQ]$-module. Since $M_{s-1}$ is an $\TT[G_\QQ]$-module, for each
    $t\in \TT$, we have a well-defined map $t:X_s\to J(\QQbar)/M_{s-1}$. The
    goal is to show $t(X_s)\subseteq X_s$ for all $t\in \TT$.
    By~\cite[Proposition 2]{ribet:mult_p_finite}, $\TT/\ell \TT$ is generated
    by $T_p$ for $p\nmid \ell N$ so it suffices to show $T_p(X_s)\subseteq X_s$
    for prime $p\nmid \ell N$.

    Fix a prime $p\nmid \ell N$. Since $p$ does not divide $N$, $J$ has good
    reduction at $p$. Fix a place $\p$ over $p$. The reduction map yields an
    isomorphism~\cite[Theorem 1, Lemma 2]{serre-tate}
    \[
        \tau:J(\QQbar)[\ell^\infty] \riso J_{/\F_p} (\Fpbar)[\ell^\infty]
    \]
    sending $\Frob_\p$ to $F_p$, where $F_p$ is the absolute Frobenius on
    $J_{/\F_p}$. Under this isomorphism the natural $\TT$-action on $J(\QQ)$
    maps to the natural $\TT$-action on $J_{/\F_p}$~\cite[\S
    5.2]{ribet-stein:serre}. By Eicher-Shimura, $T_p = F+p/F\in
    \End(J_{/\F_p})$ so
    \[
        \tau(T_p X_s)
        = T_p\tau(X_s)
        = (F+p/F)\tau(X_s)
        = \tau((\Frob_\p+p/\Frob_\p)X_s)
        \subseteq \tau(X_s)
    \]
    hence, $T_p X_s\subseteq X_s$, as desired.
\end{proof}


\section{Non-Eisenstein modules are kernels of Hecke}%
\label{sec:non_eisenstein_modules_are_kernels_of_hecke}

In light of Section~\ref{sec:finite_odd_order_galois_modules_are_hecke}, all
finite odd-order $G_\QQ$-submodules of $J(\QQbar)$ are $\TT$-modules. We will
now use this fact freely and will often refer to the $\TT$-support of a finite
odd-order $G_\QQ$-submodule.

The goal now is to identify the finite odd-order $G_\QQ$-submodules of
$J(\QQbar)_\odd$ supported, as a $\TT$-module, on the non-Eisenstein primes by
their $\TT$-annihilators. Using Proposition~\ref{prop:G_modules_are_hecke}, we
can already do this in the irreducible case.

\begin{proposition}
    Let $\m$ be a non-Eisenstein prime of odd residue characteristic, if $M$ is
    a nonzero finite irreducible $G_\QQ$-submodule of $J(\QQbar)$ supported
    only on $\m$ as a $\TT$-module, then $M=J[\m]$.
\end{proposition}
\begin{proof}
    By Lemma~\ref{lem:cherry_street}, the $\TT$-annihilator of $M$ is $\m$.
    Hence, $M\subseteq J[\m]$ but $J[\m]$ is an irreducible
    $G_\QQ$-module~\cite[Proposition 14.2]{mazur:eisenstein} so $M=J[\m]$.
\end{proof}

The general case will follow from a mild adaptation of the work of David
Helm~\cite{helm:jacobian}. Helm considers the case of Jacobians, $J$, of
Shimura curves. One of the key inputs into Helm's proof is that for the maximal
ideals $\m$ in question is that if $T_\m J$ is the contravariant $\m$-adic Tate
module, then $T_\m J/\m T_\m J\cong J[\m]^\vee$ is dimension two over $\TT/\m$
and irreducible as a $G_\QQ$-module. By~\cite[Prop. 14.2]{mazur:eisenstein},
this is also the case for $J=J_0(N)$ with $N$ prime and $\m$ a non-Eisenstein
prime of odd residue characteristic.

\begin{theorem}[{\cite[Corollary 4.8]{helm:jacobian}}]%
    \label{thm:non_eisenstein_kernel_hecke}
    Let $M$ be a finite odd-order $G_\QQ$-module supported, as a $\TT$-module,
    only on the non-Eisenstein primes. If $I=\Ann_\TT(M)$, then $M=J[I]$.

    Moreover, since $A$ is both $\TT[G_\QQ]$-invariant, if $M$ is a finite
    odd-order $G_\QQ$-submodule of $A(\QQbar)$ supported, as a $\TT_A$-module,
    only on the non-Eisenstein primes. If $I=\Ann_{\TT_A}(M)$, then $M=A[I]$.
\end{theorem}

Since $M\subseteq J[I]$ and $\Supp_{\TT} M = \Supp_{\TT} J[I]$, it suffices to
prove $J[I]_\m = M_\m$ for each non-Eisenstein prime of odd residue
characteristic. So let $\m$ be a non-Eisenstein prime of odd residue
characteristic. We start by reviewing the contravariant Tate modules of $J$ and
proving Lemma~\ref{lem:finite_index}.

Let $T_\m J\isom \Hom(J[\m^\infty], \QQ_\ell/\ZZ_\ell)$ be the contravariant
Tate module at $\m$ and $\overline{\rho}_\m$ be the Galois representation
associated to $J[\m]^\vee$. Since $\m$ is an odd non-Eisenstein prime,
$\overline{\rho}_\m$ is an irreducible $G_\QQ$-representation of dimension 2
over $k_\m$ that is isomorphic to $J[\m]^\vee$~\cite[Prop.
14.2]{mazur:eisenstein}.

\begin{lemma}[{\cite[Lemma 4.6]{helm:jacobian}}]\label{lem:finite_index}
    Let $R$ be a $G_\QQ$-stable submodule of $T_\m J$ of finite index. Then
    $R=IT_\m J$ for some ideal $I$ of $\TT$.
\end{lemma}
\begin{proof}
    We proceed by induction on the maximal $G_\QQ$-composition series of $T_\m J/R$
    with the base case being the trivial length zero case. Let
    \[
        R = R_n \subsetneq R_{n-1} \subsetneq \cdots \subsetneq R_0 = T_\m J
    \]
    be a $G_\QQ$-composition series. By induction, $R_{n-1} = I'T_\m J$ for some
    $I'\subseteq \TT$.

    Consider $\m R_{n-1} + R$. This is a $G_\QQ$-module sitting between $R$ and
    $R_{n-1}$. By Nakayama's lemma, if $\m R_{n-1} R + R = R_{n-1}$, then
    $R=R_{n-1}$ which is a contradiction. Hence, $\m R_{n-1}+R=R$ so $R$
    contains $\m R_{n-1}$ and we can form the quotient.

    The module $R_{n-1}/\m R_{n-1}$ is $G_\QQ$-isomorphic to $(I'/\m
    I')\otimes_{\TT/\m} (T_\m J/\m T_\m J) \cong (I'/\m I')\otimes_{\TT/\m}
    J[\m]^\vee$, where $G_\QQ$ acts trivially on $I'/\m I'$. Let $V$ be the image
    of $R$ in $R_{n-1}/\m R_{n-1}$. Since $V$ is $G_\QQ$-invariant, and
    $J[\m]^\vee$ is irreducible, $V$ is given by $\hat{V}\otimes J[\m]^\vee$
    for some $\TT/\m$-subspace $\hat{V}$ of $I'/\m I'$. Let $I$ be the preimage
    of $\hat{V}$ in $I'$. Then $IT_m J = R$, since both contain $\m R_{n-1}$
    and map to $V$ modulo $\m R_{n-1}$.
\end{proof}

We now return to the proof of Theorem~\ref{thm:non_eisenstein_kernel_hecke}.

\begin{proof}[proof of Theorem~\ref{thm:non_eisenstein_kernel_hecke}]
    Let $B=J/M$ be the quotient abelian variety. Since $M$ is a $\TT$-module,
    we may equipped with a $\TT$-action. So the projection $\phi:J \to B$ is an
    $\TT[G_\QQ]$-isogeny with $\ker\phi = M$. For any odd non-Eisenstein prime
    $\m$, $\phi$ induces the exact sequence
    \[
        0 \to T_\m B \to T_\m J \to M^\vee _\m \to 0.
    \]
    In particular, the image of $T_\m B$ under $\phi$ is a finite index
    $\TT[G_\QQ]$-submodule of $T_\m A$. By Lemma~\ref{lem:finite_index}, we can find
    an ideal $I'$ of $\TT$ such that the image of $T_\m B$ is $I' _\m T_\m A$
    for all odd non-Eisenstein primes $\m$. We have $M^\vee _\m = T_\m J / I'
    T_\m J\cong J[I']_\m ^\vee$. Therefore, by taking annihilators of the dual,
    we have that $I_\m = I'_\m$ and then by taking duals $M_\m = J[I]_\m$, as
    desired.
\end{proof}

%\section{Enumerating representatives of $A[X]$}

%Assume $\TT_A$ is integrally closed and let $X$ be an odd ideal of $\TT_A$. The
%goal of this section is to give a set of representatives for $\M(A[X])$ by
%first enumerating the $G_\QQ$-submodules of $A[X]$. We
%have the decomposition $X=\bigoplus_{\p\in \Supp_{\TT_A} (X)} X[\p^{v_\p(X)}]$
%so it suffices to enumerate the $G_\QQ$-submodules of $A[\p^s]$ for any $s\geq
%1$. This will now follow from Mazur's study of the Galois action on torsion
%points~\cite[\S 14]{mazur:eisenstein}.

%\begin{proposition}[Mazur]\label{prop:all_G_subs}
%    Let $\p$ be a prime of residue characteristic $\ell>2$.
%    \begin{enumerate}
%        \item
%            If $\p$ is Eisenstein, then $A[\p]=C_A[\ell]\oplus \Sigma_A[\ell]$,
%            where $C_A=C\cap A$ and $\Sigma_A=\Sigma \cap A$ with $C$ and
%            $\Sigma$ the cuspidal and Shimura subgroups of $J$. The
%            $G_\QQ$-submodules of $A[\p]$ are the direct sum of $\ZZ$-submodules of
%            $C_A[\ell]$ and $\ZZ$-submodules of $\Sigma_A[\ell]$.
%        \item
%            if $\p$ is non-Eisenstein, $A[\p]$ is irreducible~\cite[Prop
%            14.2]{mazur:eisenstein} as as a $G_\QQ$-module so the only
%            $G_\QQ$-submodules are $0$ and $A[\p]$.
%    \end{enumerate}
%\end{proposition}
%\begin{proof}
%    The Eisenstein case is~\cite[Corollary 16.3]{mazur:eisenstein} along with
%    the fact that $C[\ell]\isom \ZZ/\ell$ and $\Sigma[\ell]\isom \mu\ell$.

%    The non-Eisenstein case is~\cite[Propositon 14.2]{mazur:eisenstein}.
%\end{proof}

%Let $a\in \p^{s-1}\setminus \p^s$ so $a$ generates $\p^{s-1}/\p^s$ as a
%$k_\p$-space. There exists a $\TT_A[G_\QQ]$-injection given by
%$\phi_s:A[\p^s]/A[\p^{s-1}]\to A[\p]$. The $G_\QQ$-submodules, $M$, of
%$A[\p^s]$ are then the $\ZZ$-submodules of $A[\p^s]$ such that $M\cap
%A[\p^{s-1}]$ and $\phi_s(M)$ are $G_\QQ$-submodules. This yields the following
%algorithm.

%\begin{algorithm}{Enumerating $G_\QQ$-submodules of {$A[X]$}}%
%    \label{alg:enumerating_AX}
%    Given an odd ideal $X$ of $\TT_A$. This algorithm will output a set of
%    representatives for $\M(A[X])$.
%    \begin{enumerate}
%        \item{} [Factor $X$]
%            Compute the factorization $X=\prod \p_i ^{e_i}$.
%        \item{} [Non-Eisenstein part]
%            For each non-Eisenstein $\p_i$, let $W_i=\{A[\p^j]: 0 \leq j
%            \leq e_i\}$.
%        \item{} [Eisenstein part]
%            For each Eisenstein $\p_i$, set $V_1$ to be the set of
%            $G_\QQ$-submodules of $A[\p]$. For $j=2,\ldots,e_i$, set $V_j$ to
%            be the set of $\ZZ$-submodules, $M$, of $A[\p^j]$ such that $M\cap
%            A[\p^{j-1}]\in V_{j-1}$ and $\phi(M)\in V_1$.
%        \item{} [Combine]
%            Combine the $W_i$'s to form $W=\{\sum_i M_i: M_i \in W_i\}$.
%        \item{} [Output representatives]
%            Use isomorphism testing 
%            %TODO
%            % (Algorithm~\ref{alg:isom_testing})
%            to produce a set of representatives of $\M(A[X])$ of elements of
%            $W$.
%    \end{enumerate}
%\end{algorithm}

\section{Bounding non-Eisenstein part}%
\label{sec:bounding_non_eisenstein_part}

In Section~\ref{sec:non_eisenstein_modules_are_kernels_of_hecke}, we showed
that every finite odd-order $G_\QQ$-submodule of $A(\QQbar)_\tor$ supported, as
a $\TT_A$-module, only on the non-Eisenstein primes are of the form $A[C]$ for
some ideal $C$ of $\TT_A$. In this section, we will assume $\TT_A$ is
integrally closed. The goal now is to prove Proposition~\ref{} which
allows to reduce the non-Eisenstein part of an odd-degree isogeny to a finite
list enumerated by the class group of $\TT_A$. 

Let $\mathcal{H}$ be a set of integral representatives for $\Cl(\TT_A)$ coprime
to $2\mathcal{I}_A$.

The motivating idea this chapter is the following theorem of Frank Calegari
communicated to William Stein. (I should ask Frank Calegari if he can be
cited.)
\begin{theorem}[F. Calegari]
    Let $J=J_0(N)$ with $N$ prime. Let $A$ be a simple abelian subvariety of
    $J$ with $\TT_A$ integrally closed. Suppose 
\end{theorem}

\section{Bounding support and valuations}%
\label{sec:bounding_support_and_valuations}

The goal of this section is to give an ideal $Q$ such that
$\M(A[Q^\infty])=\M(A(\QQbar)_\odd)$ (Proposition~\ref{prop:bound_support}). In
light of Faltings' Isogeny Theorem, there exists $k$ such that
$\M(A[Q^k])=\M(A(\QQbar)_\odd)$. We give a method for finding this $k$ as
Proposition~\ref{prop:stop_looking}. We now have all the necessary ingredients
for Algorithm~\ref{alg:odd_isogeny_class}.

\begin{lemma}\label{lem:com_alg}
    Let $a,b\in \TT_A$, $\p$ such the localization $(\TT_A)_\p$ is a DVR, and
    $M$ an finite odd $G_\QQ$-submodule of $A(\QQbar)$ with $Z=\Ann_{\TT_A} M$.
    Then
    \begin{enumerate}
        \item
            If $v_\p(Z) = k$, then $M[\p^\infty]\subseteq A[\p^k]$.
        \item
            We have $b^{-1}(A[Z])=A[bZ]$. This holds locally at $\p$ as well so
            $b_\p ^{-1} A[Z]_\p = A[bZ]_\p$.
        \item
            Let $r=v_\p(b)-v_\p(a)+k$ and $\phi=a\circ b^{-1}$. If $r\leq
            0$, then $\phi(M)[\p^\infty]=0$ so $\phi(M)_\p=0$.

            If $r>0$, then
            $\phi(M)[\p^\infty]\subseteq A[\p^r]$. Here $b^{-1}$ is the
            preimage of $b$.
    \end{enumerate}
    We will take on the convention that for negative $r$, $A[\p^r]=0$. So we can
    write the last part as $\phi(M)[\p]\subseteq A[\p^r]$.
\end{lemma}
\begin{proof}
    \mbox{}
    \begin{enumerate}
        \item
            Suppose $x\in M[\p^\infty]$. Then $x\in A[\p^\infty]$. Moreover,
            $v_\p(\Ann_{\TT_A} x) \leq v_\p(Z) = k$ so $x\in A[\p^k]$.
        \item
            We have $x\in b^{-1}(A[Z])$ if and only if $bx \in A[Z]$ if and
            only if $x\in A[bZ]$.
        \item
            Suppose $r\leq 0$. Then $\phi_\p \in Z_\p$ so
            \[
                \phi(M)[p^\infty]\subseteq \phi(M[\p^\infty])
                \subseteq \phi(A[\p^k]) = 0.
            \]
            Suppose $r>0$. Then $x\in \phi(M)[\p^\infty] =
            \phi(M[\p^\infty])\subseteq (a\circ
            b^{-1})(A[\p^k])=A[\p^r]$.
    \end{enumerate}
\end{proof}


\begin{lemma}\label{lem:principal_gives_iso}
    Let $C, D$ be nonzero ideals of $\TT_A$, $a,b\in \TT_A$ be nonzero, and $aC
    = bD$. Then there exists an isomorphism $\phi:A/A[D]\to A/A[C]$ such that
    $\phi\circ b=a$.
\end{lemma}
\begin{proof}
    Our argument will now reference the following diagram.
    \[
        \begin{tikzcd}
            A/A[bD]
            \arrow[r, "\sim", "b"']
            \ar[equal]{d}
            &
            A/A[D]
            \ar[d, "\sim" labl, "\phi"]
            \\
            A/A[a C]
            \arrow[r, "\sim", "a"']
            &
            A/A[C]
        \end{tikzcd}
    \]
    We first establish the $b$ and $a$ isomorphism. We have the exact
    sequence
    \[
        \begin{tikzcd}
            0
            \arrow[r]
            &
            (A/A[D])[b]
            \arrow[hookrightarrow]{r}
            &
            A/A[D]
            \arrow[twoheadrightarrow]{r}{b}
            &
            A/A[D]
            \arrow[r]
            &
            0
        \end{tikzcd}.
    \]
    We have that $x\in (A/A[D])[b]$ if and only if $bx \in A[D]$ if and only if
    $x \in A[bD]$. Hence, $(A/A[D])[b]=A[bD]/A[D]$ so $b:A/A[bD]\xra{\sim}
    A[D]$. A similar argument applies for $a$.

    We can now chase the diagram to obtain an isomorphism $\phi:A/A[D]\riso
    A/A[C]$, as desired.
\end{proof}

Recall $\TT_A$ is assumed to be integrally closed. Let $H=\{C_i\}$ be a set of
odd-norm integral representatives for $\Cl(\TT_A)$. Let $D$ be the set of
primes of $\TT_A$ dividing $C_i$ for some $C_i\in H$, $E$ be the set of primes
dividing the Eisenstein ideal, and $S=D\cup E$.

\begin{proposition}%
    \label{prop:bound_support}
    Every finite odd-order $G_\QQ$-submodule is equivalent to one supported on
    $S$.
\end{proposition}
\begin{proof}
    Let $M$ be a finite odd $G_\QQ$-submodule. Let $M=M_{S'}\oplus M_S$ be the
    direct sum decomposition of $M$ with $\Supp M_X \subseteq X$. By
    Theorem~\ref{thm:non_eisenstein_kernel_hecke}, there exists an ideal
    $I$ of $\TT_A$ with $V(I)\subseteq S'$. Since $S'$ consists of only
    invertible primes, $I$ is also invertible. So there exists nonzero $a,b\in
    \TT_A$ such that $bI=aC$. By Lemma~\ref{lem:principal_gives_iso}, there
    exists an isomorphism $\phi:A/A[I]\to A/A[C]$ such that $\phi\circ b = a$.
    Let $\psi:A/A[I]\to A/(A[I]+M_S)$ be the isogeny given by quotienting by
    $M_S/A[I]$. Then $\phi$ induces an isomorphism $\phi':A/(A[I]+M_S)\to
    A/(A[C]+\phi(M_S))$.

    It is clear that $\Supp_{\TT_A}(A[C])\subseteq S$ so it remains to show
    that $\phi(M_S)_\p =0$ for all $\p \in S'$. Let $\p\in S'$, then
    $v_\p(b)-v_\p(a)+v_\p(\Ann(M_S))=v_\p(C)-v_\p(I)+v_\p(\Ann(M_S)) \leq 0$
    since $V(C),V(\Ann(M_S))\subseteq S$. By Lemma~\ref{lem:com_alg},
    $\phi(M_S)_\p = 0$. Therefore, $A[C]+\phi(M_S)$ is supported on $S$.
\end{proof}

From henceforth, we assume that $\TT_A$ is integrally closed. We can now choose
$H=\{C_i\}$ to be a set of integral representatives for $\Cl(\TT_A)$ of odd
norm. Let $Q=\lcm(\{C:C\in H\}\cup \{\p:\p\in S_1\})$. We have that $V(Q)=S$
so, in light of Proposition~\ref{prop:bound_support},
$\M(A[Q^\infty])=\M(A(\QQbar)_\odd)$.

\begin{proposition}%
    \label{prop:stop_looking}
    Suppose $\TT_A$ is integrally closed. Suppose $\M(A[Q^k])=\M(A[Q^{k+1}])$
    then $\M(A[Q^k])=\M(A[Q^\infty])$.

    In terms of isogenies, this claim states that if $G_\QQ$-submodules of
    $A[Q^{k+1}]$ produce no new odd-isogenies not found in $A[Q^k]$, then
    $G_\QQ$-submodules of $A[Q^k]$ give the entire odd-isogeny class.
\end{proposition}
\begin{proof}
    Every isogeny can be factored into a composition of irreducible isogenies.
    Let $A'=A/M$ be a abelian variety with $M$ a $G_\QQ$-submodule of $A[Q^k]$. We
    will show that the image of $A'$ under an irreducible isogeny is equivalent
    to $A/Y$ for some $Y\in A[Q^{k+1}]$. This suffices because when
    $A[Q^k]=A[Q^{k+1}]$, we obtain the full isogeny class.

    Let $M'\subseteq A(\QQbar)_\odd$ be an extension of $M$ by an irreducible
    $G_\QQ$-module $Y$. Let $\m$ be the annihilator of $Y$. If $\m\in S$, then
    $M\subseteq A[\m Q^k]\subseteq A[Q^{k+1}]$ and we are done. So assume
    $\m\notin S$ so $\m$ is an odd Eisenstein prime and $Y=A[\m]$
    (Theorem~\ref{thm:irreducible_G_sub}). Since $\m\notin \Supp_{\TT_A}(M)$,
    $M' = A[\m]\oplus M$. As in Proposition~\ref{prop:bound_support}, there is
    an isomorphism $\phi':A/(A[I]+M_S)\to A/(A[C]+\phi(M_S))$ with $\phi\circ b
    = a$. The goal is to show $A[C]+\phi(M)\subseteq A[Q^k]$. Since
    $A[C]\subseteq A[Q^{k+1}]$ so it suffices to show $\phi(M)\subseteq
    A[Q^{k+1}]$.

    As in Proposition~\ref{prop:bound_support}, $\Supp\phi(M)\subseteq S$. For all
    $\p\in S$ (remember that $\m \notin S$), $v_\p(b)-v_\p(a) =
    v_\p(C)-v_\p(\m)=v_\p(C)$ so by Lemma~\ref{lem:com_alg},
    $\phi(M)\subseteq A[Q^{k+1}]$, as desired.
\end{proof}

\section{Eisenstein Isogenies}%
\label{sec:eisenstein_isogenies}

The goal of this section is to prove the following proposition which limits the
possible Eisenstein isogenies so just the boring ones.
\begin{proposition}
    Let $A$ be a simple subvariety of $J=J_0(N)$ with $N$ prime with $\TT_A$
    integrally closed. Let $\p$ be an Eisenstein prime of odd residue
    characteristic $p$ such that $A[\p]\neq 0$. Suppose $A[\p]=J[\p]$ (This
    might always be true). Let $M\subseteq A[\p^s]$ be a $\TT_A[G_\QQ]$-module.
    If $M \not\subseteq A[\p]$, then $M\subseteq A[\p]$.
\end{proposition}
Before beginning the prime, we will need the following definition by Mazur.
\begin{definition}
    A prime $\ell$ is a \emph{good prime} relative to $(p, N)$ if 
    \begin{enumerate}
        \item
            $\ell$ is not a $p$-th power modulo $N$,
        \item
            $\ell-1\not\equiv 0 \pmod{p}$
    \end{enumerate}
\end{definition}
Mazur~\cite[Prop 16.1]{mazur:eisenstein} proves that if $\p$ is an Eisenstein
prime of odd residue characteristic $p$. Then the Eisenstein ideal, $\I \TT_\p$
is locally, at $\p$, generated by $p$ and $\eta_\ell = T_\ell - (\ell+1)$,
where $\ell$ is any good prime.

\begin{proof}
    We will assume $M\not\subseteq A[\p]$ and $M\not\subseteq A[\p]$ and reach
    a contradiction. Since $M[\p^2]\subseteq A[\p^2]$ also satisfies the
    hypothesis, it suffices to arrive at a contradiction after replacing $M$ by
    $M[\p^2]$. Let $K = \QQ(M)$. We will first show that $K$ is an abelian
    extension.
    \begin{lemma}
        Let $K=\QQ(M)$. Then $K$ is an abelian extension of $\QQ$.
    \end{lemma}
    \begin{proof}
        We first consider $M$ as a finite $(\TT_A)_\p$-module. By assumption,
        $(\TT_A)_\p$ is a DVR so
        \[
            M \cong \TT/\p^{s_1}\times \cdots\times \TT/\p^{s_r}.
        \]
        Since $\dim_{\TT/\p} A[\p] = 2$ and $M[\p]\cong (\TT/\m)^r\subseteq
        A[\p]$, we must have $r=1$ so $M\cong \TT/\p^s$ for some $s$.

        The action of $\TT_A$ and $G_\QQ$ commute, we have
        \[
            \Gal(K/\QQ)\subseteq \Aut_\TT(M)\cong \Aut(\TT/\p^s) \cong
            (\TT/\p^s)^\times
        \]
        which is commutative so $K$ is an abelian extension. Since $K$ is
        abelian, by Chebotarev Density, there exists a good prime $\ell$
        (recall this also implies $A$ has good reduction at $\ell$) that
        totally splits over $K$. Therefore,
        \[
            M \subseteq J(K)_\tor \subseteq J[\eta_\ell].
        \]
        But this implies $M_\p\subseteq J[\eta_\ell]_\p = C_p \oplus
        \Sigma_p\subseteq A[\p]$, where $C_p$ and $\Sigma_p$ are the
        $p$-primary parts of the cuspidal and Shimura subgroups. This yields
        a contradiction.
    \end{proof}
\end{proof}

\begin{theorem}[F. Calegari]
    Let $N$ be a prime, $J=J_0(N)$, $\TT$ the Hecke algebra of $J$, and $\I$
    the Eisenstein ideal of $\TT$. Let $A$ be a simple abelian subvariety of
    $J$, $\TT_A := \Im (\TT(N)\to \End(A))$, and $\I_A := \Im (\I\to \End(A))$
    be the Eisenstein ideal of $\TT_A$. Suppose $\TT_A$ is integrally closed.
    If $\varphi:A\to A'$ is an odd-degree isogeny, then
    \[
        A' \cong A/M,
    \]
    where 
\end{theorem}

\begin{lemma}
    Let $J = J_0(N)$ and $A$ an abelian subvariety of $J$. Let $K$ be a number
    field and $\ell$ an odd completely split rational prime in $K$ of good
    reduction for $A$. Then
    \[
        A(K)_\tor \hookrightarrow A_\ell(\FF_\ell).
    \]
\end{lemma}

\begin{proposition}
    Let $J=J_0(N)$ with $N$ prime and $A$ be a simple abelian subvariety of
    $J$. Let $\TT_A:=\Im (\TT\to \End(A)$ be the Hecke algebra of $A$. Let
    $\p\subseteq \TT_A$ be an Eisenstein prime of odd residue characteristic.
    Let $r$ 
\end{proposition}

\begin{corollary}
    Let $A$ be a simple subvariety of $J$ with $\TT_A$ a PID\@. If $\varphi:A\to
    A'$ is an odd-degree isogeny, then
    \[
        A' \cong A/M,
    \]
    with $M$ a $G_\QQ$-submodule of $A[\mathcal{I}]_\odd$.
\end{corollary}

\begin{proposition}
    Let $\p$ be an odd Eisenstein prime. Let $M$ be a submodule supported on
    $\p$. If $A[\p]\not\subseteq M$, then $M\subseteq A[\p]$.
\end{proposition}
\begin{proof}
    Let $K=\QQ(M)$. Let $\q$ be an unramified prime of $K$ of odd residue characteristic
    $\ell$ such that $A$ has good reduction at $\q$ and $\ell$ is a good prime.
    This exists because there are infinitely many good primes while only
    finitely many primes $\q$ where $\q$ is either ramified or $A$ has bad
    reduction at $\q$. By~\ref{},
    \[
        M\subseteq A(K)_\tor \subseteq A[\eta_\ell]
    \]
    The issue is what is $K$? I know that $K$ is a 
\end{proof}

\end{document}

\documentclass[11pt, proquest]{uwthesis}
\setcounter{tocdepth}{1}  % Print the chapter and sections to the toc

\usepackage{url}
\usepackage{hyperref}
\hypersetup{colorlinks=true}
\usepackage{booktabs}
\usepackage{microtype}
\usepackage{tikz-cd}
\tikzset{labl/.style={anchor=south, rotate=90, inner sep=.5mm}}
\include{macros}

\usepackage[inline]{showlabels}

\begin{document}
\prelimpages

\Title{%
    Arithmetic of Totally Split Modular Jacobians and Enumeration of Isogeny
    Classes of Prime Level Simple Modular Abelian Varieties
}
\Author{Kevin Lui}
\Year{2019}
\Program{Mathematics}

\Chair{William Stein}{Professor}{Mathematics}
\Signature{Ralph Greenberg}
\Signature{Bianca Viray}
\Signature{Yen-Chi Chen}

\copyrightpage

\titlepage
\tableofcontents
\listoffigures
\abstract{%
In this thesis, we aim to give algorithms for computing two key invariants of
the modular Jacobians $J_0(N)$.

We first give methods for computing the rational torsion order of rank-0
Jacobians $J_0(N)$ that are isogenous to a product of elliptic curves. We call
these the rank-0 totally split Jacobians. The rational torsion is an important
invariant of the Generalized BSD conjecture so being able to compute the
rational torsion order will provide evidence towards this conjecture. We will
provably enumerate the set of totally split $J_0(N)$, give an algorithm for
computing the rational torsion subgroup, and later give techniques for
computing the rational torsion order for rank-0 totally split Jacobians
$J_0(N)$. 

Next we will give an algorithm for computing the rational isogeny class of a
simple abelian subvariety $A$ of $J_0(N)$ for prime $N$, under mild conditions.
In particular, when the Hecke algebra of $A$ is isomorphic to a maximal order
of a number field, we are able to enumerate the isogeny class. This will allow
us to build a table of isogeny graphs of simple abelian subvarieties of
$J_0(N)$.
}


\textpages


\chapter*{Preface}
\addcontentsline{toc}{chapter}{Preface}

I've have written this thesis with some accessibility in mind. In particular,
my goal was to write a thesis assessable to myself as a second graduate
student. I will assume the reader has taken a graduate level algebra sequence
and have had some exposure to complex abelian varieties and modular forms. For
learning about complex abelian varieties, I recommend the article of Rosen
in~\cite{mr89b:14029}, and for learning modular forms, I recommend the
combination of the books by Stein~\cite{stein:modform} and, Diamond and
Shurman~\cite{diamond-shurman}.

After reading the introduction, an interested expert can skip to
Chapters~\ref{chap:totally_split} and~\ref{chap:isogeny_class}, and
back-reference as needed.

Chapter~\ref{chap:algorithms} has been largely taken from the source code of
\sage and a forthcoming paper by Hao Chen, myself, and William Stein. For the
most part, the algorithms were created and implemented into \sage and \magma~by
William Stein. This chapter is included in this thesis so I am not relying on
currently unpublished work.

Some of the more generic code in this thesis will be merged into
\sage following the completion of this ticket: \url{TODO}. The code used to
generate the tables and the tables themselves can be found here: \url{TODO}

\chapter{Introduction}%
\label{chap:intro}

Let $X_0(N)$ be the modular curve whose non-cuspidal points parameterize
complex elliptic curve with some additional $N$-torsion data. Let
$J_0(N)=\Jac(X_0(N))$ be the Jacobian variety of $X_0(N)$. The study of
$J_0(N)$ has yielded many deep results in arithmetic geometry.

\section{Rational torsion points}%
\label{sec:rational_torsion_points}

The rational torsion subgroup is an 

\section{Rational isogeny class}%
\label{sec:rational_isogeny_class}

%TODO 


\chapter{Theoretical Preliminaries}%
\label{chap:prelim}

\section{Modular Abelian Varieties}

In Chapter~\ref{chap:isogeny_class}, we will discuss enumerating the isogeny
class of simple abelian subvarieties of $J_0(N)$. This leads us to define a
class of abelian variety containing the subquotients of $J_0(N)$.

\begin{definition}
    \label{defn:modabvar}
    Let $A$ be an abelian variety over $\QQ$. Then $A$ is \emph{modular} if
    there exists some $N$ and a finite degree morphism $\phi:A\to J_1(N)$.

    Note that modularity is closed under isogenies, subvarieties, and products.
\end{definition}

The natural quotient of $X_1(N)\to X_0(N)$ induces a finite degree map
$J_0(N)\to J_1(N)$. The kernel of this map, $\Sigma(N)$, is finite and is the
Shimura subgroup of $J_0(N)$. Therefore, all abelian varieties isogenous to a
simple subvariety of $J_0(N)$ are modular.


\section{Galois Representations}

\subsection{$\ell$-adic representation}%
\label{sub:_ell_adic_representation}

Let $B$ be a simple abelian variety over $\QQ$ with an embedding of a number
field $E$ into its endomorphism algebra $\End(B)\otimes \QQ$. By functoriality,
$E$ acts on the on the $\dim B$-dimensional vector space $\mathrm{Lie}(B)$.
Therefore, there is a divisibility bound $\deg E\mid \dim B$. The simple
abelian varieties that achieve this bound are called
\emph{$\GL_2$-type}~\cite[\S 2]{ribet:abvars}. To motivate this definition,
observe that $B[n]\cong (\ZZ/n)^{2\dim B}$ so $V_\ell(B)$ is a rank-2 $E\otimes
\QQ_\ell$-module. Therefore, the $G_\QQ$-action on $V_\ell(B)$ gives the
representation $G_\QQ\to \GL_2(E\otimes \QQ_\ell)$. More generally, we say an
abelian variety is \emph{$\GL_2$-type} if it is isogenous to a product of
simple $\GL_2$-type abelian varieties.

Modular abelian varieties provide a large class of examples of such varieties.
Let $f=\sum a_n q^n$ be a newform of $S_2(\Gamma_1(N))$ and
$K_f=\QQ(\ldots,a_n,\ldots)$ be the \emph{Hecke eigenvalue field} of $f$.
Shimura~\cite[Theorem 7.14]{shimura:intro} associates to $f$ an abelian variety
$A_f$ defined over $\QQ$ and an embedding of $K_f$ into the endomorphism
algebra $\End(A_f)\otimes \QQ$ with $\deg K_f = \dim A_f$.

This shows that every modular abelian varieties is of $\GL_2$-type so a natural
question is whether every $\GL_2$-type abelian variety is modular. Assuming Serre's
modularity conjecture~\cite[3.2.4]{serre:conjectures}, Ribet~\cite[Thm.
4.4]{ribet:abvars} shows that the every $\GL_2$-type abelian variety is
modular. The Serre's modularity has now been proved~\cite{}, so
\begin{theorem}[Khare, Wintenberg]
    Every $\GL_2$-type abelian variety over $\QQ$ is modular.
\end{theorem}

\section{Natural maps}%
\label{sec:natural_maps}

In this section, we will describe some common maps encountered in the study of
modular abelian varieties. We will only give the theoretical description of
these maps. An explicit description that is more readily used for computations
will be described in Section~\ref{sec:alg_natural_maps}.

\subsection{Degeneracy Maps}%
\label{sub:degeneracy_maps}

Let $L\mid N$, $LM=N$, and $t_1,\ldots,t_r$ be the divisors of $M$ in
increasing order. Then, for each $t_i$, there are degeneracy maps relating the
modular curves, forms, and Jacobians of level $L$ and $N$. For ease of
exposition, we will present the $\Gamma_0(N)$ case. The same arguments
generalize easily to $\Gamma_1(N)$.

We first give the more algebraic construction. Recall that the non-cuspidal
points of $X_0(N)$ correspond to elliptic curves with some $N$-torsion data.
The degeneracy map to $X_0(L)$ will forget some of this data. More precisely,
on the non-cuspidal points
\begin{equation}
    \label{eq:degen_moduli}
    \begin{split}
        d_{L,t}: Y_0(N)  \to Y_0(L) \\
        [ E, C_N ]       \mapsto [ E/C_t, C_L ' ],
    \end{split}
\end{equation}
where $C_N$ is a cyclic subgroup of $E$ of order $N$, $C_t$ is the unique
cyclic subgroup of $C_N$ of order $t$, and $C_L '\subseteq C_N/C_t$ is the
unique subgroup of order $L$. By~\cite[Chap. 1, Prop. 6.8]{hartshorne},
$d_{L,t}$ extends uniquely to a map (which we give the same name). By Pic and
Alb functoriality, this induces the maps $d_{L,t} ^*:J_0(L)\to J_0(N)$, $d_{L,
t*} :J_0(N)\to J_0(L)$, respectively.

There is a more complex-analytic construction. Here we will view the
non-cuspidal points of $X_0(N)$ as $\Gamma_0(N)\setminus \h$. Under this
interpretation, \eqref{eq:degen_moduli} becomes
\begin{equation}
    \label{eq:degen_analytic}
    \begin{split}
        d_{L,t}: \Gamma_0(N)\setminus \h \to \Gamma_0(L)\setminus \h \\
        \Gamma_0(N)z\mapsto \Gamma_0(L) tz.
    \end{split}
\end{equation}

There is both a contravariant (Picard) and covariant (Albanese) construction of
the Jacobian. Consequently, we have the following diagram
\[
    here is a diagram.
\]
The bottom map is $p+1$ because of this!! %TODO

% TODO
% \subsection{Hecke operators}%
% \label{sub:hecke_operators}

% The Hecke operators are given by this thing.

\subsection{Endomorphism Ring}

Let $A$ be a simple abelian variety so $A\sim A_f$ for some newform $f=\sum
a_n q^n$. Let $K_f=\QQ(\ldots,a_n,\ldots)$ be the Hecke eigenvalue field of
$f$. By~\cite[Prop. 7.14]{shimura:intro}, the endomorphism algebra
$\End(A_f)\otimes \QQ$ is isomorphic to $K_f$ and is generated as a
$\QQ$-vector space by the Hecke operators. It follows that both the
endomorphism ring and the Hecke algebra of $A_f$ are isomorphic to orders of
$K_f$. Since $A\sim A_f$, the endomorphism ring of $A$ is also isomorphic to an
order of $K_f$.


\subsection{Optimal Elliptic Curves}%
\label{sub:optimal_elliptic_curves}

Let $E$ be an elliptic curve of conductor $N$. By the Modularity Theorem for
elliptic curves~\cite{breuil-conrad-diamond-taylor}. There exists a surjection
$\phi:J_0(N)\onto E$. In general, $\ker\phi$ is not connected. There does
$\phi':J_0(N)\onto E'$ with $E'$ isogenous to $E$ so that $\ker\phi'$ is
connected. By multiplicity one, this $E'$ is unique in its isogeny
class. This leads to the definition of optimal quotients.

\begin{definition}%
    \label{defn:optimal_quotient}
    Let $J$ be the Jacobian of a curve. Then an abelian variety $A$ is an
    \emph{optimal quotient} of $J$, if there exists a surjective morphism $J
    \twoheadrightarrow A$ with connected kernel. Equivalently, $A$ is an
    optimal quotient of $J$ is it is the quotient of $J$ by an abelian
    subvariety.
\end{definition}

If $A$ is an optimal quotient of $J$, then $A^\vee$ can be embedded as a
subvariety of $J$. This particularly useful in the case where $J$ is totally
split because both elliptic curves and Jacobians are self-dual.

\begin{proposition}
    \label{prop:optimal}
    Let $A$ be an abelian variety and $J$ a modular Jacobian. Then $A$ is an
    optimal quotient of $J$ if and only if there exists an injection of
    $A^\vee$ into $J$.

    Suppose $A$ is self-dual. Then
    $A$ is an optimal quotient of $J$ if and only if it is an abelian
    subvariety of $J$.
\end{proposition}
\begin{proof}
    Suppose $A$ is an optimal quotient of $J$. Then by dualizing the sequence
    of abelian varieties~\cite[Proposition 2.4.2]{lange-birkenhake:complex}
    \[
        0 \to C \to J \to A \to 0 \qquad
        0\to A^\vee \to J^\vee \to C^\vee \to 0,
    \]
    there is an injection of $A^\vee\hookrightarrow J^\vee$.

    Conversely, if $A^\vee$ injects into $J$. Then by the Poincar\`{e} Reducibility
    Theorem, the quotient of $J$ by $A^\vee$ is again an abelian variety $C$.
    Then by dualizing the sequence of abelian varieties
    \[
        0 \to A^\vee \to J \to C \to 0 \qquad
        0 \to C^\vee \to J^\vee \to A \to 0,
    \]
    there is a surjection of $J^\vee\cong J\twoheadrightarrow A$ with connected
    kernel $C^\vee$.
\end{proof}

Using the machinery of modular symbols, Cremona has created large databases of
elliptic curves and their invariants, including the $J_0(N)$-optimal curve in
each isogeny class. In this database, the curves are labeled $NXT$, where $N$
is the conductor, $X$ is the isogeny class within that conductor, and $T$ is
the isomorphism class with that isogeny class. When $T=1$, then that curve is
the $J_0(N)$-optimal curve with its isogeny class. For example, the curve
$15a1$ is the $J_0(N)$-optimal curve within the isogeny class $15a$.

We will soon also be interested in $J_1(N)$-optimal elliptic curves. Though the
$J_0(N)$-optimal and $J_1(N)$-optimal curves often agree, this is not always
the case. We can use Algorithm~\ref{alg:weierstrass} to determine the
Weierstrass equation of the $J_1(N)$-optimal curve. Alternatively, we can use
Stevens Conjecture~\cite[Conjecture II]{stevens:param} which states that within
an isogeny class, the $J_1(N)$-optimal curve is the curve of minimal Faltings
height. This conjecture is still open but some progress has been made. Stein
and Watkins~\cite[\S 3]{stein-watkins:ns} have proved Stevens conjecture for
isogeny classes of prime conductor. Vatsal~\cite[Thm.
1.11]{vatsal:multiplicative} has proved Stevens conjectures for isogeny classes
containing an elliptic curve $E$ such that for some prime $\ell\geq 7$,
$E[\ell]$ is reducible and $E$ is ordinary at $\ell$.

\section{Old subvariety}%
\label{sec:old_subvariety}

Let $L$ be a proper divisor of $N$ and $t_1,\ldots,t_r$ be divisors of $N/L$ in
some order. For each divisor $t_i$, the degeneracy map
(\ref{sub:degeneracy_maps} $\delta_i$ gives an
embedding $\delta_{i} ^*:J_0(L)\to J_0(N)$. We now gather all the degeneracy
maps coming from $J_0(N)$ to define
\[
    \Phi_L ^N = \prod_{i=1} ^r \delta_{t_i} ^* : J_0(L)^r \to J_0(N).
\]
The \emph{old subvariety} of $J_0(N)$ is $\sum_{L\mid N} \Im\Phi_L ^N$ and the
\emph{$N/L$-old subvariety} is $\Im\Phi_L ^N$.

There is a strong relationship between $\ker \Phi_L ^N$ and
\[
    \Sigma(L)_0 ^r =\{(x_1,\ldots,x_r)\in \Sigma(L)^r: \sum x_i = 0\}.
\]
Because degeneracy maps agree on the Shimura subgroup~\cite[Theorem
4]{ling-oesterle:shimura}, $\Sigma(L)_0 ^r \subseteq \ker\Phi_L ^N$. The reverse
equality was established by Ribet when $M$ a prime coprime to $L$ and was
generalized by Ling to:
\begin{theorem}[{\cite[Prop. 1]{ribet:raising}\cite[Thm. 3]{ling:shimura}}]
    \label{thm:ribet-ling}
    Let $L$ and $M$ be relatively prime integers with $M$ squarefree. Let
    \[
        \Phi_L ^N = \prod_{i=1} ^r d_{L,t_i} ^* : J_0(L)^r \to J_0(LM)
    \]
    be as defined above. Then
    \begin{enumerate}
        \item
            If $L$ is odd or $M$ is prime, then $\Sigma(L)_0 ^r=\ker\Phi_L ^N$.
        \item
            If $L$ is even and $M$ is not a prime, then $[\ker\Phi_L ^N:
            \Sigma(L)_0 ^r]$ is a power of 2.
    \end{enumerate}
\end{theorem}

However, when $\ker\Phi_L ^N = \Sigma(L)_0 ^r$, there is an useful direct sum
decomposition of $\Im\Phi_L ^N$, especially when $J_0(L)$ is an elliptic curve.

\begin{corollary}
    \label{cor:elliptic_decomp}
    Suppose that $\ker\Phi_L ^N = \Sigma(L)_0 ^r$ and $E=J_0(L)$ is an elliptic
    curve. Then there is a $\QQ$-isomorphism
    \[
        \Im\Phi_L ^N \cong E \times F^{r-1},
    \]
    where $F$ is the $J_1(L)$-optimal curve in the isogeny class of $E$.
\end{corollary}
\begin{proof}
    This follows from Proposition~\ref{prop:decomp} and
    Proposition~\ref{prop:optimal}.
\end{proof}

This decomposition is particularly useful because the $J_0(L)$-optimal curves
are identified in Cremona's table and the $J_1(L)$-optimal curves can be
identified using Steven's conjecture. For example, using this decomposition,
$J_0(22) = J_0(22)_\old \cong E\times F$, where $E$ is the $J_0(11)$-optimal
curve and $F$ is the $J_1(11)$-optimal curve (in this case, $E=J_0(11)$ and
$F=J_1(11)$). So computing the BSD invariants of $J_0(22)$ amounts to computing
the BSD invariants of the elliptic curves $E$ and $F$.

\begin{proposition}
    \label{prop:decomp}
    Suppose $\ker\Phi_L ^N=\Sigma(L)_0 ^r$. Then there is a $\QQ$-isomorphism
    \[
        \Im\Phi_L ^N \cong J_0(L)\times \Im(J_0(L)\to J_1(L))^r.
    \]
\end{proposition}
\begin{proof}
    Let $e$ be the exponent of $\Sigma(L)$. For $i=1,\ldots,r-1$, let $m_i$ be
    integers so that $m_i \equiv 1 \pmod{e}$. Define $D_i:J_0(L)\to J_0(N)$ by
    \[
        D_i =
        \begin{cases}
            \delta_i                    & \text{if } i = 1\\
            \delta_i - m_i \delta_{i-1} & \text{if } 2\leq i \leq r.
        \end{cases}
    \]
    We first show $\Im\Phi_L ^N = \bigoplus_{i=1} ^r \Im D_i$.

    Define $\Phi_L ^N =\prod_{i=1} ^r D_i : J_0(L)^r \to J_0(N)$. We have that
    $\Phi_L ^N = \Phi_L ^N \circ T$, where
    \begin{align*}
        T:J_0(L)^r & \to J_0(L)^r \\
        (x_1,x_2,\ldots,x_r)&\mapsto (x_1-m_2x_2,x_2-m_3 x_3,\ldots,x_{r-1}-m_r
        x_r, x_r).
    \end{align*}
    The matrix associated to $T$ is consisted of $1$'s along the diagonal and
    $m_i$'s along the superdiagonal. The determinant is 1 so
    \[
        \sum_{i=1} ^r \Im D_i = \Im \Phi_L ^N.
    \]

    The goal is to now show that this sum is direct. Let $y_1,\ldots,y_r\in
    J_0(L)$. Suppose
    \begin{equation}
        \label{eq:phiLprime}
        \Phi_L ^N (y_1,\ldots,y_r) =D_1(y_1)+ \cdots +D_r(y_r)=0.
    \end{equation}
    Then that $T(y_1,\ldots,y_r)\in \ker\Phi_L ^N=\Sigma(L)_0 ^r$.  This
    immediately implies that $y_r\in \Sigma(L)$ and then, by repeated
    back-substitution, $y_i\in \Sigma(L)$ for $i=1,\ldots,r$. Since $m_i \equiv
    1 \pmod{e}$,
    \[
        T(y_1,\ldots,y_r)=(y_1-y_2,y_2-y_3,\ldots,y_{n-1}-y_n,y_n).
    \]
    Since $T(y_1,\ldots,y_r)\in \Sigma(L)_0 ^r$,
    \[
        (y_1-y_2)+(y_2-y_3)+\cdots+(y_{n-1}-y_n)+y_n =0.
    \]
    This implies that $y_1=0$ so $D_1(y_1)=0$. Moreover, for $i=2,\ldots,r$,
    \begin{equation*}
        D_i(y_i)
            = \delta_{i-1}(-y_i) + \delta_i (y_i)
            = \Phi_L ^N (0,\ldots,0,-y_i,y_i,0,\ldots,0)
            = 0,
    \end{equation*}
    where the last equality follows from the fact
    $(0,\ldots,0,-y_i,y_i,0,\ldots,0)\in \Sigma(L)_0 ^r$. Therefore, the terms
    in~\eqref{eq:phiLprime} are trivial so $\sum \Im D_i$ is direct.

    It remains to show $D_1(J_0(L))\cong J_0(L)$ and $D_i(J_0(L))\cong
    \Im(J_0(L)\to J_1(L))$ for $i\geq 2$. Notice that
    $D_1(x)=\Phi_L ^N(x,0,\ldots,0)$ and $D_i(x)=\Phi_L ^N(\ldots,-m_ix,x,\ldots)$.
    Since $\ker\Phi_L ^N=\Sigma(L)_0 ^r$, $\ker D_1=0$ and $\ker D_i=\Sigma(L)$
    for $i\geq 2$, as desired.
\end{proof}


\section{Connectedness of Hecke Algebra}%
\label{sec:connectedness_of_hecke_algebra}

Mazur~\cite[Prop. 10.6]{mazur:eisenstein} proves that the Hecke Algebra
$\TT(N)$ for $J_0(N)$ with $N$ prime is connected. This was done by showing any
direct product decomposition of $J_0(N)$ with $N$ prime contradicts the
irreducibility of the $\theta$-divisor. This was surprising to the author
as~\ref{cor:elliptic_decomp} gives a direct sum decomposition of $J_0(22)$. In
this section, we dissect Mazur's proof and give a mild generalization.
Moreover, we will explain why Mazur's argument fails in the composite case.

\subsection{General results for semistable Jacobians}

We will begin with some fairly general results. So assume $J$ is a semistable
Jacobian defined over $\QQ$ that is possibly not $J_0(N)$. By~\cite[Corollary
1.4]{ribet:endo}, isogenies, endomorphisms, and abelian subvarieties (a priori
defined over $\QQbar$) are defined over $\QQ$. In this section, we use this
fact freely and will make no reference to the field of definition.

\begin{theorem}
    \label{thm:theta_irred}
    Any Jacobian $J$ taken with its principal polarization cannot be decomposed
    into a nontrivial direct sum of principally polarized abelian varieties.
\end{theorem}
\begin{proof}
    Any such decomposition will give a decomposition of the $\Theta$-divisor
    attached to $J$ which contradicts the irreducibility of the
    $\Theta$-divisor~\cite[\S 4(a)]{kempf:riemann}.
\end{proof}

\begin{lemma}
    \label{lem:decomp_isogeny}
    Suppose $J$ decomposes nontrivially as the direct sum of abelian subvarieties
    $A\oplus B$. Then $A$ must share an isogenous factor with $B$.
\end{lemma}
\begin{proof}
    We proceed via contradiction. Suppose $A$ and $B$ share no isogenous
    factors. Let $\lambda:J\to \hat{J}$ be the principal polarization induced
    by its $\Theta$-divisor. Since $A$ shares no isogenous factors with $B$,
    $\lambda(A)=\hat{A}$ so $\lambda|_A$ is a polarization of $A$. Similarly,
    $\lambda|_B$ is a polarization of $B$. This now contradicts
    Theorem~\ref{thm:theta_irred}.
\end{proof}

\begin{lemma}
    \label{lem:faithful}
    Let $R$ be a ring acting faithfully on $J$. Let $S=\{A_1,\ldots,A_k\}$ be a
    set of representatives of the isogeny class of subvarieties of $J$.
    Suppose that for all $A\in S$, and every idempotent $r\in R$, either
    $rV_A=0$ or $rV_A=V_A$. Then $\Spec R$ is connected.
\end{lemma}
\begin{proof}
    Recall that $\Spec R$ is connected if and only if $R$ contains an
    idempotent $r$ different from $0$ or $1$. We proceed via by contradiction.
    Let $r\in R$ be an idempotent different from $0$ or $1$. Then $K = rK
    \oplus (1-r) K$ is a decomposition of $K$ into subvarieties. Moreover, this
    decomposition is nontrivial because $R$ acts faithfully.

    Let $S_1=\{A\in S:rV_A=V_A\}$ and $S_2=\{A\in S:(1-r)V_A=V_A\}$. Observe
    that $r$ and $1-r$ kill every element of $S_2$ and $S_1$, respectively, so
    $S=S_1\sqcup S_2$. We can rewrite the previous decomposition as
    \[
        J
        = rJ \oplus (1-r)J
        = \left(\sum_{A\in S_1} V_A \right)
        \oplus \left(\sum_{A\in S_2} V_A \right).
    \]
    The big summands share no isogenous factors which contradicts
    Lemma~\ref{lem:decomp_isogeny}.
\end{proof}

\subsection{Application to modular abelian varieties}

The goal now is to apply Lemma~\ref{lem:faithful} to the case of semistable
$J$ and subrings of the Hecke algebra $\TT$. Recall that the action of the
Hecke algebra on $J$ is faithful.

\begin{proposition}\label{prop:new_jacobian_connected}
    Suppose that $J=J_{\new}$. Then $\Spec\TT$ is connected.
\end{proposition}
\begin{proof}
    When all subvarieties are new, they appear with multiplicity 1 so the
    conditions of Lemma~\ref{lem:faithful} are automatic.
\end{proof}

\begin{proposition}
    Suppose $\TT'$ is the anemic Hecke algebra for $J$. Then $\Spec\TT'$ is
    connected.
\end{proposition}
\begin{proof}
    By Lemma~\ref{lem:faithful}, it suffices to show that for any newform
    $f$, and $r\in \TT'$, $rV_f=V_f$ or $rV_f=0$. Fix a newform $f$ of level
    $L$ and $r\in \TT'$. We now abuse notation by overloading $T_\ell$ and $r$
    as operators on $A_f$, $A_f^s$, and $J$. In the Formulaire section
    of~\cite{ribet:old}, for $\ell\nmid N$, $T_\ell\circ \phi=\phi\circ T_\ell$
    when $N$ is prime. However, this is also true with $N$ squarefree since
    $T_\ell$ commutes with the pushforward and pullback of any degeneracy map
    $\delta_d$ with $d\mid N$. So for any prime $\ell\nmid N$,
    \[
        T_\ell(\Phi_f(x_1,\ldots,x_s))
        = \Phi_f(T_\ell(x_1),\ldots,T_\ell(x_s)).
    \]
    It follows that
    \[
        r(\Phi_f(x_1,\ldots,x_s))
        = \Phi_f(rx_1,\ldots,rx_s).
    \]
    Therefore,
    \[
        rV_f = r(\Phi_f(A_f)) = \Phi_f(rA_f,\ldots,rA_f)
    \]
    but $A_f$ is simple so either $rA_f=A_f$ or $rA_f=0$. Therefore, by
    Lemma~\ref{lem:faithful}, $\Spec\TT'$ is connected.
\end{proof}

\begin{example}
    When $N$ is prime, the argument Mazur~\cite[Prop. 10.6]{mazur:eisenstein}
    gives is essentially the same as
    Proposition~\ref{prop:new_jacobian_connected}. We see that this fails for
    $J=J_0(22)$ since $J=d_1(J_0(11))+d_2(J_0(11))$ so the factors appear with
    multiplicity greater than 1.

    Using \sage, we can show that the Hecke algebra of $J_0(22)$ is isomorphic
    to $\ZZ[i]$ and is thus connected. On the other hand,
    by~\ref{cor:elliptic_decomp}, $J_0(22)$ is the direct product of elliptic
    curves so the endomorphism ring is not connected.
\end{example}


\section{Subvarieties of $J_0(N)$}%
\label{sec:subvarieties_of_j_0_n_}

In this section, we will prove that every abelian subvariety of $J_0(N)$ is the
image of degeneracy map and discuss some interesting questions arising from
this.

\begin{proposition}
    \label{prop:integral_degen}
    Let $A$ be a simple subvariety of $J_0(N)$. There exists a divisor $L$ of
    $N$ and a newform $f$ of level $L$ such that $A_f \sim A$. Let
    $d_1,\ldots,d_r$ be the full collection of degeneracy maps from $J_0(L)$ to
    $J_0(N)$. Then there exists integers $n_1,\ldots,n_r$ such that $S:=\sum
    n_i d_i|_{A_f}: A_f\to A$ is an isogeny from $A_f$ to $A$. Note that $S$ is
    defined over $\QQ$.
\end{proposition}
\begin{proof}
    Let $V_f=\sum_{i=1} ^r d_i(A_f)$ and $\Phi:A_f ^r \to V_f$ be defined by
    $D(x_1,\ldots,x_r) = d_1(x_1)+\cdots+d_r(x_r)$. Let $K_f$ be the Fourier
    coefficient field of $f$. Since $A$ is an abelian subvariety of $V_f$, there
    exists $M\in \End_0(V)\cong M_r(\End_0(A_f)) = M_r (K_f)$ such that $\Im M
    = A$. Let $i:A_f\to A_f ^r$ be the inclusion map into the first coordinate.
    Then there exists $U\in \Aut(A_f ^r)=\GL_r (K_f)$ such that,
    \[
        \begin{tikzcd}
            A_f \arrow[r,"i"] &
            A_f ^r \arrow[r, dotted, "U"] &
            A_f ^r \arrow[r, "D"] &
            V_f \arrow[r, "M"] &
            A,
        \end{tikzcd}
    \]
    the map $T:=M \circ \Phi \circ U\circ i:A_f\to A\in \Hom_0(A_f, A)$ is
    nonzero. Since degeneracy maps are $K_f$-linear, there exists coefficients
    $a_1,\ldots,a_r\in K_f$ such that $T = \sum a_i d_i$. Now there exists
    $b\in \ZZ^*$ such that $T':=bT\in \Hom(A_f, A)$ is nonzero and hence an
    isogeny. Since $T'(\Lambda_{A_f})\subset \Lambda_A$, $T'=\sum q_i d_i$
    for $q_i\in \QQ$. Finally, there exists $w\in \ZZ^*$ such that
    $S:=wT'=\sum n_i d_i$ with $n_i\in \ZZ$.
\end{proof}


\begin{proposition}
    \label{prop:star_eisenstein}
    Suppose $(L, N)$ satisfies the $\star$-condition. Then $\ker S\subseteq
    \Sigma(L)$. In particular, this isogeny is Eisenstein.
\end{proposition}
\begin{proof}
    Suppose $x\in \ker S$. Then $(n_1 x, \ldots, n_r x)\in \ker\Phi_L ^N =
    \Sigma(L)_0 ^r$. Hence, $n_i x\in \Sigma(L)$ for all $i$. Since
    $\gcd(n_1,\ldots,n_r)=1$, $x\in \Sigma(L)$.
\end{proof}

\begin{question}
    \label{question:iso}
    Let $A$ be a simple subvariety of $J_0(N)$ for some $N$. Let $\mathcal{I}$
    be the isogeny class of $A$. For all $B\in \mathcal{I}$, is $B$ a
    subvariety of $J_0(M)$ for some $M$?
\end{question}

\begin{example}
    Suppose $I$ is a Neumann-Setzer isogeny class of elliptic curves of
    conductor $p$. Then there are exactly 2 elliptic curves $E_0$ and $E_1$,
    where $E_0$ is $J_0(p)$-optimal and $E_1$ is $J_1(p)$-optimal
    (Stein-Watkins). Viewing $E_0$ as a subvariety of $J_0(p)$ and taking $q$
    to be a prime distinct from $p$, we have
    \[
        E_1 \isom \Im (d_1-d_q)(E_0)\subseteq J_0(pq),
    \]
    where $d_1, d_q:J_0(p)\to J_0(pq)$ are the natural degeneracy maps. This
    gives an affirmative answer to Question~\ref{question:iso} in the
    Neumann-Setzer isogeny class case.
\end{example}


\begin{question}
    Let $M$ be a $\Gal(\QQbar/\QQ)$-submodule of $J_0(L)$. Does there exists
    $N$ and an integral linear combination of degeneracy maps $S:=\sum n_i d_i$
    such that $\ker S=M$?
\end{question}

\begin{question}
    Is $\ker S$ always Eisenstein? This is true under the $\star$-condition.
\end{question}

\chapter{Algorithms for modular abelian varieties}%
\label{chap:algorithms}


In this chapter, we will review algorithms on modular abelian varieties.

\section{Defining Data}%
\label{sec:defining_data}

We represent modular abelian varieties explicitly as follows. Let $A$ be a
modular abelian variety and $\varphi:A\to J$ a finite degree morphism. Let
$B$ be the image of $A$ in $J$. Then there is an isogeny $B$ to $A$ with kernel
$G$ such that $A\cong B/G$.
\begin{equation}
    \label{eq:defining_data}
    \begin{tikzcd}
        &
        &
        A \arrow[d]\arrow[dr,"\varphi"] &
        &
        &
        \\
        0 \arrow[r] &
        G \arrow[r] &
        B \arrow[r] &
        J \arrow[r] &
        0
    \end{tikzcd}
\end{equation}
So we can represent any modular abelian variety $J$ by giving $G\subseteq
B\subseteq J$ all defined over $\QQ$.

\begin{itemize}
    \item
        We will represent $J$ by giving a modular
        symbol basis for $H_1(J, \ZZ)$ and $H_1(J, \QQ) = H_1(J, \ZZ)\otimes
        \QQ$ (Section~\ref{sec:modular_symbols}).
    \item
        We will represent $B$ as an abelian subvariety of $J$ as follows. The
        inclusion of $B\subseteq J$ induces an inclusion of rational homology
        $V=H_1(B, \QQ)$ into $H_1(J, \QQ)$ and $B$ is determined by this
        inclusion. Therefore, we specify $B$ by a basis in reduced echelon form
        for the subspace $V$. Of course, not every subspace of $H_1(J, \QQ)$
        corresponds to an abelian subvariety. In
        Algorithm~\ref{sec:decomp_verify}, we give a method for determining
        exactly when a subspace of $H_1(J, \QQ)$ corresponds to the rational
        homology of an abelian subvariety.
    \item
        We will represent $G$ as a finite subgroup of $B$ as follows. Let
        $\Lambda=V\cap H_1(J, \ZZ)$. Then the torsion subgroup of $B$ is given
        by $B(\CC)_\tor=V/\Lambda$. Therefore, we represent $G$ as specifying a
        Hermite normal form basis for the lattice $L$ with $\Lambda \subseteq L
        \subseteq V$.
\end{itemize}

Therefore, we can represent any modular abelian variety $A$ with the triplet
$(L, V, J)$ with the properties $J=J_1(N)$ for some $N$, $V\subseteq H_1(J,
\QQ)$, $L$ a lattice containing $V\cap H_1(J, \ZZ)$. Since the $\QQ$-span of
$L$ is $V$, $V$ can be recover from $L$ so $A$ can also be specified by $(L,
J)$.

\section{Modular Symbols}
\label{sec:modular_symbols}

Modular symbols give a finite presentation for the homology group $H_1(X_0(N),
\ZZ)$.

\section{Natural Maps}%
\label{sec:alg_natural_maps}
The Hecke operators~\cite[\S 8.3]{stein:modform}, degeneracy maps~\cite[\S
8.6]{stein:modform}, and star involution~\cite[\S 8.5]{stein:modform} are
useful maps defined on modular symbols which, in turn, induce maps on the
Jacobian. For example, %TODO.

\subsection{Decomposition and Verification of an Abelian Subvariety}
\label{sec:decomp_verify}

As mentioned in Section~\ref{sec:defining_data}, not every subspace $V$ of
$H_1(J, \QQ)$ corresponds to an abelian subvariety of $J$. In this section, we
will give an algorithm for verifying when $V$ corresponds to an abelian
subvariety. This algorithm will also give a decomposition of $V$ into simple
subvarieties.

\begin{algorithm}{Decomposing and Verifying Abelian Subvarieties}
    \label{alg:decomp_and_verify_subvarieties}
    Let $J=J_H(N)$ and $V$ be a subspace of $H_1(J, \QQ)$. If $V$ corresponds
    to a subvariety $A$ of $J$, then this algorithm will return a decomposition
    into simples $X_i=(V_i, J)$ of $A$, otherwise, this algorithm will return
    'NO'. Let $\T=\{T_1,\ldots\}$ be the Hecke algebra of $J$.
    \begin{enumerate}
        \item{} [Decompose into potential Hecke eigenspaces]
            We first decompose $V$ into a direct sum $V=W_1\oplus \cdots \oplus
            W_r$ so that, for each $W_i$, there exists a newform $f_i$ of level
            dividing $N$, such that either $W_i$ either corresponds to an
            abelian subvariety isogenous to a power of $A_{f_i}$ or is not an
            abelian subvariety and we can return 'NO'.
            \begin{enumerate}
                \item{} [Initialize]
                    Set $j=1$.
                \item{} [Decompose into eigenspaces]
                    Compute the simultaneous eigenspaces $U_{j,1},\ldots,U_{j,
                    n_j}$ of $\{T_1,\ldots,T_j\}$. If $\sum_{k=1} ^{n_j}
                    U_{j, k}\neq V$, return 'NO'.
                \item{} [Compare with newforms]
                    Let $S_{j,k}$ be the set of newforms whose $l$th Fourier
                    coefficient agrees with the eigenvalue of $T_l$ on $U_{j,
                    k}$ for $l=1,\ldots,j$. If $S_{j, k}$ is empty for any
                    $k=1,\ldots,n_j$, return 'NO". If $S_{j,k}$ is not
                    singleton for any $k=1,\ldots, n_j$, increment $j$ and
                    return to (b). Otherwise, $S_{j,k}$ is singleton for all
                    $k$ so let $S_{j,k}=\{f_k\}$ and $W_k=U_{j,k}$.
            \end{enumerate}
        \item{} [Is isogenous to power?]
            We now verify that each $W_i$ is isogenous to a power of $A_{f_i}$
            and give its decomposition. The $W_i$'s are pairwise non-isogenous
            so we will do this individually for each $W_i$ and consider just a
            single pair $W$ and $A_f$ with $f$ being a newform of level $L$.
            Let $d_1,\ldots,d_r:J_H(L)\to J_H(N)$ be the full collection of
            degeneracy maps from $J_H(L)$ to $J_H(N)$.  Set $U=\{0\}$.
            \begin{enumerate}
                \item{} [Image of $\QQ$-combination of $d_j$'s?]
                    Choose any $v\in V\setminus U$. By
                    Proposition~\ref{prop:integral_degen}, if $W$ is an abelian
                    subvariety then there exists $q_1,\ldots,q_r\in \QQ$
                    such that $v\in \Im \left(\sum_{i=1} ^r q_i
                    \delta_i\right)$. If this is not the case, return
                    'NO'. Let $R = \Im \left(\sum_{i=1} ^r q_i
                    \delta_i\right)$. If $R\not\subset V$, return 'NO'.
                \item{} [Full space?]
                    Replace $U$ with $U+R$. If $V=U$, we are done. Otherwise,
                    return to (b).
            \end{enumerate}
    \end{enumerate}
\end{algorithm}
\section{Cuspidal subgroup and rational cuspidal subgroup}

The cusps of $X_H(N)$ are the equivalence classes of $\P^1(\QQ)$ under
$\Gamma_H(N)$. We will denote the elements by $[x/y]_{\Gamma_H(N)}$. The
\defn{cuspidal subgroup} $C$ of $J$ is the subgroup of degree-0 divisors
$(\alpha)-(\beta)$ where $\alpha, \beta$ are cusps on $J$. More generally, if
$A=(L, V, J)$ is a modular abelian variety that is the quotient of $B$ by $L$.
Then the cuspidal subgroup of $A$ is defined to be $(C\cap B)/L$, where $C$ is
the cuspidal subgroup of $J$.

The Galois structure of the cuspidal subgroup is well-understood~\cite[\S
1.3]{stevens:thesis}. The points of the cuspidal subgroup are
$\QQ(\mu_N)$-rational under the following Galois action. There is an abstract
group homomorphism $\Gal(\QQ(\mu_N)/\QQ)\cong \ZZ/N\ZZ)^*$, let
\[
    \sigma_d\in \Gal(\Q(\mu_N)/\Q):\mu_N\mapsto \mu_N ^d
\]
then
\[
    \sigma_d([x/y]_{\Gamma_1})=[x/d'y]_{\Gamma_1},
\]
where $dd'\equiv 1 \mod{N}$. This explicit description of the Galois action
\emph{rational cuspidal subgroup} $C(\QQ):=C^{\Gal(\QQ(\mu)/\QQ)}$.

\section{Shimura subgroup}

Let $\Sigma(N)$ be the Shimura subgroup of $J_0(N)$ so $\Sigma(N)$ is the
kernel of the natural map $J_0(N)\to J_1(N)$. To compute $\Sigma(N)$, we will
use a theorem by Ribet. We will choose some odd prime $p$ coprime to $N$,
by~\cite[Prop. 1]{ribet:raising}, $\Sigma(N)=\ker(d_1-d_p)$, where
$d_1,d_p:J_0(N)\to J_0(pN)$ are the degeneracy maps corresponding to $1,p$.

\section{Simple abelian subvarieties as image of degeneracies}
\begin{algorithm}{Simple abelian subvarieties as image of degeneracies}%
    \label{alg:simple_degen}
    Given a simple abelian subvariety $A\subseteq J_0(N)$. This algorithm
    gives a newform $f$ and a linear combination of degeneracy maps
    $\phi=\sum n_i d_i:J_0(L)\to J_0(N)$ such that $\phi(A_f)=A$ with $L$ the
    level of $f$.
    \begin{enumerate}
        \item{} [Decompose]
            Use Algorithm~\ref{alg:decomp_and_verify_subvarieties} to obtain
            the decomposition $J_0(N)=\sum_f V_f$, where the sum runs over
            newforms $f$ of level dividing $N$ and $V_f$ is the sum of all
            abelian subvarieties of $J_0(N)$ isogenous to $A_f$.
        \item{} [Determine newform]
            Find the newform $f$ of level $L$ so that $A\subseteq V_f$.
        \item{} [Basis under degeneracy]
            Let $\{b_1,\ldots,b_r\}$ be a $\ZZ$-basis for $\Lambda_{A_f}$ and
            $\{d_1,\ldots,d_s\}$ be the set of degeneracy maps $d_j:J_0(L)\to
            J_0(N)$.
        \item{} [Solve system]
            Let $x$ be any nonzero element element of $\Lambda_A$. Find
            $c_{ij}\in \QQ$ such that $x=\sum c_{ij} d_j(b_i)$.
        \item{} [Output]
            Let $i', j'$ be such that $c_{i'j'}\neq 0$. Let
            $(n_1,\ldots,n_s)\in \ZZ^s$ be the vector obtained by
            clearing denominators from $(c_{i'1},\ldots,c_{i's})$.
    \end{enumerate}
\end{algorithm}


\begin{algorithm}{Weierstrass equation of 1-dimension abelian subvariety}%
    \label{alg:weierstrass}
    Given a simple 1-dimensional subvariety $E$ of $J_0(N)$. This algorithm
    returns the Weierstrass equation for $E$.
    \begin{enumerate}
        \item{}
            [Isogeny from optimal subvariety] Use
            Algorithm~\ref{alg:simple_degen} to find a newform $f$ of level
            $L$ and isogenies $\phi:A_f\to E$.
        \item{}
            [Weierstrass of optimal subvariety] The Cremona tables contain the
            Weierstrass equations for optimal subvarieties of $J_0(L)$ so in
            particular, for $A_f$.
        \item{}
            [Kernel] Compute the kernel $M$ of $\phi$ and use the complex
            exponential map to identify $M$ as a set of points, $M'$ on the
            Weierstrass equation for $A_f$.
        \item{}
            [Velu's formulas] Output the Weierstrass equation of $A_f/M'$ using
            Velu's formulas.
    \end{enumerate}
\end{algorithm}



% \section{Homomorphism spaces}
%TODO: take from modabvar?

\section{Isogeny and isomorphism testing}

In this section, we give an algorithm for determining when a pair of simple
modular abelian varieties are isomorphic.

\begin{algorithm}{Isomorphism testing}%
    \label{alg:isomorphism_testing}
    Given simple modular abelian varieties $A, B$, this algorithm determine if
    $A, B$ are isomorphic. If so, this algorithm will also return an
    isomorphism between $A, B$.
    \begin{enumerate}
        \item{}
            [Isogenous?] Use Algorithm~\ref{} to find newforms $f,g$ and
            isogenies $\phi_f:A_f\to A$ and $\phi_g:A_g\to B$. If $f\neq g$,
            return `not isomorphic'. Otherwise, let $\phi:B\to A=\phi_g ^\vee
            \circ \phi_f$.
        \item{}
            [Square degree?] The composition $\phi^\vee \circ \phi:B\to B$ is
            the multiplication by $d$ map where $d$ is the degree of $\phi$. If
            $d$ is not square, return `not isomorphic'.
        \item{}
            [Endomorphism algebra] Use Algorithm~\ref{} to find a number field
            $K$, an order $\O\subseteq K$, and an isomorphism $\tau:\End(A)\to
            \O$.
        \item{}
            [$\Hom(A, B)$] Use Algorithm~\ref{} to compute $\Hom(A,B)$.
        \item{}
            [Image under $\phi$] Compute the image $H_f$ of $\Hom(A, B)$ in
            $\End(A)$ by composing with $f$.
        \item{}
            [Norm equation] Find solutions $x_1,\ldots,x_r$, up to units in
            $\O$, to the norm equation $\Norm_{\O} (x) = \pm \sqrt{d}$. If
            there are no solutions, return `not isomorphic'.
        \item{}
            [Isomorphic?] For each solution $x_i$, determine if $x_i\in H_f$,
            if so, $x_i \circ f^{-1}$ is an isomorphism from $A\to B$. If
            $x_i\notin H_f$ for all $x_i$, then return `not isomorphic'.
    \end{enumerate}
\end{algorithm}
\begin{proof}
    prove this
\end{proof}

\chapter{Totally Split Jacobians}%
\label{chap:totally_split}

A Jacobian is said to be \emph{totally split} if it is $\QQ$-isogenous to a
product of elliptic curves. The classification and construction of totally
split Jacobians of genus 2 curves has been
well-studied~\cite{bruin-doerksen:split_genus_two,kuhn:split_genus_two}
and large rational torsion subgroup of totally split Jacobians of genus 2 and 3
curves have been found~\cite{howe-leprevost-poonen:large}. The original
motivation of this project was to compute the rational torsion subgroup for as
many $J_0(N)$ as possible. The first $N$ for which Sage fails is $J_0(30)$
which happens to be a product of 3 elliptic curves. The author and his adviser
were able to compute the rational torsion subgroup using the fact that
$J_0(30)$ is totally split, the fact that rational torsion subgroups of
elliptic curves can be computed, and Galois cohomology. The goal of this
section is to prove that there are finitely many totally split $J_0(N)$, to
give a general (but totally impratical) method for computing the rational
torsion subgroup, and to present some more practical techniques for computing
the rational torsion subgroup.


\section{Provably enumerating the set of totally split $J_0(N)$}

The modular Jacobian $J_0(N)$ is totally split if and only if all newforms of
level dividing $N$ have rational Hecke coefficients. We expect this to be rare.
In fact, there are only finitely many totally split $J_0(N)$. Ralph Greenberg
quickly gave an argument on the way to UW Number Theory Seminar lunch proving
the set of totally split $J_0(N)$ is finite but his argument did not give an
effective method of enumeration. Moreover, at Sage Days 87, Alyson Dienes
suggested proving this using asymptotic bounds.
\begin{proposition}%
    \label{prop:totally_split}
    The set of totally split $J_0(N)$ is finite.
\end{proposition}
\begin{proof}
    If $J_0(N)$ is a product of elliptic curves then the dimension is
    exactly equal to the number of elliptic factors.
    \begin{itemize}
        \item
            By~\cite[Thm. 6]{martin:dimension}, the dimension is bounded below
            by $\frac{1}{12}N + O(\sqrt{N}\log\log N)$.
        \item
            By~\cite[Cor. 2]{brumer-silverman:number}, the number of elliptic
            curve factors of $J_0(N)$ is bounded above by $O(N^{1/2+\epsilon})$
            for any $\epsilon>0$.
    \end{itemize}
    Asymptotically, the lower bound will surpass the upper bound so there are
    finitely many totally split $J_0(N)$.
\end{proof}
Neither of their arguments gave an effective method of enumeration. The goal of
this subsection is to provably enumerate the set of $J_0(N)$ that are totally
split. There are 71 of totally split $J_0(N)$ that are nontrivial (see
Table~\ref{tab:split}).


We have that $J_0(N)$ is totally split if and only if its dimension is equal to
the number of (modular) elliptic curves of conductor $N$. If $N$ is less than
the upper limit of conductors in the Cremona Database, then determining whether
$J_0(N)$ is totally split is a quick computation since there is a closed-form
formula for $\dim J_0(N)$.

\begin{lemma}
    \label{lem:good_primes}
    The only possible primes $p$ where $J_0(p)$ is totally split are
    \[
        2, 3, 5, 7, 11, 13, 17, 19, 37.
    \]
\end{lemma}
\begin{proof}
    Let $J=J_0(p)$ be a totally split Jacobian of prime level. If $\dim J=0$,
    then $J$ is clearly totally split so assume $\dim J>0$. Then $J\cong
    \prod_f E_f$ with $E_f$'s elliptic curves of conductor $p$. Let $n$ denote
    the order of the rational cuspidal subgroup of $J$ which is, as mentioned
    above, known to be the numerator of $(p-1)/12$. By Emerton's proof of
    Stein's refined Eisenstein conjecture~\cite[Theorem B]{emerton:optimal}, if
    $l$ divides $n$, then $l$ divides the order of $E_f(\QQ)$ for some elliptic
    factor of $J$. But elliptic curves of prime conductor do not have much
    rational torsion.

    In particular, Miyawaki~\cite{miyawaki:ell_prime} enumerates all curves of prime
    power conductor with odd-order rational torsion. The largest prime
    conductor here being 37. This implies that if $p>37$, then $\#C(\QQ)$ must
    be a power of 2 so $p=2^a 3^b + 1$ for some $a\geq 0$ and $b\in \{0,1\}$.
    We now show $a\leq 2$.

    If $a>2$, then $C(\QQ)$ has an order 2 element which implies some $E_i$ has
    a rational 2-torsion point. As a result of Setzer~\cite[Theorem
    2]{setzer:ell_prime}, $p=17$ or $p=u^2+64$ for some integer $u$. We split into 2
    cases to show that $p$ is never $u^2+64$.

    Suppose $b=0$. Then $p$ is a Fermat prime and thus a Fermat number. Outside
    of $3$ and $5$, the recursive formula for Fermat numbers and an induction
    argument shows that the last digit of Fermat numbers is always $7$. But the
    only possible last digits of $u^2+64$ are $0, 3, 4, 5, 8, 9$.

    Suppose $b=1$. Then $2^a\cdot 3 = u^2+63$. This implies $3$ divides $u$ so
    $9$ divides $u^2$. But now the right-hand side is divisible by $9$ while the
    left is not.

    In conclusion, we know that if $J_0(p)$ is a totally split Jacobian, then $p\leq
    37$. A computer search then determines which primes less than or equal to
    $37$ are totally split.
\end{proof}

Call a positive integer $N$ \emph{good}, if $J_0(N)$ is totally split and
\emph{bad} otherwise. The simple factors of $J_0(N)$ are isogenous to simple
factors of $J_0(MN)$ for any positive integer $M$. Therefore, if $N$ is bad,
then so is any multiple of $N$. This allows us to prune divisibility branches
while doing a search for good integers on the divisibility tree of the positive
integers. Theorem~\ref{thm:finite_totally_split} asserts that all branches are
eventually pruned so the number of good integers is finite.

\begin{algorithm}{Enumerating Good Integers}
    \label{alg:find_split}
    Let $S$ be the set of primes found in Lemma~\ref{lem:good_primes}. This
    procedure will halt (see Theorem~\ref{thm:finite_totally_split}) and return
    the list of good integers.
\end{algorithm}
\begin{enumerate}
    \item{} [Initialize]
        \label{step:initialize}
        Set $i=1$ and $M_1=S$. Here $M_i$ will represent the set of all good
        integers with $i$ prime factors, counting multiplicity.
    \item{} [Find prime multiples of $M_i$ are that good]
        Set
        \[
            M_{i+1}=\{pN: p\in S, N\in M_i, pN \text{ good}\}.
        \]
        If $M_{i+1}$ is non-empty, increment $i$ and repeat this step.
    \item{} [Return]
        Return $\bigcup_i M_i$.
\end{enumerate}
\begin{theorem}
    \label{thm:finite_totally_split}
    There are 71 integers $N$ for which $J_0(N)$ is a totally split Jacobian of
    positive dimension. They are given in Table~\ref{tab:split}.
\end{theorem}
\begin{proof}
    We run Algorithm~\ref{alg:find_split} and it terminates after find 71
    integers $N$ for which $J_0(N)$ is totally split (luckily before reaching
    the end of the Cremona database). This proves the finiteness of totally
    split $J_0(N)$ without using Proposition~\ref{prop:totally_split} but with
    the added benefit of provably enumerating the totally split $J_0(N)$.
\end{proof}


\section{Enumerating rational torsion is algorithmic}

Here we give a completely impractical algorithm to compute the rational torsion
subgroup of a totally split Jacobian $J_0(N)$ just to show it is algorithmic.
\begin{proposition}
    Suppose $A$ is a totally split abelian subvariety of $J=J_0(N)$ Then we can
    compute the following data:
    \begin{enumerate}
        \item
            A number field containing $\QQ(A[n])$ for positive integer $n$.
        \item
            Let $n$ be a positive integer and $L$ be a number field containing
            $\QQ(A[n])$. The action of $\Gal(L/\QQ)$ on $A[n]$.
        \item
            The $K$-rational torsion points of $A(K)_\tor$.
    \end{enumerate}
    In particular, we can compute the rational torsion subgroup of any totally
    split Jacobian.
\end{proposition}
\begin{proof}
    Recall that the abelian subvarieties are represented by giving a submodule
    of the integral homology~\ref{sec:defining_data}. Suppose $A$ is
    1-dimensional subvariety of $J$. Then by~\ref{alg:weierstrass}, we can
    compute an elliptic curve $E_A$ given in Weierstrass defining equation and
    an isomorphism $\Phi_A:A_\tor\to (E_A)_\tor$.

    We will proceed by induction on the dimension, $d$, of $A$. We first
    consider the case $d=1$.
    \begin{enumerate}
        \item
            Let $n$ be a positive integer. Then using division polynomials, we
            can compute a number field $L$ containing $\QQ(A[n])$.
        \item
            Let $n$ be a positive integer and $L$ be a number field containing
            $\QQ(A[n])$. The Galois action on the points of $E_A[n]$ is given
            by applying the Galois action to each coordinate. Using $\Phi_A$
            and the action of $\Gal(L/\QQ)$ on $E_A$, we can explicit determine
            the action of $\Gal(L/\QQ)$ on $A[n]$.
        \item
            Let $K$ be a number field. Using reduction mod $p$, there exists an
            integer $m$, such that that $A(K)_\tor \subseteq A[m]$. Using (1),
            we can define a number field $L$ that contains $\QQ(A[m])$. Then
            using (2), we can compute
            \[
                A(K)_\tor = A[m]^{\Gal(L/K)}.
            \]
    \end{enumerate}

    Now assume we can compute (1)-(3) for any totally split abelian subvariety
    of dimension less than $k$.

    Let $A$ be of dimension $k+1$ and write $A=B+C$, where $B$ is of
    dimension $k$ and $C$ is of dimension $1$.  We have the exact sequence
    \[
        0\to B\cap C \to B\times C \to A,
    \]
    where we identify $B\cap C$ as a subgroup of $B\times C$ via the
    anti-diagonal embedding. So $A=(B\times C)/(B\cap C)$. Let $r$ be the
    exponent of $B\cap C$.
    \begin{enumerate}
        \item
            For any integer $n$, $A[n] \subseteq B[nr]+C[nr]$. So a number
            field containing $\QQ(A[n])$ is the compositum  of the number
            fields containing $\QQ(B[nr])$ and $\QQ(C[nr])$ which can be
            computed by the inductive hypothesis.
        \item
            The Galois action can be determined on $A[n]$ by viewing $A[n]$ as
            a subgroup of $(B[nr]\times C[nr])/(B\cap C)$.
        \item
            Using reduction mod $p$, there exists an integer $m$ such that
            $A(K)_\tor\subseteq A[m]$. Using (1), we can find a number field
            $L$ that contains $\QQ(A[m])$. Then we use (2), to compute
            \[
                A(K)_\tor = A[m]^{\Gal(L/K)}.
            \]
    \end{enumerate}
\end{proof}

\section{Strategies for computing the rational torsion subgroup}

By~\ref{}, we have the inclusion $C(N)(\QQ)\subseteq J_0(N)(\QQ)_\tor$ and the
Generalized Ogg conjecture is the assertion that we have equality. In this
section, we will give techniques for bounding the index
$[J_0(\QQ)_\tor:C(N)(\QQ)]$.

Our main interest is the totally split rank-0 case
though our techniques may apply more generally (Example~\ref{}). There are 46
totally split rank 0 $J_0(N)$ and we have verified the Generalized Ogg
Conjecture for all but 9 Jacobians (Table~\ref{}). In those 9 cases, we are
able to bound the index $[J_0(N)(\QQ)_\tor:C_N(\QQ)]$ by a power of 2.

\subsection{Upper bound}%
\label{sub:upper_bound}

In this subsection, we give two techniques for giving an upper bound for
$J_0(N)(\QQ)_\tor$. The first technique uses reduction modulo $p$,
Eicher-Shimura, and the Hecke polynomial to obtain a bound on the order. The
second technique gives an ideal, $I^*$, similar to Mazur's Eisenstein ideal so
that $J_0(N)(\QQ)_\tor\subseteq J_0(N)[I]$. We will be primarily using the
second technique for our computations but we give the first technique to
motivate the second.

\subsubsection{Reduction modulo primes}%
\label{ssub:reduction_modulo_primes}

Let $A$ be a modular abelian variety with good reduction at primes $p$. A
common technique for bounding $A(\QQ)_\tor$ is to inject it into the
$\Fp$-points for odd primes $p$ of good reduction. In particular,
by~\cite[Appendix]{katz:torsion}, if $\mathcal{A}$ is the Neron model for $A$,
then the reduction map gives the inclusion
\[
    A(\QQ)_\tor \hookrightarrow \mathcal{A}_{/p}(\Fp).
\]
In particular, if $S$ is any set of good odd primes,
\[
    \# A(\QQ)_\tor = \gcd_{p\in S}\{ \# \mathcal{A}_{/p}(\Fp)\}.
\]
The expression $\#\mathcal{A}_{\p}(\Fp)$ is an isogeny invariant and
multiplicative on direct products. So it suffices to describe how to compute
$\mathcal{A}_{/p}(\Fp)$ when $A=A_f\subseteq J_0(N)$ (for $A_f\subseteq
J_1(N)$, see~\cite[\S 3.5]{agashe-stein:bsd}). Let $F_p$ be the absolute
Frobenius at $p$ by Eicher-Shimura, $T_p = F_p + p/F_p\in
\End(\mathcal{A}_{/p})$. Then
\begin{align}
    \label{eq:katz_bound}
    \begin{split}
    \#\mathcal{A}_{/p}(\Fp)
    & = \deg(1-F_p) \\
    & = |\det(1-F_p)| \\
    & = \mathrm{charpoly}(F_p)(1) \\
    & = \mathrm{charpoly}(T_p)(p+1).
    \end{split}
\end{align}
The last term is the characteristic polynomial of the matrix associated to the
Hecke operator $T_p$. We now give the current \sage (Version 8.7)
implementation of this algorithm by William Stein.

\begin{algorithm}{Upper bound on rational torsion order}%
    \label{alg:upper_bound_stable}
    Given a modular Jacobian $J_0(N)$, this algorithm outputs an upper bound
    for $\# J_0(N)(\QQ)_\tor$. This algorithm computes successive GCD's until
    it stabilizes for 3 iterations. Of course, increasing the stability
    threshold could lead to be a better bound.
    \begin{enumerate}
        \item{} [Initialize]
            Let $i=0$, $p_0$ be the smallest prime greater than 2 not dividing
            $N$.
        \item{} [Add another factor]
            Use~\ref{} to compute the matrix associated to $T_{p_0}$. Let $m_i
            = \mathrm{charpoly}(T_p)(p+1)$. If $i=0$, set $B_i=m_i$. Otherwise,
            set $B_i=\gcd(B_{i-1}, m_i)$.
        \item{} [Stable?/Output]
            If $i\leq 2$, increment $i$ and return to Step 2. Otherwise, if
            $B_i\neq B_{i-2}$, return to Step 2. Otherwise, $B_i$ has been
            stable for 3 iterations and we output $B_i$.
    \end{enumerate}
\end{algorithm}
There are two disadvantages to Algorithm~\ref{alg:upper_bound_stable}.

The first is that is isogeny invariant so we expect the bound to not be tight.
In Example~\ref{}, we show that there exists an abelian variety isogenous to
$J_0(30)$ with strictly greater rational torsion order. So
Algorithm~\ref{alg:upper_bound_stable} will never give a tight bound even if we
increase the stability threshold. This Jacobian is the first $J_0(N)$ that
\sage (Version 8.7) cannot compute and is the motivating example for this
totally split Jacobian project of this thesis.

The second is the loss of information of the group structure. For example,
suppose for some $A_f$ and odd primes $p,q$ of good reduction, we have the
group isomorphisms $\mathcal{A}_{/p}(\Fp)\cong \ZZ/2\times \ZZ/2$ and
$\mathcal{A}_{/q}(\F_q)\cong \ZZ/4$. If we look only at the orders, we can only
deduce $\# A_f(\QQ)_\tor\mid 4$. However, the group structure tells us that as
a group $A_f(\QQ)_\tor$ is trivial or $A_f(\QQ)_\tor \cong \ZZ/2$.

\subsubsection{Real Eisenstein Kernel}%
\label{ssub:real_eisenstein_kernel}

This next technique avoids both of the mentioned disadvantages of the first
technique. This technique was created by William Stein and will be elaborated
on as part of a forthcoming paper by Hao Chen, the author, and William Stein.
The idea give to construct an ideal $I$ so that $J_0(N)(\QQ)_\tor\subseteq
J_0(N)[I]$.

For any odd prime $\ell$ of good reduction (so $\ell\nmid 2N$), let
$\eta_\ell = T_\ell - (\ell+1)$.
\begin{lemma}[William Stein]%
    \label{lem:rational_is_eta}
    For any odd prime $\ell$ of good reduction, $J(\QQ)_\tor\subseteq
    J[\eta_\ell]$.
\end{lemma}
\begin{proof}
    Let $\ell$ be an odd prime of good reduction.
    By~\cite[Appendix]{katz:torsion}, there the reduction modulo $\ell$ map
    yields the inclusion $\tau:J(\QQ)_\tor \hookrightarrow J_{/\ell}(\F_\ell)$.
    Let $F_\ell$ be the absolute Frobenius of of $J_{/\ell}$. By Eicher-Shimura,
    $T_\ell=F_\ell+\ell/F_\ell$. Let $x\in J(\QQ)_\tor$ so
    $F_\ell(\tau(x))=\tau(x)$. We have
    \[
        \tau(\eta_\ell(x)) = (T_\ell-(\ell+1))\tau(x) =
        (F_\ell+\ell/F_\ell-(\ell+1))\tau(x) = 0.
    \]
    Since $\tau$ is injective $x\in J[\eta_\ell]$.
\end{proof}

Let $I= \langle \eta_\ell:\ell\nmid 2N \rangle$. By
Lemma~\ref{lem:rational_is_eta}, $J(\QQ)_\tor\subseteq J[I]$. Now let $s$ be
the star-involution~\ref{}, and $I^*=I + \langle 1-s \rangle$. William Stein
calls this the Real Eisenstein Ideal. We have that $J(\CC)[1-s]=J(\RR)$ so
combined with Lemma~\ref{lem:rational_is_eta}, $J(\QQ)_\tor\subseteq
J[I^*]$. Let $I_r ^* = \langle \eta_\ell:\ell\leq r \rangle$ and define
\begin{equation}%
    \label{eq:stein_eta_group}
    E_r = J[I_r ^*]
\end{equation}
which again contains $J(\QQ)_\tor$. So an upper bound is given by computing
$E_r$ for sufficiently large $r$.

\section{General approach to bound}%
\label{sec:galois_cohomology_bounds}

\subsection{Galois cohomology}%
\label{sub:galois_cohomology}

Let $A, B$ be abelian subvarieties of a totally split Jacobian $J_0(N)$. Then
the exact sequence
\begin{equation}%
    \label{eq:ses_ab}
    \begin{tikzcd}
        0 \arrow[r] &
        A\cap B \arrow[r,"d"] &
        A\times B \arrow[r,"s"] &
        A+B \arrow[r] &
        0,
    \end{tikzcd}
\end{equation}
where $d(x)=(x,-x)$ and $s(x,y)=(x+y)$ yields the sequence
\begin{equation}%
    \label{eq:les_ab}
    \begin{tikzcd}
        0 \rar 
        &
        (A\cap B)(\QQ) \rar 
        &
        (A\times B)(\QQ) \rar
        \arrow[phantom, ""{coordinate, name=W}]{d}
        &
        (A+B)(\QQ)
        \arrow[
        rounded corners,
        to path={%
            -- ([xshift=2ex]\tikztostart.east)
            |- (W) [near end]\tikztonodes
            -| ([xshift=-2ex]\tikztotarget.west)
            -- (\tikztotarget)
        }
        ]{dll} \\
        &
        H^1(\QQ,A\cap B) \rar["\gamma"] 
        &
        H^1(\QQ,A\times B) \rar 
        & \ldots.
    \end{tikzcd}
\end{equation}
We now have
\begin{equation}%
    \label{eq:galois_cohomology_order}
    \# (A+B)(\QQ) =
    \frac{\# (A\times B)(\QQ) \# \ker\gamma}{\# (A\cap B)(\QQ)}.
\end{equation}

When $J$ is a rank-0 totally split Jacobian, \eqref{eq:galois_cohomology_order}
gives way to inductively determine the rational torsion order
$J(\QQ)_\tor=J(\QQ)$. Let $J$ be a rank-0 totally split Jacobian of dimension
$k$ so $J = \sum_{i=1} ^k E_i$, where $E_i$ are elliptic subvarieties of $J$.
We can compute the torsion order of $E_i$. To do induction, let these things.

\begin{algorithm}{Bounding rational torsion order}%
    \label{alg:bound_rational_torsion_order}
    Given a $k$-dimensional totally split rank-0 abelian subvariety $X$ of
    $J_0(N)$. This algorithm returns a bound on $[X(\QQ)_\tor:C_X(\QQ)]$, where
    $C_X=C(N)\cap X$.
    \begin{itemize}
        \item{} [Factor $X$ into elliptic curve subvarieties] 
            Use Algorithm~\ref{} to factor $X$ into elliptic curve
            subvarieties, $E_1,\ldots,E_k$.
        \item{} [Iteractively add one-dimension piece]
            Let $A_r = \sum_{i=1} ^r E_i$. We will interactively compute a
            bound $b_r$ on things. %TODO fill in
            \begin{itemize}
                \item{} [Generic bound from $S$]
                    Let $b=\# S_X/\#C_X(\QQ)$, where $S_X=S\cap X$ and
                    $C_X=C(N)\cap X$.
                \item{} [Refine using known results]
                    The results of~\ref{} gives of the support, $S$, of
                    $[X(\QQ):C_X(\QQ)]$. So if
                    necessary, replace $b$ with the part of $b$ supported on
                    $S$.
                \item{} [Use Kummer sequence]
                    If $A\cap B\neq B[n]$ for any $n$, skip this step.
                    Otherwise, set $c=\# B(\QQ) / \#(nB(\QQ))$.
                    A bound on $[Y(\QQ)_\tor:C_Y(\QQ)]$ is given by
                    \[
                        b' =
                        \frac{\#C_A(\QQ)\cdot B(\QQ)\cdot c\cdot
                        b_{i-1}}{\#(A\cap B)(\QQ)\cdot\# C_{A+B}(\QQ)}.
                    \]
                \item{} [Finish]
                    Set $b_i=\gcd(b,b')$.
            \end{itemize}
        \item{} [Return]
            Return $b_k$.
    \end{itemize}
\end{algorithm}


\subsection{Approach to computing $J(\QQ)_\tor$}%
\label{sub:approach_to_computing_j_qq__tor_}

\begin{proposition}
    Let $E$ be finite subset of $J_0(N)(\QQ)_\tor$ containing $C(N)(\QQ)$ (for
    example $E=E_r$~\eqref{eq:stein_eta_group}). Let $x_1,\ldots,x_r\in E$ be a
    set of representatives of $E/(C(N)(\QQ))$. Suppose for each $i$, there
    exists an abelian subvariety $A_i$ of $J_0(N)$ satisfying the Generalized
    Ogg Conjecture and containing $x_i$. Then $C(N)(\QQ)=J_0(N)(\QQ)_\tor$ so
    $J_0(N)$ satisfies the Generalized Ogg Conjecture.
\end{proposition}
\begin{proof}
    We already have $C(N)(\QQ)\subseteq J_0(N)(\QQ)_\tor$ (\ref{}). To show the
    reverse inclusion, let $x\in J_0(N)(\QQ)_\tor\subseteq E$. Then $x\in
    x_i+C(N)(\QQ)$ for some representative $x_i$. This implies $x_i\in
    J_0(N)(\QQ)_\tor$. But $A_i$ satisfies the Generalized Ogg Conjecture so
    $x_i\in C(N)(\QQ)$. Hence, $x\in C(N)(\QQ)$.
\end{proof}

Using Algorithm~\ref{alg:final_bound_alg}, we have the following theorem.
\begin{theorem}%
    \label{thm:verification_rank_zero}
    There are 45 totally split rank-0 Jacobians $J_0(N)$ (See
    Table~\ref{tab:split}). The Generalized Ogg Conjecture has been verified
    for all but 9 such $N$'s given by
    \[
        84,90,96,120,132,144,150,168,180
    \]
    In these cases, they are bounded by a power of 2. See
    Table~\ref{tab:rank_zero_bound}.
\end{theorem}
\begin{algorithm}%
    \label{alg:final_bound_alg}
    Given a totally split Jacobian $J=J_0(N)$, this algorithm will output a
    bound on $[J(\QQ)_\tor:C(N)(\QQ)]$, where $C(N)$ is the cuspidal subgroup
    of $J$.
    \begin{enumerate}
        \item{} [Upper bound by $E_{50}$]
            Set $r=50$ in~\eqref{eq:stein_eta_group} and compute $E_{50}$.
        \item{} [Set of representatives]
            Compute a list of elements $x_1,\ldots,x_s\in E_{50}$ that form a
            set of representatives for $E_{50}/C(N)$.
        \item{} [Reduce to smaller abelian varieties]
            For each $x_i$, try to find an abelian variety $A_i$ satisfying the
            Generalized Ogg conjecture.
            \begin{enumerate}
                \item{} [Factor $J$]
                    Write $J=\sum A_i$.
                \item{} [Sequence of sums of abelian subvarieties]
                    Form increasing sum of abelian varieties
                \item{} [Check Generalized Ogg conjecture]
                    Check the Generalized Ogg conjectures using Galois
                    cohomology.
            \end{enumerate}
    \end{enumerate}
\end{algorithm}

\chapter{Enumerating Isogenies of Prime Level Subvarieties}%
\label{chap:isogeny_class}

Let $N$ be a prime number so that $J_0(N)$ is non-trivial so $N=11$ or $N\geq
17$. Let $A$ be a simple abelian subvariety of $J_0(N)$. The goal of this
section is to, under certain conditions, enumerate the $\QQ$-isomorphism
classes of abelian varieties isogenous to $A$ by an odd-degree $\QQ$-isogeny.
We will call this the \emph{odd-degree isogeny class} of $A$.

More precisely, let $\TT$ be the Hecke algebra of $J_0(N)$ and $\TT_A$ be the
image of $\TT$ in $\End(A)$. There exists a newform $f=\sum a_n q^n$ associated
$A$. By~\cite[Prop. 7.14]{shimura:intro}, $\TT_A$ is isomorphic to an order of
the Hecke eigenvalue field - $\QQ(\ldots,a_n,\ldots)$. The goal of this chapter
is the enumerate the odd-degree isogeny class of $A$ when $\TT_A$ is integrally
closed.

The image of an isogeny is determined by its kernel up to isomorphism. So
define an equivalence relation on the set of finite odd-order
$G_\QQ$-submodules of $A(\QQbar)$ given by $M_1\sim M_2$ if and only if
$A/M_1\isom A/M_2$. For any odd-order $G_\QQ$-submodule $X$ of $A(\QQbar)$, let
$\M(X)$ be the set of equivalence classes of finite odd-order
$G_\QQ$-submodules of $A(\QQbar)$ with a representative that is a submodule of
$X$. Let $A(\QQbar)_\odd$ be the odd-torsion part of $A(\QQbar)$. The goal of
this chapter can then be restated as enumerating a set of representatives for
$\M(A(\QQbar)_\odd)$ when $\TT_A$ is integrally closed. From experimental data,
this conditions seems to be mild. In particular, there are 450 simple abelian
varieties of prime level less than 1000 but only 42 are not integrally closed.

The idea will be as follows. Assume $A$ is a simple abelian subvariety of
$J_0(N)$ with $\TT_A$ integral closed. Let $H=\{C_i\}$ be a set of odd-norm
integral representatives for $\Cl(\TT_A)$. Let $D$ be the set of primes of
$\TT_A$ dividing $C_i$ for some $C_i\in H$, $E$ be the set of primes dividing
the Eisenstein ideal, and $S=D\cup E$.

We begin by showing every
finite $G_\QQ$-submodule of $A(\QQbar)_\odd$ is a $\TT_A$-module
(Proposition~\ref{prop:G_modules_are_hecke}). This
is useful because the $\TT_A$-structure is more easily understood than the
$G_\QQ$-structure.\ For instance, we are now able to talk about the
$\TT_A$-support of finite odd-order $G_\QQ$-submodules. We then show that every
finite odd-order $G_\QQ$-submodule is equivalent to one support on $S$
(\ref{prop:bound_support}). Now we construct an ideal $Q$ of $\TT_A$ such that
$S$ is the set of primes dividing $Q$. So $\M(A[Q^\infty])=\M(A(\QQbar)_\odd$.
We will then give an method for determining an integer $k$ such that
$\M(A[Q^k])=\M(A[Q^\infty])=\M(A(\QQbar)_\odd)$
(Proposition~\ref{prop:bound_support}). Lastly, we give an algorithm for
enumerating the finite $G_\QQ$-submodules of $\M(A[Q^k])$. In summary, we have
the following algorithm.

\begin{algorithm}{Odd isogeny class}%
    \label{alg:odd_isogeny_class}
    Let $A$ be a simple abelian subvariety with $\TT_A$ integrally closed. This
    algorithm will enumerate the class of abelian varieties isomorphic
    isogenous to $A$ by an odd-degree isogeny.
    \begin{enumerate}
        \item{} [Class group representatives]
            Compute a set of odd integral representatives $H=\{C_i\}$ of
            $\Cl(\TT_A)$. Let $Q = (\prod_{C_i\in H} C_i)(\prod_{\p\in E} \p)$,
            where $E$ is the set of primes dividing the Eisenstein ideal.
        \item{} [Initialize search]
            Set $r=1$ and $X_{r-1}=\emptyset$.
        \item{} [$G_\QQ$-submodules of $A[Q^r]$]
            Use Algorithm~\ref{alg:enumerating_AX} to give a set, $X_r$, of
            representatives for $\M(A[Q^r])$.
        \item{} [Done?]
            By Corollary~\ref{prop:stop_looking}, if for all $x\in X_r$, $x\sim
            y$ for some $y\in X_{r-1}$, then $X_r$ is a set of representatives
            for $\M(A(\QQbar)_\odd)$. If this is not the case, increment $r$
            and repeat the last step.
        \item{} [Quotient and output]
            Output $A/M$ for $M\in X_r$.
    \end{enumerate}
\end{algorithm}

\section{Finite odd-order Galois Modules are Hecke}%
\label{sec:finite_odd_order_galois_modules_are_hecke}

The goal of this subsection is to prove every finite odd $G_\QQ$-submodule $M$
of $A(\QQbar)$ is a Hecke module (Proposition~\ref{prop:G_modules_are_hecke}). The
Galois action of $J(\QQbar)$ has been extensively studied by
Mazur~\cite{mazur:eisenstein}, so we weaken our hypothesis to $M$ a
$G_\QQ$-submodule of $J(\QQbar)_\odd$.

It suffices to prove $M$ is $\TT$-stable for each $G_\QQ$-composition factor $V$
of $M[\ell^\infty]$ for $\ell>2$. The irreducibility of $V$ implies that it is
$\ell$-torsion. Ribet~\cite[Proposition 6.1]{ribet:semistable_gal} shows that
$\TT/\ell \TT$ is generated by $T_p$ for primes $p\nmid \ell N$. So we reduce
modulo $p$ for $p\nmid \ell N$, and use Eichler-Shimura to derived its
$\TT$-stability from its $G_\QQ$-stability.

\begin{proposition}\label{prop:G_modules_are_hecke}
    Suppose $M$ is a finite odd-order $G_\QQ$-submodule of $J_0(N)$, with $N$
    prime. Then $M$ is a $\TT[G_\QQ]$-module.
\end{proposition}
\begin{proof}
    It suffices to show $M$ is $\TT$-stable for each $\ell$-primary part. Let
    $\ell>2$ and assume $M\subseteq J[\ell^\infty]$. Let
    \[
        0 = M_0 \subsetneq \ldots \subsetneq M_n = M
    \]
    be an $G_\QQ$-composition series of $M$ with composition factors $X_i =
    M_i/M_{i-1}$. We proceed by induction on $n$ with the base
    case being the trivial $n=0$ case.

    Assume $M_{s-1}$ is an $\TT[G_\QQ]$-module. We will show $M_s$ is an
    $\TT[G_\QQ]$-module. Since $M_{s-1}$ is an $\TT[G_\QQ]$-module, for each
    $t\in \TT$, we have a well-defined map $t:X_s\to J(\QQbar)/M_{s-1}$. The
    goal is to show $t(X_s)\subseteq X_s$ for all $t\in \TT$.
    By~\cite[Proposition 2]{ribet:mult_p_finite}, $\TT/\ell \TT$ is generated
    by $T_p$ for $p\nmid \ell N$ so it suffices to show $T_p(X_s)\subseteq X_s$
    for prime $p\nmid \ell N$.

    Fix a prime $p\nmid \ell N$. So $J$ has good reduction at $p$. Fix a place
    $\p$ over $p$. The reduction map
    yields an isomorphism~\cite[Theorem 1, Lemma 2]{serre-tate}
    \[
        \tau:J(\QQbar)[\ell^\infty] \riso J_{/\F_p} (\Fpbar)[\ell^\infty]
    \]
    sending $\Frob_\p$ to $F_p$, where $F_p$ is the absolute Frobenius on
    $J_{/\F_p}$. Under this isomorphism the natural $\TT$-action on $J(\QQ)$
    maps to the natural $\TT$-action on $J_{/\F_p}$~\cite[\S
    5.2]{ribet-stein:serre}. By Eicher-Shimura, $T_p = F+p/F\in
    \End(J_{/\F_p})$ so
    \[
        \tau(T_p X_s)
        = T_p\tau(X_s)
        = (F+p/F)\tau(X_s)
        = \tau((\Frob_\p+p/\Frob_\p)X_s)
        \subseteq \tau(X_s)
    \]
    hence, $T_p X_s\subseteq X_s$, as desired.
\end{proof}


\section{Non-Eisenstein modules are kernels of Hecke}%
\label{sec:non_eisenstein_modules_are_kernels_of_hecke}

In light of Section~\ref{sec:finite_odd_order_galois_modules_are_hecke}, all
odd-order $G_\QQ$-submodules of $J(\QQbar)$ are $\TT$-modules. We will now
use this fact freely and will often refer to the $\TT$-support of an odd
$G_\QQ$-submodule.

The goal now is to identify the odd-order $G_\QQ$-submodules of
$J(\QQbar)_\odd$ supported away from $E$ by their $\TT$-annihilators. Using
Proposition~\ref{prop:G_modules_are_hecke}, we can already do this in the
irreducible case.
\begin{corollary}
    Let $\m$ be a non-Eisenstein prime of odd residue characteristic, if $M$ is
    a nonzero finite irreducible $G_\QQ$-submodule of $J(\QQbar)$ supported
    only on $\m$, then $M=J[\m]$.
\end{corollary}
\begin{proof}
    By Lemma~\ref{lem:cherry_street}, the annihilator of $M$ is $\m$. Hence,
    $M\subseteq J[\m]$ but $J[\m]$ is an irreducible
    $G_\QQ$-module~\cite[Proposition 14.2]{mazur:eisenstein} so $M=J[\m]$.
\end{proof}

The general case will follow from the work of David Helm~\cite{helm:jacobian}.
Helm considers the case of Jacobians, $J$, of Shimura curves. One of the key
inputs into Helm's proof is that for the maximal ideals $\m$ in question is
that if $T_\m J$ is the contravariant $\m$-adic Tate module, then $T_\m J/\m
T_\m J\cong J[\m]^\vee$ is dimension two over $\TT/\m$ and irreducible as a
$G_\QQ$-module. By~\cite[Prop. 14.2]{mazur:eisenstein}, this is also the case
for $J=J_0(N)$ and $\m$ a non-Eisenstein prime of odd residue characteristic.

\begin{theorem}[{\cite[Corollary 4.8]{helm:jacobian}}]%
    \label{thm:non_eisenstein_kernel_hecke}
    Let $M$ be a finite $G_\QQ$-module supported only on the non-Eisenstein
    primes of $\TT$ of odd residue characteristic with $\TT$-annihilator $I$.
    Then $M=J[I]$.

    Moreover, since $A$ is both $G_\QQ$ and $\TT$ invariant, if $M$ is a finite
    $G_\QQ$-module supported only on the non-Eisenstein primes of odd residue
    characteristic of $\TT_A$ with $\TT_A$-annihilator $I$. Then $M=A[I]$.
\end{theorem}

We have that $\Supp_\TT(M)$ is the set of primes lying for $I$ and $M\subseteq
J[I]$ so suffices to prove $J[I]_\m = M_\m$ for each non-Eisenstein prime of
odd residue characteristic. So let $\m$ be a non-Eisenstein prime of residue
characteristic $\ell>2$. Let $T_\m J\isom \Hom(J[\m^\infty],
\QQ_\ell/\ZZ_\ell)$ be the contravariant Tate module at $\m$ and
$\overline{\rho}_\m$ be the Galois representation associated to $J[\m]^\vee$.
Since $\m$ is an odd non-Eisenstein prime, $\overline{\rho}_\m$ is an
irreducible $G_\QQ$-representation of dimension 2 over $k_\m$ that is
isomorphic to $J[\m]^\vee$~\cite[Prop. 14.2]{mazur:eisenstein}.

\begin{lemma}[{\cite[Lemma 4.6]{helm:jacobian}}]\label{lem:finite_index}
    Let $M$ be a $G_\QQ$-stable submodule of $T_\m J$ of finite index. Then
    $M=IT_\m J$ for some ideal $I$ of $\TT$.
\end{lemma}
\begin{proof}
    We proceed by induction on the maximal $G_\QQ$-composition series of $T_\m J/M$
    with the base case being the trivial length zero case. Let
    \[
        M = M_n \subsetneq M_{n-1} \subsetneq \cdots \subsetneq M_0 = T_\m J
    \]
    be a $G_\QQ$-composition series. By induction, $M_{n-1} = I'T_\m J$ for some
    $I'\subseteq \TT$.

    Consider $\m M_{n-1} + M$. This is a $G_\QQ$-module sitting between $M$ and
    $M_{n-1}$. By Nakayama's lemma, if $\m M_{n-1} M + M = M_{n-1}$, then
    $M=M_{n-1}$ which is a contradiction. Hence, $\m M_{n-1}+M=M$ so $M$
    contains $\m M_{n-1}$ and we can form the quotient.

    The module $M_{n-1}/\m M_{n-1}$ is $G_\QQ$-isomorphic to $(I'/\m
    I')\otimes_{\TT/\m} (T_\m J/\m T_\m J) \cong (I'/\m I')\otimes_{\TT/\m}
    J[\m]^\vee$, where $G_\QQ$ acts trivially on $I'/\m I'$. Let $V$ be the image
    of $M$ in $M_{n-1}/\m M_{n-1}$. Since $V$ is $G_\QQ$-invariant, and
    $J[\m]^\vee$ is irreducible, $V$ is given by $\hat{V}\otimes J[\m]^\vee$
    for some $\TT/\m$-subspace $\hat{V}$ of $I'/\m I'$. Let $I$ be the preimage
    of $\hat{V}$ in $I'$. Then $IT_m J = M$, since both contain $\m M_{n-1}$
    and map to $V$ modulo $\m M_{n-1}$.
\end{proof}

We now return to the proof of Theorem~\ref{thm:non_eisenstein_kernel_hecke}.

\begin{proof}[proof of Theorem~\ref{thm:non_eisenstein_kernel_hecke}]
    Let $B=J/M$ be the quotient abelian variety equipped with the induced
    $\TT$-action. So the projection $\phi:J \to B$ is an $\TT[G_\QQ]$-isogeny
    with $\ker\phi = M$. For any odd non-Eisenstein prime $\m$, $\phi$ induces
    the exact sequence
    \[
        0 \to T_\m B \to T_\m J \to M^\vee _\m \to 0.
    \]
    In particular, the image of $T_\m B$ under $\phi$ is a finite index
    $\TT[G_\QQ]$-submodule of $T_\m A$. By Lemma~\ref{lem:finite_index}, we can find
    an ideal $I'$ of $\TT$ such that the image of $T_\m B$ is $I' _\m T_\m A$
    for all odd non-Eisenstein primes $\m$. We have $M^\vee _\m = T_\m J / I'
    T_\m J\cong J[I']_\m ^\vee$. Therefore, by taking annihilators of the dual,
    we have that $I_\m = I'_\m$ and then by taking duals $M_\m = J[I]_\m$, as
    desired.
\end{proof}

\section{Enumerating representatives of $A[X]$}

Assume $\TT_A$ is integrally closed and let $X$ be an odd ideal of $\TT_A$. The
goal of this section is to give a set of representatives for $\M(A[X])$ by
first enumerating the $G_\QQ$-submodules of $A[X]$. We
have the decomposition $X=\bigoplus_{\p\in \Supp_{\TT_A} (X)} X[\p^{v_\p(X)}]$
so it suffices to enumerate the $G_\QQ$-submodules of $A[\p^s]$ for any $s\geq
1$. This will now follow from Mazur's study of the Galois action on torsion
points~\cite[\S 14]{mazur:eisenstein}.

\begin{proposition}[Mazur]\label{prop:all_G_subs}
    Let $\p$ be a prime of residue characteristic $\ell>2$.
    \begin{enumerate}
        \item
            If $\p$ is Eisenstein, then $A[\p]=C_A[\ell]\oplus \Sigma_A[\ell]$,
            where $C_A=C\cap A$ and $\Sigma_A=\Sigma \cap A$ with $C$ and
            $\Sigma$ the cuspidal and Shimura subgroups of $J$. The
            $G_\QQ$-submodules of $A[\p]$ are the direct sum of $\ZZ$-submodules of
            $C_A[\ell]$ and $\ZZ$-submodules of $\Sigma_A[\ell]$.
        \item
            if $\p$ is non-Eisenstein, $A[\p]$ is irreducible~\cite[Prop
            14.2]{mazur:eisenstein} as as a $G_\QQ$-module so the only
            $G_\QQ$-submodules are $0$ and $A[\p]$.
    \end{enumerate}
\end{proposition}
\begin{proof}
    The Eisenstein case is~\cite[Corollary 16.3]{mazur:eisenstein} along with
    the fact that $C[\ell]\isom \ZZ/\ell$ and $\Sigma[\ell]\isom \mu\ell$.

    The non-Eisenstein case is~\cite[Propositon 14.2]{mazur:eisenstein}.
\end{proof}

Let $a\in \p^{s-1}\setminus \p^s$ so $a$ generates $\p^{s-1}/\p^s$ as a
$k_\p$-space. There exists a $\TT_A[G_\QQ]$-injection given by
$\phi_s:A[\p^s]/A[\p^{s-1}]\to A[\p]$. The $G_\QQ$-submodules, $M$, of
$A[\p^s]$ are then the $\ZZ$-submodules of $A[\p^s]$ such that $M\cap
A[\p^{s-1}]$ and $\phi_s(M)$ are $G_\QQ$-submodules. This yields the following
algorithm.

\begin{algorithm}{Enumerating $G_\QQ$-submodules of {$A[X]$}}%
    \label{alg:enumerating_AX}
    Given an odd ideal $X$ of $\TT_A$. This algorithm will output a set of
    representatives for $\M(A[X])$.
    \begin{enumerate}
        \item{} [Factor $X$]
            Compute the factorization $X=\prod \p_i ^{e_i}$.
        \item{} [Non-Eisenstein part]
            For each non-Eisenstein $\p_i$, let $W_i=\{A[\p^j]: 0 \leq j
            \leq e_i\}$.
        \item{} [Eisenstein part]
            For each Eisenstein $\p_i$, set $V_1$ to be the set of
            $G_\QQ$-submodules of $A[\p]$. For $j=2,\ldots,e_i$, set $V_j$ to
            be the set of $\ZZ$-submodules, $M$, of $A[\p^j]$ such that $M\cap
            A[\p^{j-1}]\in V_{j-1}$ and $\phi(M)\in V_1$.
        \item{} [Combine]
            Combine the $W_i$'s to form $W=\{\sum_i M_i: M_i \in W_i\}$.
        \item{} [Output representatives]
            Use isomorphism testing 
            %TODO
            % (Algorithm~\ref{alg:isom_testing})
            to produce a set of representatives of $\M(A[X])$ of elements of
            $W$.
    \end{enumerate}
\end{algorithm}

\section{Bounding support and valuations}%
\label{sec:bounding_support_and_valuations}

The goal of this section is to give an ideal $Q$ such that
$\M(A[Q^\infty])=\M(A(\QQbar)_\odd)$ (Proposition~\ref{prop:bound_support}). In
light of Faltings' Isogeny Theorem, there exists $k$ such that
$\M(A[Q^k])=\M(A(\QQbar)_\odd)$. We give a method for finding this $k$ as
Proposition~\ref{prop:stop_looking}. We now have all the necessary ingredients
for Algorithm~\ref{alg:odd_isogeny_class}.

\begin{lemma}\label{lem:com_alg}
    Let $a,b\in \TT_A$, $\p$ such the localization $(\TT_A)_\p$ is a DVR, and
    $M$ an finite odd $G_\QQ$-submodule of $A(\QQbar)$ with $Z=\Ann_{\TT_A} M$.
    Then
    \begin{enumerate}
        \item
            If $v_\p(Z) = k$, then $M[\p^\infty]\subseteq A[\p^k]$.
        \item
            We have $b^{-1}(A[Z])=A[bZ]$. This holds locally at $\p$ as well so
            $b_\p ^{-1} A[Z]_\p = A[bZ]_\p$.
        \item
            Let $r=v_\p(b)-v_\p(a)+k$ and $\phi=a\circ b^{-1}$. If $r\leq
            0$, then $\phi(M)[\p^\infty]=0$ so $\phi(M)_\p=0$.

            If $r>0$, then
            $\phi(M)[\p^\infty]\subseteq A[\p^r]$. Here $b^{-1}$ is the
            preimage of $b$.
    \end{enumerate}
    We will take on the convention that for negative $r$, $A[\p^r]=0$. So we can
    write the last part as $\phi(M)[\p]\subseteq A[\p^r]$.
\end{lemma}
\begin{proof}
    \mbox{}
    \begin{enumerate}
        \item
            Suppose $x\in M[\p^\infty]$. Then $x\in A[\p^\infty]$. Moreover,
            $v_\p(\Ann_{\TT_A} x) \leq v_\p(Z) = k$ so $x\in A[\p^k]$.
        \item
            We have $x\in b^{-1}(A[Z])$ if and only if $bx \in A[Z]$ if and
            only if $x\in A[bZ]$.
        \item
            Suppose $r\leq 0$. Then $\phi_\p \in Z_\p$ so
            \[
                \phi(M)[p^\infty]\subseteq \phi(M[\p^\infty])
                \subseteq \phi(A[\p^k]) = 0.
            \]
            Suppose $r>0$. Then $x\in \phi(M)[\p^\infty] =
            \phi(M[\p^\infty])\subseteq (a\circ
            b^{-1})(A[\p^k])=A[\p^r]$.
    \end{enumerate}
\end{proof}


\begin{lemma}\label{lem:principal_gives_iso}
    Let $C, D$ be nonzero ideals of $\TT_A$, $a,b\in \TT_A$ be nonzero, and $aC
    = bD$. Then there exists an isomorphism $\phi:A/A[D]\to A/A[C]$ such that
    $\phi\circ b=a$.
\end{lemma}
\begin{proof}
    Our argument will now reference the following diagram.
    \[
        \begin{tikzcd}
            A/A[bD]
            \arrow[r, "\sim", "b"']
            \ar[equal]{d}
            &
            A/A[D]
            \ar[d, "\sim" labl, "\phi"]
            \\
            A/A[a C]
            \arrow[r, "\sim", "a"']
            &
            A/A[C]
        \end{tikzcd}
    \]
    We first establish the $b$ and $a$ isomorphism. We have the exact
    sequence
    \[
        \begin{tikzcd}
            0
            \arrow[r]
            &
            (A/A[D])[b]
            \arrow[hookrightarrow]{r}
            &
            A/A[D]
            \arrow[twoheadrightarrow]{r}{b}
            &
            A/A[D]
            \arrow[r]
            &
            0
        \end{tikzcd}.
    \]
    We have that $x\in (A/A[D])[b]$ if and only if $bx \in A[D]$ if and only if
    $x \in A[bD]$. Hence, $(A/A[D])[b]=A[bD]/A[D]$ so $b:A/A[bD]\xra{\sim}
    A[D]$. A similar argument applies for $a$.

    We can now chase the diagram to obtain an isomorphism $\phi:A/A[D]\riso
    A/A[C]$, as desired.
\end{proof}

Recall $\TT_A$ is assumed to be integrally closed. Let $H=\{C_i\}$ be a set of
odd-norm integral representatives for $\Cl(\TT_A)$. Let $D$ be the set of
primes of $\TT_A$ dividing $C_i$ for some $C_i\in H$, $E$ be the set of primes
dividing the Eisenstein ideal, and $S=D\cup E$.

\begin{proposition}%
    \label{prop:bound_support}
    Every finite odd-order $G_\QQ$-submodule is equivalent to one supported on
    $S$.
\end{proposition}
\begin{proof}
    Let $M$ be a finite odd $G_\QQ$-submodule. Let $M=M_{S'}\oplus M_S$ be the
    direct sum decomposition of $M$ with $\Supp M_X \subseteq X$. By
    Theorem~\ref{thm:non_eisenstein_kernel_hecke}, there exists an ideal
    $I$ of $\TT_A$ with $V(I)\subseteq S'$. Since $S'$ consists of only
    invertible primes, $I$ is also invertible. So there exists nonzero $a,b\in
    \TT_A$ such that $bI=aC$. By Lemma~\ref{lem:principal_gives_iso}, there
    exists an isomorphism $\phi:A/A[I]\to A/A[C]$ such that $\phi\circ b = a$.
    Let $\psi:A/A[I]\to A/(A[I]+M_S)$ be the isogeny given by quotienting by
    $M_S/A[I]$. Then $\phi$ induces an isomorphism $\phi':A/(A[I]+M_S)\to
    A/(A[C]+\phi(M_S))$.

    It is clear that $\Supp_{\TT_A}(A[C])\subseteq S$ so it remains to show
    that $\phi(M_S)_\p =0$ for all $\p \in S'$. Let $\p\in S'$, then
    $v_\p(b)-v_\p(a)+v_\p(\Ann(M_S))=v_\p(C)-v_\p(I)+v_\p(\Ann(M_S)) \leq 0$
    since $V(C),V(\Ann(M_S))\subseteq S$. By Lemma~\ref{lem:com_alg},
    $\phi(M_S)_\p = 0$. Therefore, $A[C]+\phi(M_S)$ is supported on $S$.
\end{proof}

From henceforth, we assume that $\TT_A$ is integrally closed. We can now choose
$H=\{C_i\}$ to be a set of integral representatives for $\Cl(\TT_A)$ of odd
norm. Let $Q=\lcm(\{C:C\in H\}\cup \{\p:\p\in S_1\})$. We have that $V(Q)=S$
so, in light of Proposition~\ref{prop:bound_support},
$\M(A[Q^\infty])=\M(A(\QQbar)_\odd)$.

\begin{proposition}%
    \label{prop:stop_looking}
    Suppose $\TT_A$ is integrally closed. Suppose $\M(A[Q^k])=\M(A[Q^{k+1}])$
    then $\M(A[Q^k])=\M(A[Q^\infty])$.

    In terms of isogenies, this claim states that if $G_\QQ$-submodules of
    $A[Q^{k+1}]$ produce no new odd-isogenies not found in $A[Q^k]$, then
    $G_\QQ$-submodules of $A[Q^k]$ give the entire odd-isogeny class.
\end{proposition}
\begin{proof}
    Every isogeny can be factored into a composition of irreducible isogenies.
    Let $A'=A/M$ be a abelian variety with $M$ a $G_\QQ$-submodule of $A[Q^k]$. We
    will show that the image of $A'$ under an irreducible isogeny is equivalent
    to $A/Y$ for some $Y\in A[Q^{k+1}]$. This suffices because when
    $A[Q^k]=A[Q^{k+1}]$, we obtain the full isogeny class.

    Let $M'\subseteq A(\QQbar)_\odd$ be an extension of $M$ by an irreducible
    $G_\QQ$-module $Y$. Let $\m$ be the annihilator of $Y$. If $\m\in S$, then
    $M\subseteq A[\m Q^k]\subseteq A[Q^{k+1}]$ and we are done. So assume
    $\m\notin S$ so $\m$ is an odd Eisenstein prime and $Y=A[\m]$
    (Theorem~\ref{thm:irreducible_G_sub}). Since $\m\notin \Supp_{\TT_A}(M)$,
    $M' = A[\m]\oplus M$. As in Proposition~\ref{prop:bound_support}, there is
    an isomorphism $\phi':A/(A[I]+M_S)\to A/(A[C]+\phi(M_S))$ with $\phi\circ b
    = a$. The goal is to show $A[C]+\phi(M)\subseteq A[Q^k]$. Since
    $A[C]\subseteq A[Q^{k+1}]$ so it suffices to show $\phi(M)\subseteq
    A[Q^{k+1}]$.

    As in Proposition~\ref{prop:bound_support}, $\Supp\phi(M)\subseteq S$. For all
    $\p\in S$ (remember that $\m \notin S$), $v_\p(b)-v_\p(a) =
    v_\p(C)-v_\p(\m)=v_\p(C)$ so by Lemma~\ref{lem:com_alg},
    $\phi(M)\subseteq A[Q^{k+1}]$, as desired.
\end{proof}

\chapter{Tables}

\include{table_enumerate_totally_split}
\include{table_rank_zero_bound}


\bibliographystyle{amsalpha}
\bibliography{biblio}
\end{document}

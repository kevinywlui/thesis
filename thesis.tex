\documentclass[11pt, proquest]{uwthesis}
\setcounter{tocdepth}{1}  % Print the chapter and sections to the toc

\usepackage{url}
\usepackage{hyperref}
\hypersetup{colorlinks=true}
\usepackage{booktabs}
\usepackage{microtype}
\usepackage{tikz-cd}
\tikzset{labl/.style={anchor=south, rotate=90, inner sep=.5mm}}
\include{macros}

\usepackage[inline]{showlabels}

\begin{document} 
\prelimpages

\Title{Explicit Isogenies for $J_0(N)$}
\Author{Kevin Lui}
\Year{2019}
\Program{Mathematics}

\Chair{William Stein}{Professor}{Mathematics}
\Signature{Ralph Greenberg}
\Signature{Bianca Viray}
\Signature{Yen-Chi Chen}

\copyrightpage

\titlepage  
\tableofcontents
\listoffigures

\textpages

\chapter{Introduction}%
\label{chap:intro}

In this thesis, we compute explicit with isogenies of $J_0(N)$. 

We say a Jacobian is totally split if it is $\QQ$-isogenous to a product of
elliptic curves. In Section~\ref{chap:totally_split}, we present techniques for
computing the rational torsion subgroup of totally split $J_0(N)$.



\chapter{Preliminaries}%
\label{chap:prelim}

\section{Modular Abelian Varieties}

In Chapter~\ref{chap:isogeny_class}, we will discuss enumerating the isogeny
class of simple abelian subvarieties of $J_0(N)$. This leads us to define a
class of abelian variety containing the subquotients of $J_0(N)$.

\begin{definition}
    \label{defn:modabvar}
    Let $A$ be an abelian variety over $\QQ$. Then $A$ is \emph{modular} if
    there exists some $N$ and a finite degree morphism $\phi:A\to J_1(N)$.

    Note that modularity is closed under isogenies, subvarieties, and products.
\end{definition}

The natural quotient of $X_1(N)\to X_0(N)$ induces a finite degree map
$J_0(N)\to J_1(N)$. The kernel of this map, $\Sigma(N)$, is finite and is the
\emph{Shimura subgroup} of $J_0(N)$.


\section{Galois Representations} 

Let $B$ be a simple abelian variety over $\QQ$ with an embedding of a number
field $E$ into its endomorphism algebra $\End(B)\otimes \QQ$. By functoriality,
$E$ acts on the on the $\dim B$-dimensional vector space $\mathrm{Lie}(B)$.
Therefore, there is a divisibility bound $\deg E\mid \dim B$. The simple
abelian varieties that achieve this bound are called
\emph{$\GL_2$-type}~\cite[\S 2]{ribet:abvars}. To motivate this definition,
observe that $B[n]\cong (\ZZ/n)^{2\dim B}$ so $V_\ell(B)$ is a rank-2 $E\otimes
\QQ_\ell$-module. Therefore, the $G_\QQ$-action on $V_\ell(B)$ gives the
representation $G_\QQ\to \GL_2(E\otimes \QQ_\ell)$. More generally, we say an
abelian variety is \emph{$\GL_2$-type} if it is isogenous to a product of
simple $\GL_2$-type abelian varieties.

Modular abelian varieties provide a large class of examples of such varieties.
Let $f=\sum a_n q^n$ be a newform of $S_2(\Gamma_1(N))$ and
$K_f=\QQ(\ldots,a_n,\ldots)$ be the \emph{Hecke eigenvalue field} of $f$.
Shimura~\cite[Theorem 7.14]{shimura:intro} associates to $f$ an abelian variety
$A_f$ defined over $\QQ$ and an embedding of $K_f$ into the endomorphism
algebra $\End(A_f)\otimes \QQ$ with $\deg K_f = \dim A_f$. 

This shows that every modular abelian varieties is of $\GL_2$-type so a natural
question is whether every $\GL_2$-type abelian variety is modular. Assuming Serre's
modularity conjecture~\cite[3.2.4]{serre:conjectures}, Ribet~\cite[Thm.
4.4]{ribet:abvars} shows that the every $\GL_2$-type abelian variety is
modular.


\section{Natural maps}%
\label{sec:natural_maps}

In this section, we will describe some natural maps arising from modular forms.
We only give the theoretical construction of these maps here. The explicit
description will be given in~\ref{}

\subsection{Degeneracy Maps}%
\label{sub:degeneracy_maps} 

\subsection{Hecke Operators}%
\label{sub:hecke_operators}

\subsection{Star involution}%
\label{sub:star_involution}


\subsection{Optimal Elliptic Curves}%
\label{sub:optimal_elliptic_curves}

Let $E$ be an elliptic curve of conductor $N$. By the Modularity Theorem for
elliptic curves~\cite{breuil-conrad-diamond-taylor}. There exists a surjection
$\phi:J_0(N)\onto E$. In general, $\ker\phi$ is not connected. There does
$\phi':J_0(N)\onto E'$ with $E'$ isogenous to $E$ so that $\ker\phi'$ is
connected. By Multiplicity One~\ref{}, this $E'$ is unique in its isogeny
class. This leads to the definition of optimal quotients.
 
\begin{definition}%
    \label{defn:optimal_quotient}
    Let $J$ be the Jacobian of a curve. Then an abelian variety $A$ is an
    \emph{optimal quotient} of $J$, if there exists a surjective morphism $J
    \twoheadrightarrow A$ with connected kernel. Equivalently, $A$ is an
    optimal quotient of $J$ is it is the quotient of $J$ by an abelian
    subvariety.
\end{definition}

If $A$ is an optimal quotient of $J$, then $A^\vee$ can be embedded as a
subvariety of $J$. This particularly useful in the case where $J$ is totally
split because both elliptic curves and Jacobians are self-dual.

\begin{proposition}
    \label{prop:optimal}
    Let $A$ be an abelian variety and $J$ a modular Jacobian. Then $A$ is an
    optimal quotient of $J$ if and only if there exists an injection of
    $A^\vee$ into $J$.

    Suppose $A$ is self-dual, (for example, when $A$ is an elliptic curve), then
    $A$ is an optimal quotient of $J$ if and only if it is an abelian
    subvariety of $J$.
\end{proposition}
\begin{proof}
    Suppose $A$ is an optimal quotient of $J$. Then by dualizing the sequence
    of abelian varieties~\cite[Proposition 2.4.2]{lange-birkenhake:complex}
    \[
        0 \to C \to J \to A \to 0 \qquad 
        0\to A^\vee \to J^\vee \to C^\vee \to 0,
    \]
    there is an injection of $A^\vee\hookrightarrow J^\vee$.

    Conversely, if $A^\vee$ injects into $J$. Then by the Poincar\`{e} Reducibility
    Theorem, the quotient of $J$ by $A^\vee$ is again an abelian variety $C$.
    Then by dualizing the sequence of abelian varieties
    \[
        0 \to A^\vee \to J \to C \to 0 \qquad 
        0 \to C^\vee \to J^\vee \to A \to 0,
    \]
    there is a surjection of $J^\vee\cong J\twoheadrightarrow A$ with connected
    kernel $C^\vee$.
\end{proof}

Using the machinery of modular symbols, Cremona has created large databases of
elliptic curves and their invariants, including the $J_0(N)$-optimal curve in
each isogeny class. In this database, the curves are labeled $NXT$, where $N$
is the conductor, $X$ is the isogeny class within that conductor, and $T$ is
the isomorphism class with that isogeny class. When $T=1$, then that curve is
the $J_0(N)$-optimal curve with its isogeny class. For example, the curve
$15a1$ is the $J_0(N)$-optimal curve within the isogeny class $15a$.

We will soon also be interested in $J_1(N)$-optimal elliptic curves. Though the
$J_0(N)$-optimal and $J_1(N)$-optimal curves often agree, this is not always
the case. We can use Algorithm~\ref{} to determine the Weierstrass equation of
the $J_1(N)$-optimal curve. Alternatively, we can use Stevens
Conjecture~\cite[Conjecture II]{stevens:param} which states that within an
isogeny class, the $J_1(N)$-optimal curve is the curve of minimal Faltings
height. This conjecture is still open but some progress has been made. Stein
and Watkins~\cite[\S 3]{stein-watkins:ns} have proved Stevens conjecture for
isogeny classes of prime conductor. Vatsal~\cite[Thm.
1.11]{vatsal:multiplicative} has proved Stevens conjectures for isogeny classes
containing an elliptic curve $E$ such that for some prime $\ell\geq 7$,
$E[\ell]$ is reducible and $E$ is ordinary at $\ell$.


\section{Old subvariety}%
\label{sec:old_subvariety}

Let $L$ be a proper divisor of $N$ and $t_1,\ldots,t_r$ be divisors of $N/L$ in
some order. For each divisor $t_i$, the degeneracy map (\ref{}) gives an
embedding $d_{L, t_i} ^*:J_0(L)\to J_0(N)$. We now gather all the degeneracy
maps coming from $J_0(N)$ to define
\[
    \Phi_L = \prod_{i=1} ^r d_{L,t_i} ^* : J_0(L)^r \to J_0(N).
\]
The \emph{old subvariety} of $J_0(N)$ is $\sum_{L\mid N} \Im\Phi_L$ and the
\emph{$N/L$-old subvariety} is $\Im\Phi_L$.

There is a strong relationship between $\ker \Phi_L$ and 
\[
    \Sigma(L)_0 ^r =\{(x_1,\ldots,x_r)\in \Sigma(L)^r: \sum x_i = 0\}.
\]
Because degeneracy maps agree on the Shimura subgroup~\cite[Theorem
4]{ling-oesterle:shimura}, $\Sigma(L)_0 ^r \subseteq \ker\Phi_L$. The reverse equality was
established by Ribet when $M$ a prime coprime to $L$ and was
generalized by Ling to:
\begin{theorem}[{\cite[Prop. 1]{ribet:raising}\cite[Thm. 3]{ling:shimura}}]
    \label{thm:ribet-ling}
    Let $L$ and $M$ be relatively prime integers with $M$ squarefree. Let
    \[
        \Phi_L = \prod_{i=1} ^r d_{L,t_i} ^* : J_0(L)^r \to J_0(LM)
    \]
    be as defined above. Then
    \begin{enumerate}
        \item 
            If $L$ is odd or $M$ is prime, then $\Sigma(L)_0 ^r=\ker\Phi_L$.
        \item
            If $L$ is even and $M$ is not a prime, then $[\ker\Phi_L:
            \Sigma(L)_0 ^r]$ is a power of 2.
    \end{enumerate}
\end{theorem}


However, when $\ker\Phi_L = \Sigma(L)_0 ^r$, there is an useful direct sum
decomposition of $\Im\Phi_L$, especially when $J_0(L)$ is an elliptic curve.

\begin{corollary}
    \label{cor:elliptic_decomp}
    Suppose that $\ker\Phi_L = \Sigma(L)_0 ^r$ and $E=J_0(L)$ is an elliptic
    curve. Then there is a $\QQ$-isomorphism
    \[
        \Im\Phi_L \cong E \times F^{r-1},
    \]
    where $F$ is the $J_1(L)$-optimal curve in the isogeny class of $E$.
\end{corollary}
\begin{proof}
    This follows from Proposition~\ref{prop:decomp} and
    Proposition~\ref{prop:optimal}.
\end{proof}

This decomposition is particularly useful because the $J_0(L)$-optimal curves
are identified in Cremona's table and the $J_1(L)$-optimal curves can be
identified using Steven's conjecture. For example, using this decomposition,
$J_0(22) = J_0(22)_\old \cong E\times F$, where $E$ is the $J_0(11)$-optimal
curve and $F$ is the $J_1(11)$-optimal curve (in this case, $E=J_0(11)$ and
$F=J_1(11)$). So computing the BSD invariants of $J_0(22)$ amounts to computing
the BSD invariants of the elliptic curves $E$ and $F$.

\begin{proposition}
    \label{prop:decomp}
    Suppose $\ker\Phi_L=\Sigma(L)_0 ^r$. Then there is a $\QQ$-isomorphism
    \[
        \Im\Phi_L \cong J_0(L)\times \Im(J_0(L)\to J_1(L))^r.
    \]
\end{proposition}
\begin{proof}
    For $i=1,\ldots,r-1$, let $m_i$ be
    integers so that $m_i \equiv 1 \mod{\#\Sigma(L)}$. Define
    \[
        D_1 = \delta_{t_1}, 
        \quad D_i = \delta_{t_i}-m_i\delta_{t_{i-1}}
    \]
    for $i=2,\ldots,r$. We first show
    \[
        \Im\Phi_L = \sum_{i=1} ^r \Im D_i
    \]
    with the sum being direct.

    Define $\Phi_L '=\prod_{i=1} ^r D_i : J_0(L)^r \to J_0(N)$. We have that
    $\Phi_L' = \Phi_L \circ T$, where
    \begin{align*}
        T:J_0(L)^r & \to J_0(L)^r \\
        (x_1,x_2,\ldots,x_r)&\mapsto (x_1-m_2x_2,x_2-m_3 x_3,\ldots,x_{r-1}-m_r
        x_r, x_r).
    \end{align*}
    The matrix associated to $T$ is consisted of $1$'s along the diagonal and
    $m_i$'s along the superdiagonal. It follows that
    \[
        \sum_{i=1} ^r \Im D_i = \Im \Phi_L.
    \]

    The goal is to now show that this sum is direct. Let $y_1,\ldots,y_r\in
    J_0(L)$. Suppose
    \begin{equation}
        \label{phiLprime}
        \Phi_L ' (y_1,\ldots,y_r) =D_1(y_1)+ \cdots +D_r(y_r)=0.
    \end{equation}
    Then that $T(y_1,\ldots,y_r)\in \ker\Phi_L=\Sigma(L)_0 ^r$.  This
    immediately implies that $y_r\in \Sigma(L)$ and then, by repeated
    back-substitution, $y_i\in \Sigma(L)$ for $i=1,\ldots,r$. Since $m_i \equiv
    1 \mod{\#\Sigma(L)}$,
    \[
        T(y_1,\ldots,y_r)=(y_1-y_2,y_2-y_3,\ldots,y_{n-1}-y_n,y_n).
    \]
    Since $T(y_1,\ldots,y_r)\in \Sigma(L)_0 ^r$, 
    \[
        (y_1-y_2)+(y_2-y_3)+\cdots+(y_{n-1}-y_n)+y_n =0.
    \]
    This implies that $y_1=0$ so $D_1(y_1)=0$. Moreover, for $i=2,\ldots,r$,
    \begin{equation*}
        D_i(y_i) 
            = \delta_{i-1}(-y_i) + \delta_i (y_i) 
            = \Phi_L (0,\ldots,0,-y_i,y_i,0,\ldots,0) 
            = 0,
    \end{equation*}
    where the last equality follows from the fact
    $(0,\ldots,0,-y_i,y_i,0,\ldots,0)\in \Sigma(L)_0 ^r$. Therefore, the terms
    in~\eqref{phiLprime} are trivial so $\sum \Im D_i$ is direct.

    Because degeneracy maps are injective~\cite{MR1141458}, the image of $D_1$
    is isomorphic to $J_0(L)$. Under the condition $\ker\Phi_L = \Sigma(L)_0
    ^r$, the kernel of $D_i$ for $i\geq 2$ is exactly $\Sigma(L)=\ker(J_0(L)\to
    J_1(L))$ so $\Im  D_i = \Im(J_0(N)\to J_1(N))$.
\end{proof}


\section{Connectedness of Hecke Algebra}%
\label{sec:connectedness_of_hecke_algebra}

Mazur~\cite[Prop. 10.6]{mazur:eisenstein} proves that the Hecke Algebra
$\TT(N)$ for $J_0(N)$ with $N$ prime is connected. This was done by showing any
direct product decomposition of $J_0(N)$ with $N$ prime contradicts the
irreducibility of the $\theta$-divisor. This was surprising to the author
as~\ref{cor:elliptic_decomp} gives a direct sum decomposition of $J_0(22)$. In
this section, we dissect Mazur's proof and give a mild generalization.
Moreover, we will explain why Mazur's argument fails in the composite case. 

\subsection{General results for semistable Jacobians}

We will begin with some fairly general results. So assume $J$ is a semistable
Jacobian defined over $\QQ$ that is possibly not $J_0(N)$. By~\cite[Corollary
1.4]{ribet:endo}, isogenies, endomorphisms, and abelian subvarieties (a priori
defined over $\QQbar$) are defined over $\QQ$. In this section, we use this
fact freely and will make no reference to the field of definition.

\begin{theorem}
    \label{thm:theta_irred}
    Any Jacobian $J$ taken with its principal polarization cannot be decomposed
    into a nontrivial direct sum of principally polarized abelian varieties.
\end{theorem}
\begin{proof}
    Any such decomposition will give a decomposition of the $\Theta$-divisor
    attached to $J$ which contradicts the irreducibility of the
    $\Theta$-divisor~\cite[\S 4(a)]{kempf:riemann}.
\end{proof}

\begin{lemma}
    \label{lemma:decomp_isogeny}
    Suppose $J$ decomposes nontrivially as the direct sum of abelian subvarieties
    $A\oplus B$. Then $A$ must share an isogenous factor with $B$.
\end{lemma}
\begin{proof}
    We proceed via contradiction. Suppose $A$ and $B$ share no isogenous
    factors. Let $\lambda:J\to \hat{J}$ be the principal polarization induced
    by its $\Theta$-divisor. Since $A$ shares no isogenous factors with $B$,
    $\lambda(A)=\hat{A}$ so $\lambda|_A$ is a polarization of $A$. Similarly,
    $\lambda|_B$ is a polarization of $B$. This now contradicts
    Theorem~\ref{thm:theta_irred}.
\end{proof}

\begin{lemma}
    \label{lemma:faithful}
    Let $R$ be a ring acting faithfully on $J$. Let $S=\{A_1,\ldots,A_k\}$ be a
    set of representatives of the isogeny class of subvarieties of $J$. 
    Suppose that for all $A\in S$, and every idempotent $r\in R$, either
    $rV_A=0$ or $rV_A=V_A$. Then $\Spec R$ is connected.
\end{lemma}
\begin{proof}
    Recall that $\Spec R$ is connected if and only if $R$ contains an
    idempotent $r$ different from $0$ or $1$. We proceed via by contradiction. 
    Let $r\in R$ be an idempotent different from $0$ or $1$. Then $K = rK
    \oplus (1-r) K$ is a decomposition of $K$ into subvarieties. Moreover, this
    decomposition is nontrivial because $R$ acts faithfully.
    
    Let $S_1=\{A\in S:rV_A=V_A\}$ and $S_2=\{A\in S:(1-r)V_A=V_A\}$. Observe
    that $r$ and $1-r$ kill every element of $S_2$ and $S_1$, respectively, so
    $S=S_1\sqcup S_2$. We can rewrite the previous decomposition as
    \[
        J 
        = rJ \oplus (1-r)J
        = \left(\sum_{A\in S_1} V_A \right)
        \oplus \left(\sum_{A\in S_2} V_A \right).
    \]
    The big summands share no isogenous factors which contradicts
    Lemma~\ref{lemma:decomp_isogeny}.
\end{proof}

\subsection{Application to modular abelian varieties}

The goal now is to apply Lemma~\ref{lemma:faithful} to the case of semistable
$J$ and subrings of the Hecke algebra $\TT$. Recall that the action of the
Hecke algebra on $J$ is faithful.

\begin{proposition}\label{prop:new_jacobian_connected} 
    Suppose that $J=J_{\new}$. Then $\Spec\TT$ is connected.
\end{proposition}
\begin{proof}
    When all subvarieties are new, they appear with multiplicity 1 so the
    conditions of Lemma~\ref{lemma:faithful} are automatic.
\end{proof}

\begin{proposition}
    Suppose $\TT'$ is the anemic Hecke algebra for $J$. Then $\Spec\TT'$ is connected.
\end{proposition}
\begin{proof}
    By Lemma~\ref{lemma:faithful}, it suffices to show that for any newform
    $f$, and $r\in \TT'$, $rV_f=V_f$ or $rV_f=0$. Fix a newform $f$ of level
    $L$ and $r\in \TT'$. We now abuse notation by overloading $T_\ell$ and $r$
    as operators on $A_f$, $A_f^s$, and $J$. In the Formulaire section
    of~\cite{ribet:old}, for $\ell\nmid N$, $T_\ell\circ \phi=\phi\circ T_\ell$
    when $N$ is prime. However, this is also true with $N$ squarefree since
    $T_\ell$ commutes with the pushforward and pullback of any degeneracy map
    $\delta_d$ with $d\mid N$. So for any prime $\ell\nmid N$, 
    \[
        T_\ell(\Phi_f(x_1,\ldots,x_s))
        = \Phi_f(T_\ell(x_1),\ldots,T_\ell(x_s)).
    \]
    It follows that
    \[
        r(\Phi_f(x_1,\ldots,x_s))
        = \Phi_f(rx_1,\ldots,rx_s).
    \]
    Therefore,
    \[
        rV_f = r(\Phi_f(A_f)) = \Phi_f(rA_f,\ldots,rA_f)
    \]
    but $A_f$ is simple so either $rA_f=A_f$ or $rA_f=0$. Therefore, by
    Lemma~\ref{lemma:faithful}, $\Spec\TT'$ is connected.
\end{proof}

\begin{example}
    When $N$ is prime, the argument Mazur~\cite[Prop. 10.6]{mazur:eisenstein}
    gives is essentially the same as
    Proposition~\ref{prop:new_jacobian_connected}. We see that this fails for
    $J=J_0(22)$ since $J=d_1(J_0(11))+d_2(J_0(11))$ so the factors appear with
    multiplicity greater than 1.

    Using \sage, we can show that the Hecke algebra of $J_0(22)$ is isomorphic
    to $\ZZ[i]$ and is thus connected. On the other hand,
    by~\ref{cor:elliptic_decomp}, $J_0(22)$ is the direct product of elliptic
    curves so the endomorphism ring is not connected.
\end{example}


\section{Subvarieties of $J_0(N)$}%
\label{sec:subvarieties_of_j_0_n_}

In this section, we will prove that every abelian subvariety of $J_0(N)$ is the
image of degeneracy map and discuss some interesting questions arising from
this.

\begin{proposition}
    \label{prop:integral_degen}
    Let $A$ be a simple subvariety of $J_0(N)$. There exists a divisor $L$ of
    $N$ and a newform $f$ of level $L$ such that $A_f \sim A$. Let
    $d_1,\ldots,d_r$ be the full collection of degeneracy maps from $J_0(L)$ to
    $J_0(N)$. Then there exists integers $n_1,\ldots,n_r$ such that $S:=\sum
    n_i d_i|_{A_f}: A_f\to A$ is an isogeny from $A_f$ to $A$. Note that $S$ is
    defined over $\QQ$.
\end{proposition}
\begin{proof}
    Let $V_f=\sum_{i=1} ^r d_i(A_f)$ and $\Phi:A_f ^r \to V_f$ be defined by
    $D(x_1,\ldots,x_r) = d_1(x_1)+\cdots+d_r(x_r)$. Let $K_f$ be the Fourier
    coefficient field of $f$. Since $A$ is an abelian subvariety of $V_f$, there
    exists $M\in \End_0(V)\cong M_r(\End_0(A_f)) = M_r (K_f)$ such that $\Im M
    = A$. Let $i:A_f\to A_f ^r$ be the inclusion map into the first coordinate.
    Then there exists $U\in \Aut(A_f ^r)=\GL_r (K_f)$ such that,
    \[
        \begin{tikzcd}
            A_f \arrow[r,"i"] &
            A_f ^r \arrow[r, dotted, "U"] &
            A_f ^r \arrow[r, "D"] &
            V_f \arrow[r, "M"] &
            A,
        \end{tikzcd}
    \]
    the map $T:=M \circ \Phi \circ U\circ i:A_f\to A\in \Hom_0(A_f, A)$ is
    nonzero. Since degeneracy maps are $K_f$-linear, there exists coefficients
    $a_1,\ldots,a_r\in K_f$ such that $T = \sum a_i d_i$. Now there exists
    $b\in \ZZ^*$ such that $T':=bT\in \Hom(A_f, A)$ is nonzero and hence an
    isogeny. Since $T'(\Lambda_{A_f})\subset \Lambda_A$, $T'=\sum q_i d_i$
    for $q_i\in \QQ$. Finally, there exists $w\in \ZZ^*$ such that
    $S:=wT'=\sum n_i d_i$ with $n_i\in \ZZ$.
\end{proof}



As we've seen in Section~\ref{}, it is often the case that $(L, N)$ satisfy the
$\star$-condition. Under these condition, the kernel of $S$ is always
Eisenstein.

The purpose of studying $\ker\Phi_L$ is the following computation. Let
$A\subseteq J_0(N)$ be isogenous to $A_f$ where $f$ is of level $L$. Then from
Proposition~\ref{prop:integral_degen}, there exists $S:=\sum n_i d_i:J_0(L)\to
J_0(N)$ such that $S(A_f)=A$. We may factor out $\gcd(n_1,\ldots, n_r)$ from
$S$ and assume that $\gcd(n_1, \ldots,n_r)=1$. Suppose $x\in \ker S$. Then 

\begin{proposition}
    \label{prop:star_eisenstein}
    Suppose $(L, N)$ satisfies the $\star$-condition, then $\ker S\subseteq
    \Sigma(L)$. In particular, this isogeny is Eisenstein.
\end{proposition}
\begin{proof}
    Suppose $x\in \ker S$. We will continue with equation~\eqref{eq:S_to_ker}
    so $(n_1 x, \ldots, n_r x)\in \ker\Phi_L = \Sigma(L)_0 ^r$. Hence, $n_i x\in
    \Sigma(L)$ for all $i$. Since $\gcd(n_1,\ldots,n_r)=1$, $x\in \Sigma(L)$.
\end{proof}

\begin{question}
    \label{question:iso}
    Let $A$ be a simple subvariety of $J_0(N)$ for some $N$. Let $\mathcal{I}$
    be the isogeny class of $A$. For all $B\in \mathcal{I}$, is $B$ a
    subvariety of $J_0(M)$ for some $M$?
\end{question}

\begin{example}
    Suppose $I$ is a Neumann-Setzer isogeny class of elliptic curves of
    conductor $p$. Then there are exactly 2 elliptic curves $E_0$ and $E_1$,
    where $E_0$ is $J_0(p)$-optimal and $E_1$ is $J_1(p)$-optimal
    (Stein-Watkins). Viewing $E_0$ as a subvariety of $J_0(p)$ and taking $q$
    to be a prime distinct from $p$, we have
    \[
        E_1 \isom \Im (d_1-d_q)(E_0)\subseteq J_0(pq),
    \]
    where $d_1, d_q:J_0(p)\to J_0(pq)$ are the natural degeneracy maps. This
    gives an affirmative answer to Question~\ref{question:iso} in the
    Neumann-Setzer isogeny class case.
\end{example}


\begin{question}
    Let $M$ be a $\Gal(\QQbar/\QQ)$-submodule of $J_0(L)$. Does there exists
    $N$ and an integral linear combination of degeneracy maps $S:=\sum n_i d_i$
    such that $\ker S=M$?
\end{question}

\begin{question}
    Is $\ker S$ always Eisenstein? This is true under the $\star$-condition.
\end{question}

\chapter{Algorithms for modular abelian varieties}

In this chapter, we will review algorithms on modular abelian varieties.

\section{Defining Data}

Let $\phi:A\to J$ be a finite degree homomorphism. Let $B=\Im \phi$ and $G$

\section{Cuspidal subgroup}
\section{Shimura subgroup}

\section{Simple abelian subvarieties as image of degeneracies}
\begin{algorithm}{Simple abelian subvarieties as image of degeneracies}%
    \label{alg:simple_degen}
    Given a simple abelian subvariety $A\subseteq J_0(N)$. This algorithm
    gives a newform $f$ and a linear combination of degeneracy maps
    $\phi=\sum n_i d_i:J_0(L)\to J_0(N)$ such that $\phi(A_f)=A$ with $L$ the
    level of $f$.
    \begin{enumerate}
        \item{} [Decompose]
            Use Algorithm~\ref{} to obtain the decomposition $J_0(N)=\sum_f
            V_f$, where the sum runs over newforms $f$ of level dividing $N$
            and $V_f$ is the sum of all abelian subvarieties of $J_0(N)$
            isogenous to $A_f$.
        \item{} [Determine newform]
            Find the newform $f$ of level $L$ so that $A\subseteq V_f$. 
        \item{} [Basis under degeneracy]
            Let $\{b_1,\ldots,b_r\}$ be a $\ZZ$-basis for $\Lambda_{A_f}$ and
            $\{d_1,\ldots,d_s\}$ be the set of degeneracy maps $d_j:J_0(L)\to
            J_0(N)$. 
        \item{} [Solve system]
            Let $x$ be any nonzero element element of $\Lambda_A$. Find
            $c_{ij}\in \QQ$ such that $x=\sum c_{ij} d_j(b_i)$.
        \item{} [Output]
            Let $i', j'$ be such that $c_{i'j'}\neq 0$. Let
            $(n_1,\ldots,n_s)\in \ZZ^s$ be the vector obtained by 
            clearing denominators from $(c_{i'1},\ldots,c_{i's})$.
    \end{enumerate}
\end{algorithm}


\begin{algorithm}{Weierstrass equation of 1-dimension abelian subvariety}
    Given a simple 1-dimensional subvariety $E$ of $J_0(N)$. This algorithm
    returns the Weierstrass equation for $E$.
    \begin{enumerate}
        \item{}
            [Isogeny from optimal subvariety] Use
            Algorithm~\ref{alg:simple_degen} to find a newform $f$ of level
            $L$ and isogenies $\phi:A_f\to E$.
        \item{}
            [Weierstrass of optimal subvariety] The Cremona tables contain the
            Weierstrass equations for optimal subvarieties of $J_0(L)$ so in
            particular, for $A_f$.
        \item{}
            [Kernel] Compute the kernel $M$ of $\phi$ and use the complex
            exponential map to identify $M$ as a set of points, $M'$ on the
            Weierstrass equation for $A_f$.
        \item{}
            [Velu's formulas] Output the Weierstrass equation of $A_f/M'$ using
            Velu's formulas.
    \end{enumerate}
\end{algorithm}

\section{Decomposing and Verifying Abelian subvarieties}

\begin{algorithm}{Identifying simple newform abelian subvarieties}%
    \label{alg:identifying_simples}
    Given a simple abelian subvariety $A$, this algorithm returns a newform $f$ and
    an isogeny $\phi:A_f\to A$.
\end{algorithm}

\begin{algorithm}{Decomposing and Verifying Abelian Subvarieties}
    \label{alg:decomp_and_verify_subvarieties}
    Let $J=J_0(N)$ and $V$ be a subspace of $0_1(J, \QQ)$. If $V$ corresponds
    to a subvariety $A$ of $J$, then this algorithm will return a decomposition
    into simples $X_i=(V_i, J)$ of $A$, otherwise, this algorithm will return
    `NO'. Let $\T=\{T_1,\ldots\}$ be the Hecke algebra of $J$.
    \begin{enumerate}
        \item{} [Decompose into potential Hecke eigenspaces]
            We first decompose $V$ into a direct sum $V=W_1\oplus \cdots \oplus
            W_r$ so that, for each $W_i$, there exists a newform $f_i$ of level
            dividing $N$, such that either $W_i$ either corresponds to an
            abelian subvariety isogenous to a power of $A_{f_i}$ or is not an
            abelian subvariety and we can return `NO'.
            \begin{enumerate}
                \item{} [Initialize]
                    Set $j=1$.
                \item{} [Decompose into eigenspaces]
                    Compute the simultaneous eigenspaces $U_{j,1},\ldots,U_{j,
                    n_j}$ of $\{T_1,\ldots,T_j\}$. If $\sum_{k=1} ^{n_j}
                    U_{j, k}\neq V$, return `NO'.
                \item{} [Compare with newforms]
                    Let $S_{j,k}$ be the set of newforms whose $l$th Fourier
                    coefficient agrees with the eigenvalue of $T_l$ on $U_{j,
                    k}$ for $l=1,\ldots,j$. If $S_{j, k}$ is empty for any
                    $k=1,\ldots,n_j$, return `NO'. If $S_{j,k}$ is not
                    singleton for any $k=1,\ldots, n_j$, increment $j$ and
                    return to (b). Otherwise, $S_{j,k}$ is singleton for all
                    $k$ so let $S_{j,k}=\{f_k\}$ and $W_k=U_{j,k}$.
            \end{enumerate}
        \item{} [Is isogenous to power?]
            We now verify that each $W_i$ is isogenous to a power of $A_{f_i}$
            and give its decomposition. The $W_i$'s are pairwise non-isogenous
            so we will do this individually for each $W_i$ and consider just a
            single pair $W$ and $A_f$ with $f$ being a newform of level $L$.
            Let $d_1,\ldots,d_r:J_0(L)\to J_0(N)$ be the full collection of
            degeneracy maps from $J_0(L)$ to $J_0(N)$.  Set $U=\{0\}$.
            \begin{enumerate}
                \item{} [Image of $\QQ$-combination of $d_j$'s?]
                    Choose any $v\in V\setminus U$. By
                    Proposition~\ref{prop:integral_degen}, if $W$ is an abelian
                    subvariety then there exists $q_1,\ldots,q_r\in \QQ$
                    such that $v\in \Im \left(\sum_{i=1} ^r q_i
                    \delta_i\right)$. If this is not the case, return
                    `NO'. Let $R = \Im \left(\sum_{i=1} ^r q_i
                    \delta_i\right)$. If $R\not\subset V$, return `NO'.
                \item{} [Full space?]
                    Replace $U$ with $U+R$. If $V=U$, we are done. Otherwise,
                    return to (b).
            \end{enumerate}
    \end{enumerate}
\end{algorithm}

\section{Map to Weierstrass equation}

In this section, we describe an algorithm for determining the Weierstrass
equation of a 1-dimensional modular abelian subvarieties given the Weierstrass
equations for optimal subvarieties of $J_0(N)$. The reason for doing this is to
take advantage of the computations already done as part of the Cremona
Database.

\begin{algorithm}{Weierstrass equation}% 
    \label{alg:weierstrass_equation}
    Given a 1-dimension modular abelian subvariety $A$. This algorithm returns  
\end{algorithm}


\section{Homomorphism spaces}

\section{Isogeny and isomorphism testing}

In this section, we give an algorithm for determining when a pair of simple
modular abelian varieties are isomorphic.

\begin{algorithm}{Is isomorphic?}%
    \label{is_isomorphic}
    Given simple modular abelian varieties $A, B$, this algorithm determine if
    $A, B$ are isomorphic. If so, this algorithm will also return an
    isomorphism between $A, B$.
    \begin{enumerate}
        \item{}
            [Isogenous?] Use Algorithm~\ref{} to find newforms $f,g$ and
            isogenies $\phi_f:A_f\to A$ and $\phi_g:A_g\to B$. If $f\neq g$,
            return `not isomorphic'. Otherwise, let $\phi:B\to A=\phi_g ^\vee
            \circ \phi_f$.
        \item{}
            [Square degree?] The composition $\phi^\vee \circ \phi:B\to B$ is
            the multiplication by $d$ map where $d$ is the degree of $\phi$. If
            $d$ is not square, return `not isomorphic'.
        \item{}
            [Endomorphism algebra] Use Algorithm~\ref{} to find a number field
            $K$, an order $\O\subseteq K$, and an isomorphism $\tau:\End(A)\to
            \O$.
        \item{}
            [$\Hom(A, B)$] Use Algorithm~\ref{} to compute $\Hom(A,B)$.
        \item{}
            [Image under $\phi$] Compute the image $H_f$ of $\Hom(A, B)$ in
            $\End(A)$ by composing with $f$.
        \item{}
            [Norm equation] Find solutions $x_1,\ldots,x_r$, up to units in
            $\O$, to the norm equation $\Norm_{\O} (x) = \pm \sqrt{d}$. If
            there are no solutions, return `not isomorphic'.
        \item{}
            [Isomorphic?] For each solution $x_i$, determine if $x_i\in H_f$,
            if so, $x_i \circ f^{-1}$ is an isomorphism from $A\to B$. If
            $x_i\notin H_f$ for all $x_i$, then return `not isomorphic'.
    \end{enumerate}
\end{algorithm}
\begin{proof}
    prove this
\end{proof}

\chapter{Totally Split Jacobians}%
\label{chap:totally_split}

A Jacobian is said to be \emph{totally split} if it is $\QQ$-isogenous to a
product of elliptic curves. The classification and construction of totally
split Jacobians of genus 2 curves has been
well-studied~\cite{bruin-doerksen:split_genus_two,kuhn:split_genus_two}
and large rational torsion subgroup of totally split Jacobians of genus 2 and 3
curves have been found~\cite{howe-leprevost-poonen:large}. The original
motivation of this project was to compute the rational torsion subgroup for as
many $J_0(N)$ as possible. The first $N$ for which Sage fails is $J_0(30)$
which happens to be a product of 3 elliptic curves. The author and his adviser
were able to compute the rational torsion subgroup using the fact that
$J_0(30)$ is totally split, the fact that rational torsion subgroups of
elliptic curves can be computed, and Galois cohomology. The goal of this
section is to prove that there are finitely many totally split $J_0(N)$, to
give a general (but totally impratical) method for computing the rational
torsion subgroup, and to present some more practical techniques for computing
the rational torsion subgroup. 



\section{Provably enumerating the set of totally split modular Jacobians}

The modular Jacobian $J_0(N)$ is totally split if and only if all newforms of
level dividing $N$ have rational Hecke coefficients. We expect this to be rare.
In fact, Ralph Greenberg quickly gave an argument on the way to UW Number
Theory Seminar lunch proving the set of totally split $J_0(N)$ is finite.
However, his argument did not give an effective method of enumeration. The goal
of this subsection is to provably enumerate the set of $J_0(N)$ that are
totally split. There are 71 of them that are nontrivial.

We have that $J_0(N)$ is totally split if and only if its dimension is equal to
the number of (modular) elliptic curves of conductor $N$. If $N$ is less than
the upper limit of conductors in the Cremona Database, then determining whether
$J_0(N)$ is totally split is a quick computation since there is a closed-form
formula for $\dim J_0(N)$.  

\begin{lemma}
    \label{lemma:good_primes}
    The only possible primes $p$ so that $J_0(p)$ is a totally split Jacobian are
    \[
        2, 3, 5, 7, 11, 13, 17, 19, 37.
    \]
\end{lemma}
\begin{proof}
    Let $J=J_0(p)$ be a totally split Jacobian of prime level. If $\dim J=0$,
    then $J$ is clearly totally split so assume $\dim J>0$. Then $J\cong
    \prod_f E_f$ with $E_f$'s elliptic curves of conductor $p$. Let $n$ denote
    the order of the rational cuspidal subgroup of $J$ which is, as mentioned
    above, known to be the numerator of $(p-1)/12$. By Emerton's proof of
    Stein's refined Eisenstein conjecture~\cite[Theorem B]{emerton:optimal}, if
    $l$ divides $n$, then $l$ divides the order of $E_f(\QQ)$ for some elliptic
    factor of $J$. But elliptic curves of prime conductor do not have much
    rational torsion.

    In particular, Miyawaki~\cite{miyawaki:ell_prime} enumerates all curves of prime
    power conductor with odd-order rational torsion. The largest prime
    conductor here being 37. This implies that if $p>37$, then $\#C(\QQ)$ must
    be a power of 2 so $p=2^a 3^b + 1$ for some $a\geq 0$ and $b\in \{0,1\}$.
    We now show $a\leq 2$.

    If $a>2$, then $C(\QQ)$ has an order 2 element which implies some $E_i$ has
    a rational 2-torsion point. As a result of Setzer~\cite[Theorem
    2]{setzer:ell_prime}, $p=17$ or $p=u^2+64$ for some integer $u$. We split into 2
    cases to show that $p$ is never $u^2+64$.

    Suppose $b=0$. Then $p$ is a Fermat prime and thus a Fermat number. Outside
    of $3$ and $5$, the recursive formula for Fermat numbers and an induction
    argument shows that the last digit of Fermat numbers is always $7$. But the
    only possible last digits of $u^2+64$ are $0, 3, 4, 5, 8, 9$.

    Suppose $b=1$. Then $2^a\cdot 3 = u^2+63$. This implies $3$ divides $u$ so
    $9$ divides $u^2$. But now the right-hand side is divisible by $9$ while the
    left is not.

    In conclusion, we know that if $J_0(p)$ is a totally split Jacobian, then $p\leq
    37$. A computer search then gives us the list found in the statement of the
    lemma.
\end{proof}

Call a positive integer $N$ \emph{good}, if $J_0(N)$ is totally split and
\emph{bad} otherwise. The simple factors of $J_0(N)$ are also factors of
$J_0(MN)$ for any positive integer $M$. Therefore, if $N$ is bad, then so is
any multiple of $N$. This allows us to prune branches while doing a search for
good integers on the divisiblity tree of the integers.

\begin{algorithm}{Enumerating Good Integers}
    \label{alg:find_split}
    Given a finite list of good primes $S$, this algorithm will halt and
    return the list of all good integers whose prime divisors lie in $S$
    if and only if this list is finite.
\end{algorithm}
\begin{enumerate}
    \item{} [Initialize] 
        Set $i=1$ and $M_1=S$. Here $M_i$ will represent the set of all good
        integers whose sum of exponents in the prime factorization is $i$.
    \item{} [Find prime multiples of $M_i$ are that good]
        Set
        \[
            M_{i+1}=\{pN: p\in S, N\in M_i, pN \text{ good}\}.
        \]
        If $M_{i+1}$ is non-empty, increment $i$ and repeat this step.
    \item [Return] 
        Return $\bigcup_i M_i$.
\end{enumerate}

\begin{theorem}
    There are 71 integers $N$ for which $J_0(N)$ is a totally split Jacobian of
    positive dimension. They are given in Table~\ref{tab:split_table}.
\end{theorem}
\begin{proof}
    We run Algorithm~\ref{alg:find_split} on the good primes found in
    Lemma~\ref{lemma:good_primes} and it halts (luckily before reaching the end
    of the Cremona database).
\end{proof}


\section{Enumerating rational torsion is algorithmic}

In this section, we give a completely impractical algorithm to show that
computing the rational torsion subgroup is possible.
\begin{proposition}
    Suppose $A$ is a totally split abelian subvariety of $J=J_0(N)$ Then we can
    compute the following data:
    \begin{enumerate}
        \item
            A number field containing $\QQ(A[n])$ for positive integer $n$.
        \item
            Let $n$ be a positive integer and $L$ be a number field containing
            $\QQ(A[n])$. The action of $\Gal(L/\QQ)$ on $A[n]$.
        \item 
            The $K$-rational torsion points of $A(K)_\tor$.
    \end{enumerate}
    In particular, we can compute the rational torsion subgroup of any totally
    split Jacobian.
\end{proposition}
\begin{proof}
    Recall that the abelian subvarieties are represented by giving a submodule
    of the integral homology~\ref{TODO}. Suppose $A$ is 1-dimensional subvariety of
    $J$. Then by~\ref{TODO}, we can compute an elliptic curve $E_A$ given in
    Weierstrass defining equation and an isomorphism $\Phi_A:A_\tor\to
    (E_A)_\tor$.

    We will proceed by induction on the dimension, $d$, of $A$. We first
    consider the case $d=1$. 
    \begin{enumerate}
        \item 
            Let $n$ be a positive integer. Then using division polynomials, we
            can compute a number field $L$ containing $\QQ(A[n])$.
        \item
            Let $n$ be a positive integer and $L$ be a number field containing
            $\QQ(A[n])$. The Galois action on the points of $E_A[n]$ is given
            by applying the Galois action to each coordinate. Using $\Phi_A$
            and the action of $\Gal(L/\QQ)$ on $E_A$, we can explicit determine
            the action of $\Gal(L/\QQ)$ on $A[n]$.
        \item
            Let $K$ be a number field. Using reduction mod $p$, there exists an
            integer $m$, such that that $A(K)_\tor \subseteq A[m]$. Using (1),
            we can define a number field $L$ that contains $\QQ(A[m])$. Then
            using (2), we can compute
            \[
                A(K)_\tor = A[m]^{\Gal(L/K)}.
            \]
    \end{enumerate}

    Now assume we can compute (1)-(3) for any totally split abelian subvariety
    of dimension less than $k$.

    Let $A$ be of dimension $k+1$ and write $A=B+C$, where $B$ is of
    dimension $k$ and $C$ is of dimension $1$.  We have the exact sequence
    \[
        0\to B\cap C \to B\times C \to A,
    \]
    where we identify $B\cap C$ as a subgroup of $B\times C$ via the
    anti-diagonal embedding. So $A=(B\times C)/(B\cap C)$. Let $r$ be the
    exponent of $B\cap C$. 
    \begin{enumerate}
        \item 
            For any integer $n$, $A[n] \subseteq B[nr]+C[nr]$. So a number
            field containing $\QQ(A[n])$ is the compositum  of the number
            fields containing $\QQ(B[nr])$ and $\QQ(C[nr])$ which can be
            computed by the inductive hypothesis.
        \item
            The Galois action can be determined on $A[n]$ by viewing $A[n]$ as
            a subgroup of $(B[nr]\times C[nr])/(B\cap C)$.
        \item
            Using reduction mod $p$, there exists an integer $m$ such that
            $A(K)_\tor\subseteq A[m]$. Using (1), we can find a number field
            $L$ that contains $\QQ(A[m])$. Then we use (2), to compute
            \[
                A(K)_\tor = A[m]^{\Gal(L/K)}.
            \]
    \end{enumerate}
\end{proof}

\section{Strategies for computing the rational torsion subgroup}

In this section, we give techniques for computing the rational torsion subgroup
of $J_0(N)$. Our main interest is the totally split rank-0 case
though our techniques may apply more generally (Example~\ref{}). There are 46
totally split rank 0 $J_0(N)$ and we have verified the Generalized Ogg
Conjecture for all but 9 Jacobians (Table~\ref{}). In those 9 cases, we are
able to bound the index $[J_0(N)(\QQ)_\tor:C_N(\QQ)]$ by a power of 2.

\subsection{Upper bound}%
\label{sub:upper_bound}

In this subsection, we describe methods for obtaining an upper bound on the
rational torsion order. 

Let $A$ be a modular abelian variety with good reduction at primes $p$. A
common technique for bounding $A(\QQ)_\tor$ is to inject it into the
$\Fp$-points for odd primes $p$ of good reduction. In particular,
by~\cite[Appendix]{katz:torsion}, if $\mathcal{A}$ is the Neron model for $A$,
then the reduction map gives the inclusion
\[
    A(\QQ)_\tor \hookrightarrow \mathcal{A}_{/p}(\Fp).
\]
In particular, if $S$ is any set of good odd primes,
\[
    \# A(\QQ)_\tor = \gcd_{p\in S}\{ \# \mathcal{A}_{/p}(\Fp)\}.
\]
The expression $\#\mathcal{A}_{\p}(\Fp)$ is an isogeny invariant and
multiplicative on direct products. So it suffices to describe how to compute
$\mathcal{A}_{/p}(\Fp)$ when $A=A_f\subseteq J_0(N)$. Let $F_p$ be the absolute
Frobenius at $p$ by Eicher-Shimura, $T_p = F_p + p/F_p\in
\End(\mathcal{A}_{/p})$. Then
\begin{equation}
    \label{eq:katz_bound}
    \#\mathcal{A}_{/p}(\Fp)=\deg(1-F_p)=|\det(1-F_p)|=\mathrm{charpoly}(F_p)(1)
    = \mathrm{charpoly}(T_p)(p+1).
\end{equation}
The last term can then be explicitly using modular symbols. For the case, where
$A_f\subseteq J_1(N)$, see~\cite[\S 3.5]{agashe-stein:bsd}. There are a few
disadvantages to~\eqref{eq:katz_bound}. One is the loss of the groups
structure. For example, if $A_f$ injects into both $\ZZ/2\times \ZZ/2$ and
$\ZZ/4$, then we know that $A_f$ is either $\ZZ/2$ or trivial. Another
disadvantages is the fact that~\eqref{eq:katz_bound}. In Example~\ref{}, we
show that it is impossible for this method to show $J_0(30)$ satisfies the
Generalized Ogg Conjecture. This example was the motivating example of this
project.

To take advantage of group structures, we use an idea of Stein which will part
of a forthcoming paper. For $\ell\nmid 2N$, let $\eta_\ell = T_\ell -
(1+\ell)\in \End(J)$.

\begin{lemma}[Stein]
    For every $\ell\nmid 2N$, $J(\QQ)_\tor\subseteq J(\RR)[\eta_\ell]$.
\end{lemma}

Let $s$ be the star-involution so $J(\CC)[s]=J(\RR)$ then
\[
    J(\QQ)_\tor \subseteq J[I^*],
\]
The advantage of this is that we still have information about the group
structure.

\section{Galois Cohomology Bounds}%
\label{sec:galois_cohomology_bounds}

Write up general approach to do totally split subvarieites

\section{General Approach}

This next lemma is a useful observation for computations but not interesting
from a theory points of view. The $E$ here will often be
\begin{lemma}
    Let $E$ be a finite subgroup of $J_0(N)$ containing $J_0(\QQ)_\tor$.
    Suppose $E\subseteq C(N)$. Then $J_0(N)(\QQ)_\tor=C(N)(\QQ)$.
\end{lemma}
\begin{proof}
    We already have that $C(N)(\QQ)\subseteq J_0(N)(\QQ)_\tor$. For the
    reverse equality, we take $\QQ$-rational points of $J_0(N)_\tor\subseteq E
    \subseteq C(N)$.
\end{proof}

\begin{proposition}
    Suppose $G$ is a finite subgroup of $J_0(N)$ containing $J_0(N)(\QQ)_\tor$.
    Let $x_1, \ldots, x_n\in G$ be any set of representatives for the quotient
    $G/C(\QQ)$. If $x_i\notin J(\QQ)_\tor$ for all $x_i\neq 0$, then the
    $J_0(\QQ)_\tor$ is cuspidal.
\end{proposition}
\begin{proof}
    Let $x\in J(\QQ)_\tor$. Then $x\in x_i+C(\QQ)$ for some representative
    $x_i$. This implies $x_i\in J(\QQ)_\tor$ so $x_i=0$, by assumption.
    Therefore, $x_i\in C(\QQ)$.
\end{proof}

\subsection{Approach to computing $J(\QQ)_\tor$}%
\label{sub:approach_to_computing_j_qq__tor_}

The following algorithm works for these Ns.
\begin{algorithm}
    Given a totally split Jacobian $J=J_0(N)$. This algorithm returns a bound on
    $[J(\QQ)_\tor:C(\QQ)]$.
    \begin{enumerate}
        \item{} [Stein's Real Eisenstein Kernel]
            Compute $E_s$ for some large $s$.
        \item{} [Representative for $E_s/C(\QQ)$]
            Let $x_1,\ldots,x_r$ be a set of for $E_s/C(\QQ)$.
        \item{} [Find small containing abelian varieity]
            For each $x_i$, find a small abelian subvariety, $A_i$, of $J_0(N)$
            contain $x_i$.
        \item{} [Verify Generalized Ogg Conjecture for $A_i$]
            Use Algorithm~\ref{} to attempt to verify the Generalized Ogg
            Conjecture for each $i$. If this succeeds, then the Generalized Ogg
            Conjecture is true for $J$.
    \end{enumerate}
\end{algorithm}



\chapter{Enumerating Isogenies of Prime Level Subvarieties}%
\label{chap:isogeny_class}

The goal of this section is, under mild conditions, to give an algorithm to
enumerate the odd-degree $\QQ$-isogeny class of simple abelian subvarieties
$A_f$ of $J_0(N)$ for $N$ prime, up to isomorphism. Given a $\QQ$-isogeny
$\psi:A_f\to A'$ with kernel $K$, so
\[
    0 \to K \to A_f \overset{\psi}{\to} A' \to 0.
\]
Since the isogeny is defined over $\QQ$, $K$ is a finite $G_\QQ$-submodule of
$A_f(\QQbar)$ which determines $A'$, up to isomorphism. Conversely, for every
$G_\QQ$-submodule $K$ of $A_f(\QQbar)$, there exists an isogeny of $A_f$ with
kernel $K$. Therefore, we will enumerate the odd-degree isogeny class of $A_f$,
by enumerating the finite odd-order $G_\QQ$-submodules of $A_f(\QQbar)$, up to
isomorphism of the image of the corresponding isogeny. 

We now fix notation, terminology, assumptions.
\begin{itemize}
    \item{} [Isomorphisms and Isogenies]
        Unless otherwise stated, all isomorphisms and isogenies are defined
        over $\QQ$.
    \item{} [Jacobian notation]
        Let $J = J_0(N)$ with $N$ prime. To avoid trivialities, assume $\dim
        J>0$ or equivalently, $N=11$ or $N\geq 17$. Let $\TT$ be the Hecke
        algebra of $J$ and $\I\subseteq \TT$ be the Eisenstein ideal.
    \item{} [Abelian subvariety notation]
        Let $A=A_f\subseteq J$ be a simple abelian subvariety of $J$. We will
        fix a single simple abelian subvariety $A$ and its isogeny class will
        be our object of study. We have that $A$ is $\TT$-invariant so let
        $\TT_A$ be the image of $\TT$ in $\End(A)$ and $\I_A$ be the image of
        the Eisenstein ideal in $\End(A)$. 
    \item{} [Number theory of $\TT_A$ notation] 
        Let $K_f$ be the Hecke eigenvalue field of $f$ so $K_f$ is a number
        field of degree equal to $\dim A$. Moreover, $\TT_A$ is isomorphic to
        an order in $K_f$. We will implicitly fix some embedding of $\TT_A$ and
        treat $\TT_A$ as a subset of $K_f$. Let $\O_K$ be the ring of integers
        of $K_f$ and $\f$ be the conductor of $\O_K$ over $\TT_A$.
    \item{} [Galois-Hecke group ring notation]
        Let $G_\QQ=\Gal(\QQbar/\QQ)$. The Hecke operators are defined over
        $\QQ$, so $\TT_A$ commutes with $G_\QQ$ and we can form the group ring
        $\TT[G_\QQ]=\TT_A[G_\QQ]$.
    \item{} [Equivalence relation notation]
        For finite $G_\QQ$-submodules $M$ and $M'$, we define a relationship
        $M\sim M'$ if and only if $A/M \isom A/M'$. For any $G_\QQ$-submodule
        $P$ of $A(\QQbar)$, let $\M(P)$ be set of equivalence classes of finite
        $G_\QQ$-submodules of $A(\QQbar)_\odd$ with a representative that is a
        submodule of $P$. So the goal of this chapter can be restated as
        enumerating a set of representatives of $\M(A(\QQbar)_\odd)$.
    \item{} [Sets of primes notation]
        Let $S_0=\{\m\in \Spec\TT[\frac 12]: \m \nmid
        \mathfrak{f}\mathcal{I}\}$ and $S_1 = \Spec\TT[\frac 12]\setminus S_0$.
        The best fact about $S_0$ is that its elements are invertible and the
        best fact about $S_1$ is that it is finite.
    \item{} [$S_0$ and $S_1$ decomposition notation]
        For an $\TT[G_\QQ]$-module $M$ of $A(\QQbar)_\odd$, let $M_{S_i}$ be the largest
        $\TT[G_\QQ]$-submodule of $M$ supported on $S_i$ so $M_{S_i}=M[\prod_{\p\in S_i}
        \p^\infty]$. Observe that $M = M_{S_0}\oplus M_{S_1}$.
    \item{} [Odd]
        A module is said to be odd if it is finite with odd cardinality.
\end{itemize}

The goal of this section is Algorithm~\ref{alg:odd_isogeny_class} which
enumerates the odd isogeny class of $A$ when $\TT_A$ is integrally closed. From
experimental data this conditions seems for be mild, at least for small primes.
In particular, there are 450 simple abelian varieties of prime level less than
1000 but only 42 are not integrally closed.

The idea will be as follows. Let $M$ be a odd $G_\QQ$-submodule of
$A(\QQbar)_\odd$. In
subsection~\ref{sec:finite_odd_order_galois_modules_are_hecke}, we will show
that $M$ is an $\TT[G_\QQ]$-module. This is useful because the $\TT$-structure is more
easily understood than the $G_\QQ$-structure. For example, we are now able to
talk about the support of $M$ as a $\TT$-module. Using
Proposition~\ref{prop:bound_support}, we can give an explicit set $S$ such that
every odd $G_\QQ$-module is equivalent to one supported on $S$. In other words,
$\M(A(\QQbar)_\odd)=\M(A[Q^\infty])$, where $Q$ is some ideal with
$\Supp(Q)=S$. Using Algorithm~\ref{}, we can compute the $G_\QQ$-submodules of
$\M(A[Q^r])$ for any $r$ and Proposition~\ref{prop:stop_looking} produces a $k$
such that $\M(A[Q^k])=\M(A[Q^\infty])=\M(A(\QQbar))$. In summary, we have the
following algorithm.
\begin{algorithm}{Odd isogeny class}%
    \label{alg:odd_isogeny_class}
    Let $A$ be a simple abelian subvariety with $\TT_A$ integrally closed. This
    algorithm will enumerate the odd isogeny class of $A$ by giving a set of
    representatives of $\M(A(\QQbar)_\odd)$.
    \begin{enumerate}
        \item{} [Class group representatives]
            Compute a set of odd integral representatives $H=\{\q\}$ of
            $\Cl(\TT_A)$. Let $Q = (\prod_{\q\in H} \q)(\prod_{\p\in S_1} \p)$. 
        \item{} [Initialize search]
            Set $r=1$ and $X_{r-1}=\emptyset$.
        \item{} [$G_\QQ$-submodules of $A[Q^r]$]
            Use Section~\ref{sec:enumerating_isogenies} to give a set, $X_r$,
            of representatives for $\M(A[Q^r])$.
        \item{} [Done?]
            By Corollary~\ref{prop:stop_looking}, if for all $x\in X_r$, $x\sim
            y$ for some $y\in X_{r-1}$, then $X_r$ is a set of representatives
            for $\M(A(\QQbar)_\odd)$. If this is not the case, increment $r$
            and repeat the last step.
        \item{} [Quotient and output]
            Output $A/M$ for $M\in X_r$.
    \end{enumerate}
\end{algorithm}

\section{Finite odd-order Galois Modules are Hecke}%
\label{sec:finite_odd_order_galois_modules_are_hecke}

The goal of this subsection is to prove every finite odd $G_\QQ$-submodule $M$
of $A(\QQbar)$ is a Hecke module (Theorem~\ref{thm:G_modules_are_Hecke}). The
Galois action of $J(\QQbar)$ has been extensively studied by
Mazur~\cite{mazur:eisenstein}, so we weaken our hypothesis to $M$ a
$G_\QQ$-submodule of $J(\QQbar)_\odd$. 

It suffices to prove $M$ is $\TT$-stable for each $G_\QQ$-composition factor $V$
of $M[\ell^\infty]$ for $\ell>2$. The irreducibility of $V$ implies that it is
$\ell$-torsion. Ribet~\cite[Proposition 6.1]{ribet:semistable_gal} shows that
$\TT/\ell \TT$ is generated by $T_p$ for primes $p\nmid \ell N$. We then reduce
modulo $p$ for $p\nmid \ell N$, and use Eichler-Shimura to derived its
$\TT$-stability from its $G_\QQ$-stability.

\begin{theorem}\label{thm:G_modules_are_Hecke}
    Suppose $M$ is a finite odd $G_\QQ$-submodule of $J_0(N)$, with $N$ prime.
    Then $M$ is a $\TT[G_\QQ]$-module.
\end{theorem}
\begin{proof}
    It suffices to show $M$ is $\TT$-stable for each $\ell$-primary part. Let
    $\ell>2$ and assume $M\subseteq J[\ell^\infty]$. Let
    \[
        0 = M_0 \subsetneq \ldots \subsetneq M_n = M
    \]
    be an $G_\QQ$-composition series of $M$ with composition factors $X_i =
    M_i/M_{i-1}$. We proceed by induction on $n$ with the base
    case being the trivial $n=0$ case. 
    
    Assume $M_{s-1}$ is an $\TT[G_\QQ]$-module. We will show $M_s$ is an
    $\TT[G_\QQ]$-module. Since $M_{s-1}$ is an $\TT[G_\QQ]$-module, for each
    $t\in \TT$, we have a well-defined map $t:X_s\to J(\QQbar)/M_{s-1}$. The
    goal is to show $t(X_s)\subseteq X_s$ for all $t\in \TT$.
    By~\cite[Proposition 2]{ribet:mult_p_finite}, $\TT/\ell \TT$ is generated
    by $T_p$ for $p\nmid \ell N$ so it suffices to show $T_p(X_s)\subseteq X_s$
    for prime $p\nmid \ell N$.

    Fix a prime $p\nmid \ell N$. So $J$ has good reduction at $p$. Fix a place
    $\p$ over $p$. The reduction map
    yields an isomorphism~\cite[Theorem 1, Lemma 2]{serre-tate}
    \[
        \tau:J(\QQbar)[\ell^\infty] \riso J_{/\F_p} (\Fpbar)[\ell^\infty]
    \]
    sending $\Frob_\p$ to $F_p$, where $F_p$ is the absolute Frobenius on
    $J_{/\F_p}$. Under this isomorphism the natural $\TT$-action on $J(\QQ)$
    maps to the natural $\TT$-action on $J_{/\F_p}$~\cite[\S
    5.2]{ribet-stein:serre}. By Eicher-Shimura, $T_p = F+p/F\in
    \End(J_{/\F_p})$ so
    \[
    \tau(T_p X_s) 
    = T_p\tau(X_s) 
    = (F+p/F)\tau(X_s)
    = \tau((\Frob_\p+p/\Frob_\p)X_s)
    \subseteq \tau(X_s)
    \]
    hence, $T_p X_s\subseteq X_s$, as desired.
\end{proof}


\section{Non-Eisenstein modules are kernels of Hecke}%
\label{sec:non_eisenstein_modules_are_kernels_of_hecke}

In light of Section~\ref{sec:finite_odd_order_galois_modules_are_hecke}, all
odd $G_\QQ$-submodules of $J(\QQbar)$ are $\TT$-modules. We will now
use this fact freely and will often refer to the $\TT$-support of an odd
$G_\QQ$-submodule.

The goal now is to identify the odd non-Eisenstein $G_\QQ$-submodules of
$J(\QQbar)_\odd$ by their $\TT$-annihilators. Using
Theorem~\ref{thm:G_modules_are_Hecke}, we can already do this in the
irreducible case.
\begin{corollary}
    Let $\m$ be a non-Eisenstein prime of odd residue characteristic, if $M$ is
    a nonzero finite irreducible $G_\QQ$-submodule of $J(\QQbar)$ supported
    only on $\m$, then $M=J[\m]$.
\end{corollary}
\begin{proof}
    By Lemma~\ref{lemma:cherry_street}, the annihilator of $M$ is $\m$. Hence,
    $M\subseteq J[\m]$ but $J[\m]$ is an irreducible
    $G_\QQ$-module~\cite[Proposition 14.2]{mazur:eisenstein} so $M=J[\m]$.
\end{proof}

The general case will follow from the work of David Helm~\cite{helm:jacobian}.
Helm considers the case of Jacobians, $J$, of Shimura curves. One of the key
inputs into Helm's proof is that for the maximal ideals $\m$ in question is
that if $T_\m J$ is the contravariant $\m$-adic Tate module, then $T_\m J/\m
T_\m J\cong J[\m]^\vee$ is dimension two over $\TT/\m$ and irreducible as a
$G_\QQ$-module. By~\cite[Prop. 14.2]{mazur:eisenstein}, this is also the case
for $J=J_0(N)$ and $\m$ a non-Eisenstein prime of odd residue characteristic.

\begin{theorem}[{\cite[Corollary 4.8]{helm:jacobian}}]%
    \label{thm:non_eisenstein_kernel_hecke}
    Let $M$ be a finite $G_\QQ$-module supported only on the non-Eisenstein
    primes of $\TT$ of odd residue characteristic with $\TT$-annihilator $I$.
    Then $M=J[I]$.

    Moreover, since $A$ is both $G_\QQ$ and $\TT$ invariant, if $M$ is a finite
    $G_\QQ$-module supported only on the non-Eisenstein primes of odd residue
    characteristic of $\TT_A$ with $\TT_A$-annihilator $I$. Then $M=A[I]$.
\end{theorem}

We have that $V(I)=\Supp_\TT(M)$ and $M\subseteq J[I]$ so suffices to prove
$J[I]_\m = M_\m$ for each non-Eisenstein prime of odd residue characteristic.
So let $\m$ be a non-Eisenstein prime of residue characteristic $\ell>2$. Let
$T_\m J\isom \Hom(J[\m^\infty], \QQ_\ell/\ZZ_\ell)$ be the contravariant Tate
module at $\m$ and $\overline{\rho}_\m$ be the Galois representation associated
to $J[\m]^\vee$. Since $\m$ is an odd non-Eisenstein prime,
$\overline{\rho}_\m$ is an irreducible $G_\QQ$-representation of dimension 2
over $k_\m$ that is isomorphic to $J[\m]^\vee$~\cite[Prop.
14.2]{mazur:eisenstein}.

\begin{lemma}[{\cite[Lemma 4.6]{helm:jacobian}}]\label{lem:finite_index}
    Let $M$ be a $G_\QQ$-stable submodule of $T_\m J$ of finite index. Then
    $M=IT_\m J$ for some ideal $I$ of $\TT$.
\end{lemma}
\begin{proof}
    We proceed by induction on the maximal $G_\QQ$-composition series of $T_\m J/M$
    with the base case being the trivial length zero case. Let 
    \[
        M = M_n \subsetneq M_{n-1} \subsetneq \cdots \subsetneq M_0 = T_\m J
    \]
    be a $G_\QQ$-composition series. By induction, $M_{n-1} = I'T_\m J$ for some
    $I'\subseteq \TT$.

    Consider $\m M_{n-1} + M$. This is a $G_\QQ$-module sitting between $M$ and
    $M_{n-1}$. By Nakayama's lemma, if $\m M_{n-1} M + M = M_{n-1}$, then
    $M=M_{n-1}$ which is a contradiction. Hence, $\m M_{n-1}+M=M$ so $M$
    contains $\m M_{n-1}$ and we can form the quotient.

    The module $M_{n-1}/\m M_{n-1}$ is $G_\QQ$-isomorphic to $(I'/\m
    I')\otimes_{\TT/\m} (T_\m J/\m T_\m J) \cong (I'/\m I')\otimes_{\TT/\m}
    J[\m]^\vee$, where $G_\QQ$ acts trivially on $I'/\m I'$. Let $V$ be the image
    of $M$ in $M_{n-1}/\m M_{n-1}$. Since $V$ is $G_\QQ$-invariant, and
    $J[\m]^\vee$ is irreducible, $V$ is given by $\hat{V}\otimes J[\m]^\vee$
    for some $\TT/\m$-subspace $\hat{V}$ of $I'/\m I'$. Let $I$ be the preimage
    of $\hat{V}$ in $I'$. Then $IT_m J = M$, since both contain $\m M_{n-1}$
    and map to $V$ modulo $\m M_{n-1}$.
\end{proof}

We now return to the proof of Theorem~\ref{thm:non_eisenstein_kernel_hecke}.

\begin{proof}[proof of Theorem~\ref{thm:non_eisenstein_kernel_hecke}]
    Let $B=J/M$ be the quotient abelian variety equipped with the induced
    $\TT$-action. So the projection $\phi:J \to B$ is an $\TT[G_\QQ]$-isogeny
    with $\ker\phi = M$. For any odd non-Eisenstein prime $\m$, $\phi$ induces
    the exact sequence
    \[ 
        0 \to T_\m B \to T_\m J \to M^\vee _\m \to 0.
    \] 
    In particular, the image of $T_\m B$ under $\phi$ is a finite index
    $\TT[G_\QQ]$-submodule of $T_\m A$. By Lemma~\ref{lem:finite_index}, we can find
    an ideal $I'$ of $\TT$ such that the image of $T_\m B$ is $I' _\m T_\m A$
    for all odd non-Eisenstein primes $\m$. We have $M^\vee _\m = T_\m J / I'
    T_\m J\cong J[I']_\m ^\vee$. Therefore, by taking annihilators of the dual,
    we have that $I_\m = I'_\m$ and then by taking duals $M_\m = J[I]_\m$, as
    desired.
\end{proof}

\section{Enumerating representatives of $A[X]$}

Assume $\TT_A$ is integrally closed and let $X$ be an odd ideal of $\TT_A$. The
goal of this section is to give a set of representatives for $\M(A[X])$ by
first enumerating the $G_\QQ$-submodules of $A[X]$. We
have the decomposition $X=\bigoplus_{\p\in \Supp_{\TT_A} (X)} X[\p^{v_\p(X)}]$
so it suffices to enumerate the $G_\QQ$-submodules of $A[\p^s]$ for any $s\geq
1$. This will now follow from Mazur's study of the Galois action on torsion
points~\cite[\S 14]{mazur:eisenstein}.

\begin{proposition}[Mazur]\label{prop:all_G_subs}
    Let $\p$ be a prime of residue characteristic $\ell>2$.
    \begin{enumerate}
        \item 
            If $\p$ is Eisenstein, then $A[\p]=C_A[\ell]\oplus \Sigma_A[\ell]$,
            where $C_A=C\cap A$ and $\Sigma_A=\Sigma \cap A$ with $C$ and
            $\Sigma$ the cuspidal and Shimura subgroups of $J$. The
            $G_\QQ$-submodules of $A[\p]$ are the direct sum of $\ZZ$-submodules of
            $C_A[\ell]$ and $\ZZ$-submodules of $\Sigma_A[\ell]$.
        \item
            if $\p$ is non-Eisenstein, $A[\p]$ is irreducible~\cite[Prop
            14.2]{mazur:eisenstein} as as a $G_\QQ$-module so the only
            $G_\QQ$-submodules are $0$ and $A[\p]$.
    \end{enumerate}
\end{proposition}
\begin{proof}
    The Eisenstein case is~\cite[Corollary 16.3]{mazur:eisenstein} along with
    the fact that $C[\ell]\isom \ZZ/\ell$ and $\Sigma[\ell]\isom \mu\ell$.

    The non-Eisenstein case is~\cite[Propositon 14.2]{mazur:eisenstein}.
\end{proof}

Let $a\in \p^{s-1}\setminus \p^s$ so $a$ generates $\p^{s-1}/\p^s$ as a
$k_\p$-space. There exists a $\TT_A[G_\QQ]$-injection given by
$\phi_s:A[\p^s]/A[\p^{s-1}]\to A[\p]$. The $G_\QQ$-submodules, $M$, of
$A[\p^s]$ are then the $\ZZ$-submodules of $A[\p^s]$ such that $M\cap
A[\p^{s-1}]$ and $\phi_s(M)$ are $G_\QQ$-submodules. This yields the following
algorithm.

\begin{algorithm}{Enumerating $G_\QQ$-submodules of {$A[X]$}}
    Given an odd ideal $X$ of $\TT_A$. This algorithm will output a set of
    representatives for $\M(A[X])$.
    \begin{enumerate}
        \item{} [Factor $X$]
            Compute the factorization $X=\prod \p_i ^{e_i}$.
        \item{} [Non-Eisenstein part]
            For each non-Eisenstein $\p_i$, let $W_i=\{A[\p^j]: 0 \leq j
            \leq e_i\}$.
        \item{} [Eisenstein part]
            For each Eisenstein $\p_i$, set $V_1$ to be the set of
            $G_\QQ$-submodules of $A[\p]$. For $j=2,\ldots,e_i$, set $V_j$ to
            be the set of $\ZZ$-submodules, $M$, of $A[\p^j]$ such that $M\cap
            A[\p^{j-1}]\in V_{j-1}$ and $\phi(M)\in V_1$.
        \item{} [Combine]
            Combine the $W_i$'s to form $W=\{\sum_i M_i: M_i \in W_i\}$.
        \item{} [Output representatives]
            Use Algorithm~\ref{isom_testing} to produce a set of
            representatives of $\M(A[X])$ of elements of $W$.
    \end{enumerate}
\end{algorithm}

\section{Bounding support and valuations}%
\label{sec:bounding_support_and_valuations}

The goal of this section is to give an ideal $Q$ such that
$\M(A[Q^\infty])=\M(A(\QQbar)_\odd)$ (Proposition~\ref{prop:bound_support}). In
light of Faltings' Isogeny Theorem, there exists $k$ such that
$\M(A[Q^k])=\M(A(\QQbar)_\odd)$. We give a method for finding this $k$ as
Proposition~\ref{prop:stop_looking}. We now have all the necessary ingredients
for Algorithm~\ref{alg:odd_isogeny_class}.

\begin{lemma}\label{lem:com_alg}
    Let $a,b\in \TT_A$, $\p$ such the localization $(\TT_A)_\p$ is a DVR, and
    $M$ an finite odd $G_\QQ$-submodule of $A(\QQbar)$ with $Z=\Ann_{\TT_A} M$.
    Then
    \begin{enumerate}
        \item 
            If $v_\p(Z) = k$, then $M[\p^\infty]\subseteq A[\p^k]$.
        \item
            We have $b^{-1}(A[Z])=A[bZ]$. This holds locally at $\p$ as well so
            $b_\p ^{-1} A[Z]_\p = A[bZ]_\p$.
        \item
            Let $r=v_\p(b)-v_\p(a)+k$ and $\phi=a\circ b^{-1}$. If $r\leq
            0$, then $\phi(M)[\p^\infty]=0$ so $\phi(M)_\p=0$.
            
            If $r>0$, then
            $\phi(M)[\p^\infty]\subseteq A[\p^r]$. Here $b^{-1}$ is the
            preimage of $b$.
    \end{enumerate}
    We will take on the convention that for negative $r$, $A[\p^r]=0$. So we can
    write the last part as $\phi(M)[\p]\subseteq A[\p^r]$.
\end{lemma}
\begin{proof}
    \mbox{}
    \begin{enumerate}
        \item 
            Suppose $x\in M[\p^\infty]$ so $x\in A[\p^\infty]$. Moreover,
            $v_\p(\Ann_{\TT_A} x) \leq v_\p(Z) = k$ so $x\in A[\p^k]$.
        \item
            We have $x\in b^{-1}(A[Z])$ if and only if $bx \in A[Z]$ if and
            only if $x\in A[bZ]$.
        \item
            Suppose $r\leq 0$, then $\phi_\p \in Z_\p$ so
            \[
                \phi(M)[p^\infty]\subseteq \phi(M[\p^\infty])
                \subseteq \phi(A[\p^k]) = 0.
            \]
            Suppose $r>0$ and then $x\in \phi(M)[\p^\infty] =
            \phi(M[\p^\infty])\subseteq (a\circ
            b^{-1})(A[\p^k])=A[\p^r]$.
    \end{enumerate}
\end{proof}


\begin{lemma}\label{lem:principal_gives_iso}
    Let $C, D$ be nonzero ideals of $\TT_A$, $a,b\in \TT_A$ be nonzero, and $aC
    = bD$. Then there exists an isomorphism $\phi:A/A[D]\to A/A[C]$ such that
    $\phi\circ b=a$.
\end{lemma}
\begin{proof}
    Our argument will now reference the following diagram.
    \[
        \begin{tikzcd}
            A/A[bD] 
            \arrow[r, "\sim", "b"']
            \ar[equal]{d}
            &
            A/A[D]
            \ar[d, "\sim" labl, "\phi"]
            \\
            A/A[a C]
            \arrow[r, "\sim", "a"']
            &
            A/A[C]
        \end{tikzcd}
    \]
    We first establish the $b$ and $a$ isomorphism. We have the exact
    sequence
    \[
        \begin{tikzcd}
            0
            \arrow[r]
            &
            (A/A[D])[b]
            \arrow[hookrightarrow]{r}
            &
            A/A[D]
            \arrow[twoheadrightarrow]{r}{b}
            &
            A/A[D]
            \arrow[r]
            &
            0
        \end{tikzcd}.
    \]
    We have that $x\in (A/A[D])[b]$ if and only if $bx \in A[D]$ if and only if
    $x \in A[bD]$. Hence, $(A/A[D])[b]=A[bD]/A[D]$ so $b:A/A[bD]\xra{\sim}
    A[D]$. A similar argument applies for $a$. 

    We can now chase the diagram to obtain an isomorphism $\phi:A/A[D]\riso
    A/A[C]$, as desired.
\end{proof}

Let $H=\{C_i\}$ be a set of integral representatives for $\Cl(\TT_A)$ and
${S=S_1\cup\bigcup_{C\in H}V(C)}$.

\begin{proposition}%
    \label{prop:bound_support}
    Every finite odd $G_\QQ$-submodule is equivalent to one supported on $S$.
\end{proposition}
\begin{proof}
    Let $M$ be a finite odd $G_\QQ$-submodule. Let $M=M_{S'}\oplus M_S$ be the
    direct sum decomposition of $M$ with $\Supp M_X \subseteq X$. By
    Theorem~\ref{thm:non_eisenstein_kernel_hecke}, there exists an ideal
    $I$ of $\TT_A$ with $V(I)\subseteq S'$. Since $S'$ consists of only
    invertible primes, $I$ is also invertible. So there exists nonzero $a,b\in
    \TT_A$ such that $bI=aC$. By Lemma~\ref{}, there exists an isomorphism
    $\phi:A/A[I]\to A/A[C]$ such that $\phi\circ b = a$. Let $\psi:A/A[I]\to
    A/(A[I]+M_S)$ be the isogeny given by quotienting by $M_S/A[I]$. Then
    $\phi$ induces an isomorphism $\phi':A/(A[I]+M_S)\to A/(A[C]+\phi(M_S))$.

    It is clear that $\Supp_{\TT_A}(A[C])\subseteq S$ so it remains to show
    that $\phi(M_S)_\p =0$ for all $\p \in S'$. Let $\p\in S'$, then
    $v_\p(b)-v_\p(a)+v_\p(\Ann(M_S))=v_\p(C)-v_\p(I)+v_\p(\Ann(M_S)) \leq 0$
    since $V(C),V(\Ann(M_S))\subseteq S$. By Lemma~\ref{lem:com_alg},
    $\phi(M_S)_\p = 0$. Therefore, $A[C]+\phi(M_S)$ is supported on $S$.
\end{proof}

From henceforth, we assume that $\TT_A$ is integrally closed. We can now choose
$H=\{C_i\}$ to be a set of integral representatives for $\Cl(\TT_A)$ of odd
norm. Let $Q=\lcm(\{C:C\in H\}\cup \{\p:\p\in S_1\})$. We have that $V(Q)=S$
so, in light of Proposition~\ref{prop:bound_support},
$\M(A[Q^\infty])=\M(A(\QQbar)_\odd)$.

\begin{proposition}%
    \label{prop:stop_looking}
    Suppose $\TT_A$ is integrally closed. Suppose $\M(A[Q^k])=\M(A[Q^{k+1}])$
    then $\M(A[Q^k])=\M(A[Q^\infty])$.

    In terms of isogenies, this claim states that if $G_\QQ$-submodules of
    $A[Q^{k+1}]$ produce no new odd-isogenies not found in $A[Q^k]$, then
    $G_\QQ$-submodules of $A[Q^k]$ give the entire odd-isogeny class.
\end{proposition}
\begin{proof}
    Every isogeny can be factored into a composition of irreducible isogenies.
    Let $A'=A/M$ be a abelian variety with $M$ a $G_\QQ$-submodule of $A[Q^k]$. We
    will show that the image of $A'$ under an irreducible isogeny is equivalent
    to $A/Y$ for some $Y\in A[Q^{k+1}]$. This suffices because when
    $A[Q^k]=A[Q^{k+1}]$, we obtain the full isogeny class.

    Let $M'\subseteq A(\QQbar)_\odd$ be an extension of $M$ by an irreducible
    $G_\QQ$-module $Y$. Let $\m$ be the annihilator of $Y$. If $\m\in S$, then
    $M\subseteq A[\m Q^k]\subseteq A[Q^{k+1}]$ and we are done. So assume
    $\m\notin S$ so $\m$ is an odd Eisenstein prime and $Y=A[\m]$
    (Theorem~\ref{thm:irreducible_G_sub}). Since $\m\notin \Supp_{\TT_A}(M)$,
    $M' = A[\m]\oplus M$. As in Proposition~\ref{prop:bound_support}, there is
    an isomorphism $\phi':A/(A[I]+M_S)\to A/(A[C]+\phi(M_S))$ with $\phi\circ b
    = a$. The goal is to show $A[C]+\phi(M)\subseteq A[Q^k]$. Since
    $A[C]\subseteq A[Q^{k+1}]$ so it suffices to show $\phi(M)\subseteq
    A[Q^{k+1}]$.
    
    As in Proposition~\ref{prop:bound_support}, $\Supp\phi(M)\subseteq S$. For all
    $\p\in S$ (remember that $\m \notin S$), $v_\p(b)-v_\p(a) =
    v_\p(C)-v_\p(\m)=v_\p(C)$ so by Lemma~\ref{lem:com_alg},
    $\phi(M)\subseteq A[Q^{k+1}]$, as desired.
\end{proof}

\section{Further Questions}

\chapter{Tables}

\include{table_enumerate_totally_split}

\bibliographystyle{amsalpha}
\bibliography{biblio}
\end{document}
% (11, 1)
% (14, 1)
% (15, 1)
% (17, 1)
% (19, 1)
% (20, 1)
% (21, 1)
% (24, 1)
% (27, 1)
% (32, 1)
% (36, 1)
% (49, 1)
% (22, 1)
% (26, 1)
% (28, 1)
% (50, 1)
% (30, 1)
% (33, 1)
% (34, 1)
% (40, 1)
% (45, 1)
% (48, 1)
% (64, 1)
% (38, 1)
% (44, 1)
% (54, 1)
% (42, 1)
% (52, 1)
% (56, 1)
% (72, 1)
% (75, 1)
% (60, 1)
% (80, 1)
% (100, 1)
% (76, 1)
% (66, 1)
% (96, 64)
% (108, 1)
% (84, 8)
% (90, 16)
% (144, 64)
% (120, 512)
% (132, 32)
% (150, 16)
% (168, 512)
% (180, 128)

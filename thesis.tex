\documentclass{article}
\bibliographystyle{amsalpha}
\include{modabvar/macros}
\usepackage{url}
\usepackage{hyperref}
\usepackage{booktabs}
\usepackage{tikz-cd}

\renewcommand{\old}{\mathrm{old}}
\renewcommand{\tor}{\mathrm{tor}}

\author{Kevin Lui}
\title{Explicit Isogenies of $J_0(N)$}
\begin{document} 
\maketitle
\tableofcontents 
\listoftables

\newpage
\section{Introduction}%
\label{sec:intro}


In this thesis, we compute explicit with isogenies of $J_0(N)$. 

We say a Jacobian is totally split if it is $\QQ$-isogenous to a product of
elliptic curves. In Section~\ref{sec:totally_split}, we present techniques for
computing the rational torsion subgroup of totally splt $J_0(N)$.

In Section~\ref{sec:enum_isogenies}, we present techniques enumerating the
$\QQ$-isogeny class of $J_0(N)$ under various conditions.


\section{Background and random facts about $J_0(N)$}%
\label{sec:back}

% TODO: special maps

% TODO: insert old-subvariety, ling-ribet-shimura decomp


% TODO: insert connected.tex, motivated from the earlier decomp

\subsection{Connecteness of Hecke Algebra}%
\label{sub:connecteness_of_hecke_algebra}

In~\cite{}, Mazur proves that the Hecke Algebra $\TT(N)$ for $J_0(N)$ with $N$
prime is connected. This was done by showing any direct product decomposition
of $J_0(N)$ contradicts the irreducibility of the $\theta$-divsior. In
Example~\ref{}, we show that $J_0(22)$ is a direct sum of elliptic curves. In
this section, we give a mild generalization of Mazur's result in the semistable
case and explain why Mazur's argument does not apply to $J_0(22)$.


\subsubsection{General results for semistable Jacobians}

We will begin with some fairly general results. So assume $J$ is a semistable
abelian variety that is possibly not $J_0(N)$. By~\cite[Corollary 1.4]{ribet:endo}, isogenies,
    endomorphisms, and abelian subvarieties (a priori defined over $\QQbar$)
    are defined over $\QQ$. In this section, we use this fact freely and will
    often make no reference to the field of definition.

\begin{theorem}
    \label{thm:theta_irred}
    Any Jacobian $J$ taken with its principal polarization cannot be decomposed
    into a nontrivial direct sum of principally polarized abelian varieties.
\end{theorem}
\begin{proof}
    Any such decomposition will give a decomposition of the $\Theta$-divisor
    attached to $J$ which contradicts the irreducibility of the
    $\Theta$-divisor~\cite[\S 4(a)]{kempf:riemann}.
\end{proof}

\begin{lemma}
    \label{lemma:decomp_isogeny}
    Suppose $J$ decomposes nontrivially as the direct sum of abelian subvarieties
    $A\oplus B$. Then $A$ must share an isogenous factor with $B$.
\end{lemma}
\begin{proof}
    We proceed via contradiction. Suppose $A$ and $B$ share no isogenous
    factors. Let $\lambda:J\to \hat{J}$ be the principal polarization induced
    by its $\Theta$-divisor. Since $A$ shares no isogenous factors with $B$,
    $\lambda(A)=\hat{A}$ so $\lambda|_A$ is a polarization of $A$. Similarly,
    $\lambda|_B$ is a polarization of $B$. This now contradicts
    Theorem~\ref{thm:theta_irred}.
\end{proof}

\begin{lemma}
    \label{lemma:faithful}
    Let $R$ be a ring acting faithfully on $J$. Let $S=\{A_1,\ldots,A_k\}$ be a
    set of representatives of the isogeny class of subvarieties of $J$. 
    Suppose that for all $A\in S$, and every idempotent $r\in R$, either
    $rV_A=0$ or $rV_A=V_A$. Then $\Spec R$ is connected.
\end{lemma}
\begin{proof}
    Recall that $\Spec R$ is connected if and only if $R$ contains an
    idempotent $r$ different from $0$ or $1$. We proceed via by contradiction. 
    Let $r\in R$ be an idempotent different from $0$ or $1$. Then $K = rK
    \oplus (1-r) K$ is a decomposition of $K$ into subvarieties. Moreover, this
    decomposition is nontrivial because $R$ acts faithfully.
    
    Let $S_1=\{A\in S:rV_A=V_A\}$ and $S_2=\{A\in S:(1-r)V_A=V_A\}$. Observe
    that $r$ and $1-r$ kill every element of $S_2$ and $S_1$, respectively, so
    $S=S_1\sqcup S_2$. We can rewrite the previous decomposition as
    \[
        J 
        = rJ \oplus (1-r)J
        = \left(\sum_{A\in S_1} V_A \right)
        \oplus \left(\sum_{A\in S_2} V_A \right).
    \]
    The big summands share no isogenous factors which contradicts
    Lemma~\ref{lemma:decomp_isogeny}.
\end{proof}

\subsubsection{Application to modular abelian varieties}

The goal now is to apply Lemma~\ref{lemma:faithful} to the case of semistable
$J$ and subrings of the Hecke algebra $\TT$. Recall that the action of the
Hecke algebra on $J$ is faithful.

\begin{proposition}\label{prop:new_jacobian_connected} 
    Suppose that $J=J_{\new}$. Then $\Spec\TT$ is connected.
\end{proposition}
\begin{proof}
    When all subvarieties are new, they appear with multiplicity 1 so the
    conditions of Lemma~\ref{lemma:faithful} are automatic.
\end{proof}

\begin{proposition}
    Suppose $\TT'$ is the anemic Hecke algebra for $J$. Then $\Spec\TT'$ is connected.
\end{proposition}
\begin{proof}
    By Lemma~\ref{lemma:faithful}, it suffices to show that for any newform
    $f$, and $r\in \TT'$, $rV_f=V_f$ or $rV_f=0$. Fix a newform $f$ of level
    $L$ and $r\in \TT'$. We now abuse notation by overloading $T_\ell$ and $r$
    as operators on $A_f$, $A_f^s$, and $J$. In the Formulaire section
    of~\cite{ribet:old}, for $\ell\nmid N$, $T_\ell\circ \phi=\phi\circ T_\ell$
    when $N$ is prime. However, this is also true with $N$ squarefree since
    $T_\ell$ commutes with the pushforward and pullback of any degeneracy map
    $\delta_d$ with $d\mid N$. So for any prime $\ell\nmid N$, 
    \[
        T_\ell(\Phi_f(x_1,\ldots,x_s))
        = \Phi_f(T_\ell(x_1),\ldots,T_\ell(x_s)).
    \]
    It follows that
    \[
        r(\Phi_f(x_1,\ldots,x_s))
        = \Phi_f(rx_1,\ldots,rx_s).
    \]
    Therefore,
    \[
        rV_f = r(\Phi_f(A_f)) = \Phi_f(rA_f,\ldots,rA_f)
    \]
    but $A_f$ is simple so either $rA_f=A_f$ or $rA_f=0$. Therefore, by
    Lemma~\ref{lemma:faithful}, $\Spec\TT'$ is connected.
\end{proof}

\begin{remark}
    When $N$ is prime, the argument Mazur~\cite[Prop. 10.6]{mauzr:eisenstein}
    gives is essentially the same as
    Proposition~\ref{prop:new_jacobian_connected}. We see that this fails for
    $J=J_0(22)$ since it decomposes into two isogenous factors.
\end{remark}


% TODO: insert subvarieties.tex, would be cool to check computationally if all
% subvarieties, make this into algorithm?

\subsection{Subvarieties of $J_0(N)$}%
\label{sub:subvarieties_of_j_0_n_}

In this section, we will prove that every abelian subvariety of $J_0(N)$ is the
image of degeneracy map and discuss some interesting questions arising from
this.

\begin{proposition}
    \label{prop:integral_degen}
    Let $A$ be a simple subvariety of $J_0(N)$. There exists a divisor $L$ of
    $N$ and a newform $f$ of level $L$ such that $A_f \sim A$. Let
    $d_1,\ldots,d_r$ be the full collection of degeneracy maps from $J_0(L)$ to
    $J_0(N)$. Then there exists integers $n_1,\ldots,n_r$ such that $S:=\sum
    n_i d_i|_{A_f}: A_f\to A$ is an isogeny from $A_f$ to $A$. Note that $S$ is
    defined over $\QQ$.
\end{proposition}
\begin{proof}
    Let $V_f=\sum_{i=1} ^r d_i(A_f)$ and $\Phi:A_f ^r \to V_f$ be defined by
    $D(x_1,\ldots,x_r) = d_1(x_1)+\cdots+d_r(x_r)$. Let $K_f$ be the Fourier
    coefficient field of $f$. Since $A$ is an abelian subvariety of $V_f$, there
    exists $M\in \End_0(V)\cong M_r(\End_0(A_f)) = M_r (K_f)$ such that $\Im M
    = A$. Let $i:A_f\to A_f ^r$ be the inclusion map into the first coordinate.
    Then there exists $U\in \Aut(A_f ^r)=\GL_r (K_f)$ such that,
    \[
        \begin{tikzcd}
            A_f \arrow[r,"i"] &
            A_f ^r \arrow[r, dotted, "U"] &
            A_f ^r \arrow[r, "D"] &
            V_f \arrow[r, "M"] &
            A,
        \end{tikzcd}
    \]
    the map $T:=M \circ \Phi \circ U\circ i:A_f\to A\in \Hom_0(A_f, A)$ is
    nonzero. Since degeneracy maps are $K_f$-linear, there exists coefficients
    $a_1,\ldots,a_r\in K_f$ such that $T = \sum a_i d_i$. Now there exists
    $b\in \ZZ^*$ such that $T':=bT\in \Hom(A_f, A)$ is nonzero and hence an
    isogeny. Since $T'(\Lambda_{A_f})\subset \Lambda_A$, $T'=\sum q_i d_i$
    for $q_i\in \QQ$. Finally, there exists $w\in \ZZ^*$ such that
    $S:=wT'=\sum n_i d_i$ with $n_i\in \ZZ$.
\end{proof}

As we've seen in Section~\ref{}, it is often the case that $(L, N)$ satisfy the
$\star$-condition. Under these condition, the kernel of $S$ is always
Eisenstein.

% THIS IS WRONG!!! instead of divisible, we just need to factor out a thing
The purpose of studying $\ker\Phi_L$ is the following computation. Let
$A\subseteq J_0(N)$ be isogenous to $A_f$ where $f$ is of level $L$. Then from
Proposition~\ref{prop:integral_degen}, there exists $S:=\sum n_i d_i:J_0(L)\to
J_0(N)$ such that $S(A_f)=A$. Since abelian varieties are divisible, we may
assume that $\gcd(n_1, \ldots,n_r)=1$. Suppose $x\in \ker S$. Then 

\begin{proposition}
    \label{prop:star_eisenstein}
    Suppose $(L, N)$ satisfies the $\star$-condition, then $\ker S\subseteq
    \Sigma(L)$. In particular, this isogeny is Eisenstein.
\end{proposition}
\begin{proof}
    Suppose $x\in \ker S$. We will continue with equation~\eqref{eq:S_to_ker}
    so $(n_1 x, \ldots, n_r x)\in \ker\Phi_L = \Sigma(L)_0 ^r$. Hence, $n_i x\in
    \Sigma(L)$ for all $i$. Since $\gcd(n_1,\ldots,n_r)=1$, $x\in \Sigma(L)$.
\end{proof}

\begin{question}
    \label{question:iso}
    Let $A$ be a simple subvariety of $J_0(N)$ for some $N$. Let $\mathcal{I}$
    be the isogeny class of $A$. For all $B\in \mathcal{I}$, is $B$ a
    subvariety of $J_0(M)$ for some $M$?
\end{question}

\begin{example}
    Suppose $I$ is a Neumann-Setzer isogeny class of elliptic curves of
    conductor $p$. Then there are exactly 2 elliptic curves $E_0$ and $E_1$,
    where $E_0$ is $J_0(p)$-optimal and $E_1$ is $J_1(p)$-optimal
    (Stein-Watkins). Viewing $E_0$ as a subvariety of $J_0(p)$ and taking $q$
    to be a prime distinct from $p$, we have
    \[
        E_1 \isom \Im (d_1-d_q)(E_0)\subseteq J_0(pq),
    \]
    where $d_1, d_q:J_0(p)\to J_0(pq)$ are the natural degeneracy maps. This
    gives an affirmative answer to Question~\ref{question:iso} in the
    Neumann-Setzer isogeny class case.
\end{example}


\begin{question}
    Let $M$ be a $\Gal(\QQbar/\QQ)$-submodule of $J_0(L)$. Does there exists
    $N$ and an integral linear combination of degeneracy maps $S:=\sum n_i d_i$
    such that $\ker S=M$? This is the converse to Corollary~\ref{cor:star}.
\end{question}

\begin{question}
    Is $\ker S$ always Eisenstein? This is true under the $\star$-condition.
\end{question}

\section{Algorithms for modular abelian varieties}

% TODO: insert some stuff from modabvar?

\subsection{Cuspidal subgroup}
\subsection{Shimura subgroup}
\subsection{Identifying abelian subvarieties}
\subsection{Map to Weierstrass equation}
\subsection{Isogeny testing}
\subsection{Isomorphic testing}

\section{Totally Split Jacobians}%
\label{sec:totally_split}

A Jacobian is said to be \emph{totally split} if it is $\QQ$-isogenous to a
product of elliptic curves. The classification and construction of totally
split Jacobians of genus 2 curves has been
well-studied~\cite{bruin-doerksen:split_genus_two,kuhn:split_genus_two}
and large rational torsion subgroup of totally split Jacobians of genus 2 and 3
curves have been found~\cite{howe-leprevost-poonen:large}. The original
motivation of this project was to compute the rational torsion subgroup for as
many $J_0(N)$ as possible. The first $N$ for which Sage fails is $J_0(30)$
which happens to be a product of 3 elliptic curves. The author and his adviser
were able to compute the rational torsion subgroup using the fact that
$J_0(30)$ is totally split, the fact that rational torsion subgroups of
elliptic curves can be computed, and Galois cohomology. The goal of this
section is to prove that there are finitely many totally split $J_0(N)$, to
give a general (but totally impratical) method for computing the rational
torsion subgroup, and to present some more practical techniques for computing
the rational torsion subgroup. 



\subsection{Provably enumerating the set of totally split modular Jacobians}

The modular Jacobian $J_0(N)$ is totally split if and only if all cuspforms of
level $N$ have rational Hecke coefficients. We expect this to be rare. In fact,
Ralph Greenberg quickly gave an argument proving the set of totally split
$J_0(N)$ is finite. However, his argument did not give an effective method of
enumeration. The goal of this subsection is to provably enumerate the set of
$J_0(N)$ that are totally split. There are 71 of them that are nontrivial.

We have that $J_0(N)$ is totally split if and only if its dimension is equal to
the number of (modular) elliptic curves of conductor $N$. If $N$ is less than
the upper limit of conductors in the Cremona Database, then determining whether
$J_0(N)$ is totally split is a quick computation since there is a closed-form
formula for $\dim J_0(N)$.  

\begin{lemma}
    \label{lemma:good_primes}
    The only possible primes $p$ so that $J_0(p)$ is a totally split Jacobian are
    \[
        2, 3, 5, 7, 11, 13, 17, 19, 37.
    \]
\end{lemma}
\begin{proof}
    Let $J=J_0(p)$ be a totally split Jacobian of prime level. If $\dim J=0$,
    then $J$ is clearly totally split so assume $\dim J>0$. Then $J\cong
    \prod_f E_f$ with $E_f$'s elliptic curves of conductor $p$. Let $n$ denote
    the order of the rational cuspidal subgroup of $J$ which is, as mentioned
    above, known to be the numerator of $(p-1)/12$. By Emerton's proof of
    Stein's refined Eisenstein conjecture~\cite[Theorem B]{emerton:optimal}, if
    $l$ divides $n$, then $l$ divides the order of $E_f(\QQ)$ for some elliptic
    factor of $J$. But elliptic curves of prime conductor do not have much
    rational torsion.

    In particular, Miyawaki~\cite{miyawaki:ell_prime} enumerates all curves of prime
    power conductor with odd-order rational torsion. The largest prime
    conductor here being 37. This implies that if $p>37$, then $\#C(\QQ)$ must
    be a power of 2 so $p=2^a 3^b + 1$ for some $a\geq 0$ and $b\in \{0,1\}$.
    We now show $a\leq 2$.

    If $a>2$, then $C(\QQ)$ has an order 2 element which implies some $E_i$ has
    a rational 2-torsion point. As a result of Setzer~\cite[Theorem
    2]{setzer:ell_prime}, $p=17$ or $p=u^2+64$ for some integer $u$. We split into 2
    cases to show that $p$ is never $u^2+64$.

    Suppose $b=0$. Then $p$ is a Fermat prime and thus a Fermat number. Outside
    of $3$ and $5$, the recursive formula for Fermat numbers and an induction
    argument shows that the last digit of Fermat numbers is always $7$. But the
    only possible last digits of $u^2+64$ are $0, 3, 4, 5, 8, 9$.

    Suppose $b=1$. Then $2^a\cdot 3 = u^2+63$. This implies $3$ divides $u$ so
    $9$ divides $u^2$. But now the right-hand side is divisible by $9$ while the
    left is not.

    In conclusion, we know that if $J_0(p)$ is a totally split Jacobian, then $p\leq
    37$. A computer search then gives us the list found in the statement of the
    lemma.
\end{proof}

Call a positive integer $N$ \emph{good}, if $J_0(N)$ is totally split and
\emph{bad} otherwise. The simple factors of $J_0(N)$ are also factors of
$J_0(MN)$ for any positive integer $M$. Therefore, if $N$ is bad, then so is
any multiple of $N$. This allows us to prune branches while doing a search for
good integers on the divisiblity tree of the integers.

\begin{algorithm}{Enumerating Good Integers}
    \label{alg:find_split}
    Given a finite list of good primes $S$, this algorithm will halt and
    return the list of all good integers whose prime divisors lie in $S$
    if and only if this list is finite.
\end{algorithm}
\begin{enumerate}
    \item{} [Initialize] 
        Set $i=1$ and $M_1=S$. Here $M_i$ will represent the set of all good
        integers whose sum of exponents in the prime factorization is $i$.
    \item{} [Find prime multiples of $M_i$ are that good]
        Set
        \[
            M_{i+1}=\{pN: p\in S, N\in M_i, pN \text{ good}\}.
        \]
        If $M_{i+1}$ is non-empty, increment $i$ and repeat this step.
    \item [Return] 
        Return $\bigcup_i M_i$.
\end{enumerate}

\begin{theorem}
    There are 71 integers $N$ for which $J_0(N)$ is a totally split Jacobian of
    positive dimension. They are given in Table~\ref{split_table}.
\end{theorem}
\begin{proof}
    We run Algorithm~\ref{alg:find_split} on the good primes found in
    Lemma~\ref{lemma:good_primes} and it halts (luckily before reaching the end
    of the Cremona database).
\end{proof}


\subsection{Enumerating rational torsion is algorithmic}


\begin{proposition}
    Suppose $A$ is a totally split abelian subvariety of $J=J_0(N)$ Then we can
    compute the following data:
    \begin{enumerate}
        \item
            A number field containing $\QQ(A[n])$ for positive integer $n$.
        \item
            Let $n$ be a positive integer and $L$ be a number field containing
            $\QQ(A[n])$. The action of $\Gal(L/\QQ)$ on $A[n]$.
        \item 
            The $K$-rational torsion points of $A(K)_\tor$.
    \end{enumerate}
    In particular, we can compute the rational torsion subgroup of any totally
    split Jacobian.
\end{proposition}
\begin{proof}
    Recall that the abelian subvarieties are represented by giving a submodule
    of the integral homology~\ref{TODO}. Suppose $A$ is 1-dimensional subvariety of
    $J$. Then by~\ref{TODO}, we can compute an elliptic curve $E_A$ given in
    Weierstrass defining equation and an isomorphism $\Phi_A:A_\tor\to
    (E_A)_\tor$.

    We will proceed by induction on the dimension, $d$, of $A$. We first
    consider the case $d=1$. 
    \begin{enumerate}
        \item 
            Let $n$ be a positive integer. Then using division polynomials, we
            can compute a number field $L$ containing $\QQ(A[n])$.
        \item
            Let $n$ be a positive integer and $L$ be a number field containing
            $\QQ(A[n])$. The Galois action on the points of $E_A[n]$ is given
            by applying the Galois action to each coordinate. Using $\Phi_A$
            and the action of $\Gal(L/\QQ)$ on $E_A$, we can explicit determine
            the action of $\Gal(L/\QQ)$ on $A[n]$.
        \item
            Let $K$ be a number field. Using reduction mod $p$, there exists an
            integer $m$, such that that $A(K)_\tor \subseteq A[m]$. Using (1),
            we can define a number field $L$ that contains $\QQ(A[m])$. Then
            using (2), we can compute
            \[
                A(K)_\tor = A[m]^{\Gal(L/K)}.
            \]
    \end{enumerate}

    Now assume we can compute (1)-(3) for any totally split abelian subvariety
    of dimension less than $k$.

    Let $A$ be of dimension $k+1$ and write $A=B+C$, where $B$ is of
    dimension $k$ and $C$ is of dimension $1$.  We have the exact sequence
    \[
        0\to B\cap C \to B\times C \to A,
    \]
    where we identify $B\cap C$ as a subgroup of $B\times C$ via the
    anti-diagonal embedding. So $A=(B\times C)/(B\cap C)$. Let $r$ be the
    exponent of $B\cap C$. 
    \begin{enumerate}
        \item 
            For any integer $n$, $A[n] \subseteq B[nr]+C[nr]$. So a number
            field containing $\QQ(A[n])$ is the compositum  of the number
            fields containing $\QQ(B[nr])$ and $\QQ(C[nr])$ which can be
            computed by the inductive hypothesis.
        \item
            The Galois action can be determined on $A[n]$ by viewing $A[n]$ as
            a subgroup of $(B[nr]\times C[nr])/(B\cap C)$.
        \item
            Using reduction mod $p$, there exists an integer $m$ such that
            $A(K)_\tor\subseteq A[m]$. Using (1), we can find a number field
            $L$ that contains $\QQ(A[m])$. Then we use (2), to compute
            \[
                A(K)_\tor = A[m]^{\Gal(L/K)}.
            \]
    \end{enumerate}
\end{proof}


\section{Enumerating Isogenies}%
\label{sec:enum_isogenies}
% TODO: Add writeup on isogenies

\section{Tables}

\include{table_enumerate_totally_split}

\bibliography{modabvar/biblio}
\end{document}
